<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>R Handbook for Epidemiologists</title>
  <meta name="description" content="Description here…………………." />
  <meta name="generator" content="bookdown 0.21.4 and GitBook 2.6.7" />

  <meta property="og:title" content="R Handbook for Epidemiologists" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/R_Handbook_Logo.png" />
  <meta property="og:description" content="Description here…………………." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Handbook for Epidemiologists" />
  
  <meta name="twitter:description" content="Description here…………………." />
  <meta name="twitter:image" content="/images/R_Handbook_Logo.png" />

<meta name="author" content="the handbook team" />


<meta name="date" content="2021-01-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="hbk_css.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R Handbook for Epis</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#welcome"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#about-this-handbook"><i class="fa fa-check"></i><b>1.1</b> About this handbook</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#contributors"><i class="fa fa-check"></i><b>1.2.1</b> Contributors</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#funding-and-programmatic-support"><i class="fa fa-check"></i><b>1.2.2</b> Funding and programmatic support</a></li>
<li class="chapter" data-level="1.2.3" data-path=""><a href="#data-sources"><i class="fa fa-check"></i><b>1.2.3</b> Data sources</a></li>
<li class="chapter" data-level="1.2.4" data-path=""><a href="#inspiration-and-templates"><i class="fa fa-check"></i><b>1.2.4</b> Inspiration and templates</a></li>
<li class="chapter" data-level="1.2.5" data-path=""><a href="#image-credits"><i class="fa fa-check"></i><b>1.2.5</b> Image credits</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I About this book</b></span></li>
<li class="chapter" data-level="2" data-path=""><a href="#style-and-editorial-notes"><i class="fa fa-check"></i><b>2</b> Style and editorial notes</a>
<ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#style"><i class="fa fa-check"></i><b>2.1</b> Style</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path=""><a href="#text-style"><i class="fa fa-check"></i><b>2.1.1</b> Text style</a></li>
<li class="chapter" data-level="2.1.2" data-path=""><a href="#tidyverse"><i class="fa fa-check"></i><b>2.1.2</b> <strong>tidyverse</strong></a></li>
<li class="chapter" data-level="2.1.3" data-path=""><a href="#code-readability"><i class="fa fa-check"></i><b>2.1.3</b> Code readability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#editorial-decisions"><i class="fa fa-check"></i><b>2.2</b> Editorial decisions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#datasets-used"><i class="fa fa-check"></i><b>3</b> Datasets used</a></li>
<li class="part"><span><b>II Data Management</b></span></li>
<li class="chapter" data-level="4" data-path=""><a href="#cleaning-data"><i class="fa fa-check"></i><b>4</b> Cleaning data</a>
<ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#preparation"><i class="fa fa-check"></i><b>4.2</b> Preparation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path=""><a href="#load-packages"><i class="fa fa-check"></i><b>4.2.1</b> Load packages</a></li>
<li class="chapter" data-level="4.2.2" data-path=""><a href="#load-data"><i class="fa fa-check"></i><b>4.2.2</b> Load data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path=""><a href="#cleaning-pipeline"><i class="fa fa-check"></i><b>4.3</b> Cleaning pipeline</a></li>
<li class="chapter" data-level="4.4" data-path=""><a href="#column-names"><i class="fa fa-check"></i><b>4.4</b> Column names</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path=""><a href="#automatic-colummn-name-cleaning"><i class="fa fa-check"></i><b>4.4.1</b> Automatic colummn name cleaning</a></li>
<li class="chapter" data-level="4.4.2" data-path=""><a href="#manual-column-name-cleaning"><i class="fa fa-check"></i><b>4.4.2</b> Manual column name cleaning</a></li>
<li class="chapter" data-level="4.4.3" data-path=""><a href="#merged-excel-column-names"><i class="fa fa-check"></i><b>4.4.3</b> Merged Excel column names</a></li>
<li class="chapter" data-level="4.4.4" data-path=""><a href="#skip-import-of-rows"><i class="fa fa-check"></i><b>4.4.4</b> Skip import of rows</a></li>
<li class="chapter" data-level="4.4.5" data-path=""><a href="#combine-two-header-rows"><i class="fa fa-check"></i><b>4.4.5</b> Combine two header rows</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path=""><a href="#select-or-re-order-columns"><i class="fa fa-check"></i><b>4.5</b> Select or re-order columns</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path=""><a href="#select-re-order"><i class="fa fa-check"></i><b>4.5.1</b> Select &amp; re-order</a></li>
<li class="chapter" data-level="4.5.2" data-path=""><a href="#select-as-a-stand-alone-command"><i class="fa fa-check"></i><b>4.5.2</b> <code>select()</code> as a stand-alone command</a></li>
<li class="chapter" data-level="4.5.3" data-path=""><a href="#add-to-the-pipe-chain"><i class="fa fa-check"></i><b>4.5.3</b> Add to the pipe chain</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path=""><a href="#Classes"><i class="fa fa-check"></i><b>4.6</b> Modify class</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path=""><a href="#pre-checks-and-errors"><i class="fa fa-check"></i><b>4.6.1</b> Pre-checks and errors</a></li>
<li class="chapter" data-level="4.6.2" data-path=""><a href="#modify-multiple-columns"><i class="fa fa-check"></i><b>4.6.2</b> Modify multiple columns</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path=""><a href="#add-columns-and-rows"><i class="fa fa-check"></i><b>4.7</b> Add columns and rows</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path=""><a href="#add-columns"><i class="fa fa-check"></i><b>4.7.1</b> Add columns</a></li>
<li class="chapter" data-level="4.7.2" data-path=""><a href="#add-rows"><i class="fa fa-check"></i><b>4.7.2</b> Add rows</a></li>
<li class="chapter" data-level="4.7.3" data-path=""><a href="#new-columns-using-grouped-values"><i class="fa fa-check"></i><b>4.7.3</b> New columns using grouped values</a></li>
<li class="chapter" data-level="4.7.4" data-path=""><a href="#add-to-pipe-chain"><i class="fa fa-check"></i><b>4.7.4</b> Add to pipe chain</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path=""><a href="#recode"><i class="fa fa-check"></i><b>4.8</b> Recoding values</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path=""><a href="#manual-recoding"><i class="fa fa-check"></i><b>4.8.1</b> Manual recoding</a></li>
<li class="chapter" data-level="4.8.2" data-path=""><a href="#recoding-by-logic"><i class="fa fa-check"></i><b>4.8.2</b> Recoding by logic</a></li>
<li class="chapter" data-level="4.8.3" data-path=""><a href="#recoding-using-special-dplyr-functions"><i class="fa fa-check"></i><b>4.8.3</b> Recoding using special <strong>dplyr</strong> functions</a></li>
<li class="chapter" data-level="4.8.4" data-path=""><a href="#recoding-using-cleaning-dictionaries"><i class="fa fa-check"></i><b>4.8.4</b> Recoding using cleaning dictionaries</a></li>
<li class="chapter" data-level="4.8.5" data-path=""><a href="#add-to-pipe-chain-1"><i class="fa fa-check"></i><b>4.8.5</b> Add to pipe chain</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path=""><a href="#filter-rows"><i class="fa fa-check"></i><b>4.9</b> Filter rows</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path=""><a href="#a-simple-filter"><i class="fa fa-check"></i><b>4.9.1</b> A simple <code>filter()</code></a></li>
<li class="chapter" data-level="4.9.2" data-path=""><a href="#a-complex-filter"><i class="fa fa-check"></i><b>4.9.2</b> A complex <code>filter()</code></a></li>
<li class="chapter" data-level="4.9.3" data-path=""><a href="#filter-as-a-stand-alone-command"><i class="fa fa-check"></i><b>4.9.3</b> Filter as a stand-alone command</a></li>
<li class="chapter" data-level="4.9.4" data-path=""><a href="#filtering-to-quickly-review-data"><i class="fa fa-check"></i><b>4.9.4</b> Filtering to quickly review data</a></li>
<li class="chapter" data-level="4.9.5" data-path=""><a href="#add-to-pipe-chain-2"><i class="fa fa-check"></i><b>4.9.5</b> Add to pipe chain</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path=""><a href="#num_cats"><i class="fa fa-check"></i><b>4.10</b> Numeric categories</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path=""><a href="#age_categories"><i class="fa fa-check"></i><b>4.10.1</b> <code>age_categories()</code>**</a></li>
<li class="chapter" data-level="4.10.2" data-path=""><a href="#cut"><i class="fa fa-check"></i><b>4.10.2</b> <code>cut()</code></a></li>
<li class="chapter" data-level="4.10.3" data-path=""><a href="#case_when-1"><i class="fa fa-check"></i><b>4.10.3</b> <code>case_when()</code></a></li>
<li class="chapter" data-level="4.10.4" data-path=""><a href="#add-to-pipe-chain-3"><i class="fa fa-check"></i><b>4.10.4</b> Add to pipe chain</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path=""><a href="#rowwise-dplyr"><i class="fa fa-check"></i><b>4.11</b> rowwise() <strong>dplyr()</strong></a></li>
<li class="chapter" data-level="4.12" data-path=""><a href="#transforming-multiple-variables-at-once"><i class="fa fa-check"></i><b>4.12</b> Transforming multiple variables at once</a></li>
<li class="chapter" data-level="4.13" data-path=""><a href="#deduplication"><i class="fa fa-check"></i><b>4.13</b> Deduplication</a></li>
</ul></li>
<li class="part"><span><b>III Data Vizualization</b></span></li>
<li class="chapter" data-level="5" data-path=""><a href="#age-pyramids"><i class="fa fa-check"></i><b>5</b> Age pyramids</a>
<ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#overview-1"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#preparation-1"><i class="fa fa-check"></i><b>5.2</b> Preparation</a></li>
<li class="chapter" data-level="5.3" data-path=""><a href="#apyramid-package"><i class="fa fa-check"></i><b>5.3</b> <strong>apyramid</strong> package</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path=""><a href="#linelist-data"><i class="fa fa-check"></i><b>5.3.1</b> Linelist data</a></li>
<li class="chapter" data-level="5.3.2" data-path=""><a href="#aggregated-data"><i class="fa fa-check"></i><b>5.3.2</b> Aggregated data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path=""><a href="#ggplot"><i class="fa fa-check"></i><b>5.4</b> <code>ggplot()</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path=""><a href="#constructing-the-plot"><i class="fa fa-check"></i><b>5.4.1</b> Constructing the plot</a></li>
<li class="chapter" data-level="5.4.2" data-path=""><a href="#compare-to-baseline"><i class="fa fa-check"></i><b>5.4.2</b> Compare to baseline</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path=""><a href="#likert-scale"><i class="fa fa-check"></i><b>5.5</b> Likert scale</a></li>
<li class="chapter" data-level="5.6" data-path=""><a href="#resources"><i class="fa fa-check"></i><b>5.6</b> Resources</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/nsbatra/Epi_R_handbook" target="blank">Source Github repository</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Handbook for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">R Handbook for Epidemiologists</h1>
<p class="author"><em>the handbook team</em></p>
<p class="date"><em>2021-01-24</em></p>
</div>
<!-- ---  -->
<!-- title: "A Minimal Book Example" -->
<!-- author: "Yihui Xie" -->
<!-- date: "2021-01-24" -->
<!-- site: bookdown::bookdown_site -->
<!-- output: bookdown::gitbook -->
<!-- documentclass: book -->
<!-- bibliography: [book.bib, packages.bib] -->
<!-- biblio-style: apalike -->
<!-- link-citations: yes -->
<!-- github-repo: rstudio/bookdown-demo -->
<!-- description: "This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." -->
<!-- --- -->
<div id="welcome" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Welcome</h1>
<p><img src="images/R%20Handbook%20Logo.png" width="100%" style="display: block; margin: auto;" /></p>
<!-- ======================================================= -->
<div id="about-this-handbook" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> About this handbook</h2>
<p><strong>Objective</strong></p>
<p><strong>A free open-access digital R reference book catered to epidemiologists and public health practitioners that is usable offline and addresses common epidemiological tasks via clear text explanations, step-by-step instructions, and best practice R code examples</strong></p>
<p>Epis using R must often Google search and read dozens of forum pages to complete common data manipulation and visualization epi tasks. However, field epidemiologists often work in low internet-connectivity environments and have limited technical support. This handbook aims to fill this gap.</p>
<p><strong>How to read this handbook:</strong></p>
<ul>
<li><p>The is an HTML file which <em>can</em> be viewed offline, and is best viewed with Google Chrome.</p></li>
<li><p>Search via the search box above the Table of Contents. Ctrl+f will search across the current page.</p></li>
<li><p>Click the “clipboard” icon in the upper-right of each code chunk to copy it.</p></li>
</ul>
<p><strong>Version</strong><br />
The latest version of this handbook can be found at this <a href="https://github.com/nsbatra/R_epi_handbook">github repository</a>.</p>
<!-- ======================================================= -->
</div>
<div id="acknowledgements" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Acknowledgements</h2>
<div id="contributors" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Contributors</h3>
<p><strong>Editor-in-Chief:</strong> Neale Batra (<a href="mailto:neale.batra@gmail.com" class="email">neale.batra@gmail.com</a>)</p>
<p><strong>Editorial core team:</strong> …</p>
<p><strong>Authors:</strong> …</p>
<p><strong>Reviewers:</strong> …</p>
<p><strong>Advisers</strong> …</p>
</div>
<div id="funding-and-programmatic-support" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Funding and programmatic support</h3>
<p>TEPHINET<br />
EAN</p>
</div>
<div id="data-sources" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Data sources</h3>
<p><em>outbreaks</em> R package</p>
</div>
<div id="inspiration-and-templates" class="section level3" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Inspiration and templates</h3>
<p>R4Epis<br />
RECON packages<br />
R4DS book (Hadley)<br />
Bookdown book (Yihui)<br />
Rmarkdown book (Yihui)</p>
</div>
<div id="image-credits" class="section level3" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Image credits</h3>
<p>Logo: CDC Public Image gallery; R Graph Gallery</p>

</div>
</div>
</div>



</div>
<div id="style-and-editorial-notes" class="section level1 tabset tabset-fade" number="2">
<h1><span class="header-section-number">2</span> Style and editorial notes</h1>
<div id="style" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Style</h2>
<div id="text-style" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Text style</h3>
<p><strong>Package and function names</strong></p>
<p>Package names are written in bold (e.g. <strong>dplyr</strong>) and functions are written like this: <code>mutate()</code>. Packages referenced either in text or within code like this: <code>dplyr::mutate()</code></p>
<p><strong>Types of notes</strong></p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> This is a note</span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> This is a tip.</span></p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This is a cautionary note.</span></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> This is a warning.</span></p>
</div>
<div id="tidyverse" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> <strong>tidyverse</strong></h3>
<p>This handbook generally uses <strong>tidyverse</strong> R coding style. Read more <a href="https://www.tidyverse.org/">here</a></p>
</div>
<div id="code-readability" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Code readability</h3>
<p>We chose to frequently write code on new lines, in order to offer more understandable comments. As a result, code that <em>could</em> be written like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>obs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st">                    </span><span class="co"># group the rows by &#39;name&#39;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="st">  </span><span class="kw">slice_max</span>(date, <span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">with_ties =</span> F) <span class="co"># if there&#39;s a tie (of date), take the first row</span></span></code></pre></div>
<p>…is often written like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>obs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># group the rows by &#39;name&#39;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="st">  </span><span class="kw">slice_max</span>(</span>
<span id="cb2-4"><a href="#cb2-4"></a>    date,              <span class="co"># keep row per group with maximum date value </span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="dt">n =</span> <span class="dv">1</span>,             <span class="co"># keep only the single highest row </span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="dt">with_ties =</span> F)     <span class="co"># if there&#39;s a tie (of date), take the first row</span></span></code></pre></div>
</div>
</div>
<div id="editorial-decisions" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Editorial decisions</h2>
<p>Below, we track significant editorial decisions around package and function choice. If you disagree or want to offer a new tool, please join/start a conversation on our Github page.</p>
<p><strong>Table of package, function, and other editorial decisions</strong></p>
<table>
<colgroup>
<col width="15%" />
<col width="18%" />
<col width="19%" />
<col width="46%" />
</colgroup>
<thead>
<tr class="header">
<th>Subject</th>
<th>Considered</th>
<th>Outcome &amp; date</th>
<th>Brief rationale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Epiweeks</td>
<td>aweek, lubridate</td>
<td>lubridate, Dec 2020</td>
<td>consistency, package maintenance prospects</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="datasets-used" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Datasets used</h1>
<p>Here the datasets used in this handbook will be described and will be downloadable</p>
<ul>
<li>Linelist (…)</li>
<li>Aggregated case counts (…)<br />
</li>
<li>GIS shapefile (…)<br />
</li>
<li>modeling dataset? (…)</li>
</ul>

</div>



</div>
<div id="cleaning-data" class="section level1 tabset tabset-fade" number="4">
<h1><span class="header-section-number">4</span> Cleaning data</h1>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
<div id="overview" class="section level2 tabset tabset-fade" number="4.1">
<h2><span class="header-section-number">4.1</span> Overview</h2>
<p>This page demonstrates common steps necessary to clean a dataset. It uses a simulated Ebola case linelist, which is used throughout the handbook.</p>
<p><img src="images/cleaning_dataset_snip.png" width="75%" style="display: block; margin: auto;" /></p>
<ul>
<li>Dealing with character case (upper, lower, title, etc.)</li>
<li>Factor columns</li>
</ul>
<p>replace missing with
dealing with cases (all lower, etc)
case_when()
factors</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="preparation" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Preparation</h2>
<div id="load-packages" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Load packages</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(tidyverse,  <span class="co"># data manipulation and visualization</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>               janitor,    <span class="co"># data cleaning</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>               rio,        <span class="co"># importing data</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>               epikit)     <span class="co"># age_categories() function  </span></span></code></pre></div>
</div>
<div id="load-data" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Load data</h3>
<p>Import the raw dataset using the <code>import()</code> function from the package <strong>rio</strong>. (LINK HERE TO IMPORT PAGE)</p>
<pre><code>## New names:
## * `` -&gt; ...25</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>linelist_raw &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>)</span></code></pre></div>
<p>You can view the first 50 rows of the the original “raw” dataset below:</p>
<div id="htmlwidget-1f9c253d11f81361c23a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f9c253d11f81361c23a">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"50\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"10\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1403827200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1404518400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1405555200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2688968279886\" data-max=\"-13.2083835761865\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45196229052854\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"17\" data-max=\"22\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],["20b688","a3c8b8","72b905","5fe599","11f8ea","f96aa5","893f25","c4e706","47a5f5","9e0998","566f9e","acf422","ce9c02","1a4ac9","5387a2","db4b96","8a4580","dbebea","f393b4","30c98c","788a99","9f6884","2978ac","60f0c2","50adde","6fa4bf","d6f195","57a565","4cff96","be502d","9ae2d7","fc15ef","c97dd9","02d8fd","2ebf95","c36eb4","88a4e0","542d07","9e74c4","ae96ac","589e9f","341efa","f86ce2","99e8fa","bc648d","ec8ee4","ab78c0","567136","c62127","b799eb"],[3,4,4,4,2,3,3,5,3,4,3,6,5,6,4,3,4,7,4,3,5,4,4,7,6,5,4,4,6,5,5,6,9,9,6,8,6,5,10,10,9,9,9,7,9,6,8,6,9,5],[null,"2014-05-07T00:00:00Z","2014-05-06T00:00:00Z","2014-05-08T00:00:00Z",null,"2014-05-17T00:00:00Z","2014-05-18T00:00:00Z",null,"2014-05-03T00:00:00Z",null,"2014-05-24T00:00:00Z","2014-05-25T00:00:00Z","2014-05-27T00:00:00Z",null,"2014-05-26T00:00:00Z","2014-05-16T00:00:00Z",null,null,null,null,"2014-06-01T00:00:00Z","2014-06-02T00:00:00Z","2014-05-30T00:00:00Z","2014-06-04T00:00:00Z",null,"2014-06-05T00:00:00Z",null,"2014-05-28T00:00:00Z","2014-06-05T00:00:00Z","2014-06-09T00:00:00Z","2014-06-12T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-14T00:00:00Z",null,"2014-06-15T00:00:00Z",null,"2014-06-10T00:00:00Z","2014-06-20T00:00:00Z","2014-06-20T00:00:00Z","2014-06-11T00:00:00Z",null,null,"2014-06-24T00:00:00Z",null,"2014-06-15T00:00:00Z",null,null,"2014-06-20T00:00:00Z","2014-06-27T00:00:00Z"],["15th April 2014","2014-05-08","2014-05-12","2014-05-13","2014-05-16","2014-05-19","2014-05-21","2014-05-23","2014-05-26","2014-05-26","2014-05-27","2014-05-27","2014-05-27","2014-05-27","2014-05-31","2014-05-31","2014-06-02","2014-06-02","2014-06-05","2014-06-06","2014-06-06","2014-06-07","2014-06-06","2014-06-07","2014-06-09","2014-06-10","2014-06-10","2014-06-13","2014-06-15","2014-06-15","2014-06-16","2014-06-16","2014-06-19","2014-06-20","2014-06-19","2014-06-20","2014-06-22","2014-06-22","2014-06-22","2014-06-25","2014-06-24","2014-06-24","2014-06-26","2014-06-28","2014-06-30","2014-06-30","2014-07-02","2014-07-02","2014-07-02","2014-07-03"],["2014-05-06T00:00:00Z","2014-05-10T00:00:00Z","2014-05-13T00:00:00Z","2014-05-15T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-24T00:00:00Z","2014-05-26T00:00:00Z","2014-05-27T00:00:00Z","2014-05-28T00:00:00Z","2014-05-28T00:00:00Z","2014-05-29T00:00:00Z","2014-05-29T00:00:00Z","2014-05-31T00:00:00Z","2014-06-01T00:00:00Z","2014-06-02T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-08T00:00:00Z","2014-06-10T00:00:00Z","2014-06-11T00:00:00Z","2014-06-12T00:00:00Z","2014-06-15T00:00:00Z","2014-06-16T00:00:00Z","2014-06-16T00:00:00Z","2014-06-16T00:00:00Z","2014-06-17T00:00:00Z","2014-06-19T00:00:00Z","2014-06-20T00:00:00Z","2014-06-21T00:00:00Z","2014-06-21T00:00:00Z","2014-06-23T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-25T00:00:00Z","2014-06-26T00:00:00Z","2014-06-26T00:00:00Z","2014-06-26T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-02T00:00:00Z","2014-07-02T00:00:00Z","2014-07-03T00:00:00Z","2014-07-03T00:00:00Z","2014-07-05T00:00:00Z"],["2014-05-14T00:00:00Z","2014-05-14T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-02T00:00:00Z","2014-06-06T00:00:00Z","2014-06-02T00:00:00Z","2014-06-03T00:00:00Z","2014-06-27T00:00:00Z","2014-06-17T00:00:00Z","2014-06-07T00:00:00Z","2014-06-17T00:00:00Z",null,null,"2014-06-05T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-25T00:00:00Z","2014-07-01T00:00:00Z","2014-06-15T00:00:00Z","2014-05-30T00:00:00Z","2014-06-23T00:00:00Z",null,null,null,"2014-06-25T00:00:00Z","2014-06-19T00:00:00Z",null,"2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-26T00:00:00Z","2014-06-28T00:00:00Z","2014-07-08T00:00:00Z","2014-06-27T00:00:00Z","2014-06-30T00:00:00Z","2014-06-29T00:00:00Z",null,"2014-07-09T00:00:00Z","2014-07-14T00:00:00Z",null,"2014-07-14T00:00:00Z","2014-07-07T00:00:00Z","2014-07-17T00:00:00Z","2014-07-12T00:00:00Z"],["Death","Recover","Recover",null,"Recover","Recover","Recover",null,"Recover","Death","Recover","Recover","Death","Death","Death","Death","Death",null,"Recover","Recover","Recover",null,"Death","Death","Recover","Death","Death","Death",null,"Death","Recover","Recover","Recover","Death","Death","Death","Death","Death","Recover","Death",null,"Death","Recover","Recover","Recover","Death","Recover",null,"Recover","Recover"],["m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m"],["Central Hospital","Port Hospital","Other","Other","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Military Hospital",null,null,"Other","Other","Central Hospital","Port Hospital","Port Hospital","Port Hospital",null,"Military Hospital","Port Hospital",null,"Central Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Other","Military Hospital",null,"Military Hospital","Port Hospital","Military Hospital","Military Hospital",null,"Port Hospital","Port Hospital","Port Hospital","Port Hospital",null,"Port Hospital","St. Mark's Maternity Hospital (SMMH)","Port Hospital",null,null,"Military Hospital","Port Hospital","Port Hospital",null,null,"Port Hospital","Port Hospital",null],[-13.2330769474001,-13.2231931914572,-13.2122631729853,-13.2157351064963,-13.212910703914,-13.2523649449559,-13.2228638912441,-13.2143394209926,-13.262434315479,-13.2095352448865,-13.2129350506235,-13.2688968279886,-13.2243703238737,-13.2604684939726,-13.2628435102304,-13.248633850792,-13.2222002700958,-13.2164705932244,-13.2225511595637,-13.2393862117589,-13.2128924575825,-13.2242058657802,-13.2206286746001,-13.2270219251255,-13.220290675191,-13.2381754136412,-13.2183252570302,-13.253989309478,-13.217651519706,-13.2535215623253,-13.2625106957103,-13.2385127873491,-13.2243437095992,-13.2124311244169,-13.2265780018024,-13.2619688324425,-13.2093099826158,-13.2628934511971,-13.2116372005782,-13.2131457458534,-13.2083835761865,-13.2605169121171,-13.2289363806984,-13.2250089377786,-13.2130045468176,-13.2578516459532,-13.2397478783661,-13.2160657166043,-13.2593132020914,-13.2162953240809],[8.46002984141364,8.47325128269697,8.46838441895748,8.46897295100924,8.46481700596819,8.4601071493071,8.46082377490923,8.48932072596067,8.4850504403981,8.48100593467107,8.48331471166371,8.47845973648553,8.47024789713924,8.45421479878989,8.45524160975253,8.4778746413144,8.46388925014565,8.48666377289188,8.46191259217774,8.48677227640615,8.46852156267174,8.48663467687094,8.48401630165138,8.47745440981732,8.46524458864318,8.46964062310321,8.47967725011828,8.45837125340844,8.46236804334872,8.45884880725177,8.4794001484025,8.47761705512509,8.47145134147474,8.45344099552146,8.48676680560442,8.48475855218221,8.45415890802884,8.46479592922727,8.47084519753193,8.46397733703235,8.46320325007363,8.4562327469279,8.46886903678583,8.47404889511544,8.47135450705077,8.45196229052854,8.4867516707238,8.48802917129884,8.45810737927856,8.46395131808455],[null,"2ae019","2ae019","f547d6",null,"11f8ea","11f8ea",null,"7a9f33",null,"be7f8a","1511c5","53da57",null,"e11027","11f8ea",null,null,null,null,"374728","431135","996f3a","cbbe78",null,"7e95d1",null,"133ee7","ba7326","a2086d","ba1abc","37a6f6",null,"e61cb9",null,"057e7a",null,"4977bd","02d8fd","02d8fd","8b4c1c",null,null,"ab634e",null,"be502d",null,null,"c36eb4","ea3740"],[null,"other","other","other",null,"other","other",null,"other",null,"other","other","other",null,"other","other",null,null,null,null,"other","other","other","funeral",null,"other",null,"other","other","other","funeral","other",null,"other",null,"other",null,"funeral","other","other","other",null,null,"other",null,"other",null,null,"other","other"],["5","14","19","25","27","12","7","19","23","10","19","4","23","30","11","21","6","4","18","11","22","14","28","6","11","45","18","9","40","44","41","8","33","14","15","12","37","11","32","2","22","19","17","2","19","6","18","15","15","18"],[19,19,19,18,19,18,19,18,18,18,18,17,19,21,19,20,18,19,20,18,18,22,22,18,19,19,20,18,19,18,20,18,21,18,18,19,21,19,20,18,21,20,19,20,19,20,18,19,20,19],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],["yes","yes","yes","yes","yes",null,"yes","yes","yes","no","yes","no","yes","yes","yes","yes","no","yes","yes","no","no","no","no","no","no","yes","no","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes"],["no","no","no","no","no",null,"no","no","no","no","no","no","yes","yes","no","no","yes","no","no","no","no","no","no","no","no","yes","no","no",null,"yes","no","yes","no","no","yes","no","no","yes","no","no","yes","no","no","no","no","no","yes","no","yes","no"],["yes","yes","no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","no"],["no","no","yes","no","no",null,"no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no","yes","no","no","no","no","no",null,"no","no","no","yes","no","yes","no","no","no","no","no","yes","no","no","no","no","no","yes","no","no","no"],["no","no","yes","yes","yes",null,"no","no","yes","yes","no","yes","yes","no","no","yes","yes","no","no","yes","no","no","yes","yes","yes","yes","no","yes",null,"no","no","yes","yes","no","no","no","yes","no","no","yes","yes","yes","yes","no","yes","no","no","yes","no","yes"],["08:33","11:57","09:27","05:18","11:19","17:20","18:18",null,"12:18","08:11","15:41","11:60","11:18","12:36","08:41","10:19",null,null,"14:20","12:11","12:38",null,"07:27","17:23","09:46","16:30","14:25","08:38","16:42","10:30",null,"16:14","19:08","20:52","10:16","12:43","10:33","16:54","17:21","09:51","20:51","12:38","10:21","11:49","13:40","16:02","11:16",null,null,"03:36"],["under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header"],["under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>row_num<\/th>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>ct_blood<\/th>\n      <th>age_unit<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...25<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,2,10,11,15]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="cleaning-pipeline" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Cleaning pipeline</h2>
<p>In epidemiological analysis and data processing, cleaning steps are often performed together and sequentially. In R this often manifests as a cleaning “pipeline”, where the raw dataset is passed or “piped” from one cleaning step to another. The chain utilizes <strong>dplyr</strong> verbs and the <strong>magrittr</strong> pipe operator (see handbook page on <strong>dplyr</strong> and tidyverse coding style (LINK HERE). The pipe begins with the “raw” data (<code>linelist_raw</code>) and ends with a “clean” dataset (<code>linelist</code>).</p>
<p>In a cleaning pipeline the order of the steps is important. Cleaning steps might include:</p>
<ul>
<li>Importing of data<br />
</li>
<li>Column names cleaned or changed<br />
</li>
<li>Rows filtered, added, or de-duplicated<br />
</li>
<li>Columns selected, added, transformed, or re-ordered<br />
</li>
<li>Values re-coded, cleaned, or grouped</li>
</ul>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="column-names" class="section level2 tabset tabset-fade" number="4.4">
<h2><span class="header-section-number">4.4</span> Column names</h2>
<p>Column names are used very often so they need to have “clean” syntax. We suggest the following:</p>
<ul>
<li>Short names</li>
<li>No spaces (replaced with underscores (_),</li>
<li>No unusual characters (&amp;, #…)<br />
</li>
<li>Similar style nomenclature (e.g. all date columns named like <strong>date_</strong>onset, <strong>date_</strong>report, <strong>date_</strong>death…)</li>
</ul>
<p>The columns names of <code>linelist_raw</code> are below. We can see that there are some with spaces. We also have different naming patterns for dates (‘date onset’ and ‘infection date’).</p>
<p>Also note that in the raw data, the two final columns names were two merged cells with one name. The <code>import()</code> function used the name for the first of the two columns, and assigned the second column the name “…23” as it was then empty (referring to the 23rd column).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">names</span>(linelist_raw)</span></code></pre></div>
<pre><code>##  [1] &quot;row_num&quot;         &quot;case_id&quot;         &quot;generation&quot;      &quot;infection date&quot; 
##  [5] &quot;date onset&quot;      &quot;hosp date&quot;       &quot;date_of_outcome&quot; &quot;outcome&quot;        
##  [9] &quot;gender&quot;          &quot;hospital&quot;        &quot;lon&quot;             &quot;lat&quot;            
## [13] &quot;infector&quot;        &quot;source&quot;          &quot;age&quot;             &quot;ct_blood&quot;       
## [17] &quot;age_unit&quot;        &quot;fever&quot;           &quot;chills&quot;          &quot;cough&quot;          
## [21] &quot;aches&quot;           &quot;vomit&quot;           &quot;time_admission&quot;  &quot;merged_header&quot;  
## [25] &quot;...25&quot;</code></pre>
<pre><code>Note: For a column name that include spaces, surround the name with back-ticks, for example: linelist$`infection date`. On a keyboard, the back-tick (`) is different from the single quotation mark (&#39;), and is sometimes on the same key as the tilde (~).</code></pre>
<div id="automatic-colummn-name-cleaning" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Automatic colummn name cleaning</h3>
<p>The function <code>clean_names()</code> from the package <strong>janitor</strong> standardizes column names and makes them unique by doing the following:</p>
<ul>
<li>Converts all names to consist of only underscores, numbers, and letters<br />
</li>
<li>Accented characters are transliterated to ASCII (e.g. german o with umlaut becomes “o”, spanish “enye” becomes “n”)<br />
</li>
<li>Capitalization preference can be specified using the <code>case =</code> argument (“snake” is default, alternatives include “sentence”, “title”, “small_camel”…)<br />
</li>
<li>You can designate specific name replacements with the <code>replace =</code> argument (e.g. replace = c(onset = “date_of_onset”))<br />
</li>
<li>Here is an online <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">vignette</a></li>
</ul>
<p>Below, the cleaning pipeline begins by using <code>clean_names()</code> on the raw linelist.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># send the dataset through the function clean_names()</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span>janitor<span class="op">::</span><span class="kw">clean_names</span>()</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># see the new names</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">names</span>(linelist)</span></code></pre></div>
<pre><code>##  [1] &quot;row_num&quot;         &quot;case_id&quot;         &quot;generation&quot;      &quot;infection_date&quot; 
##  [5] &quot;date_onset&quot;      &quot;hosp_date&quot;       &quot;date_of_outcome&quot; &quot;outcome&quot;        
##  [9] &quot;gender&quot;          &quot;hospital&quot;        &quot;lon&quot;             &quot;lat&quot;            
## [13] &quot;infector&quot;        &quot;source&quot;          &quot;age&quot;             &quot;ct_blood&quot;       
## [17] &quot;age_unit&quot;        &quot;fever&quot;           &quot;chills&quot;          &quot;cough&quot;          
## [21] &quot;aches&quot;           &quot;vomit&quot;           &quot;time_admission&quot;  &quot;merged_header&quot;  
## [25] &quot;x25&quot;</code></pre>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> The column name “…25” was changed to “x25”.</span></p>
</div>
<div id="manual-column-name-cleaning" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Manual column name cleaning</h3>
<p>Re-naming columns manually is often necessary. Below, re-naming is performed using the <code>rename()</code> function from the <strong>dplyr</strong> package, as part of a pipe chain. <code>rename()</code> uses the style “NEW = OLD”, the new column name is given before the old column name.</p>
<p>Below, a re-name command is added to the cleaning pipeline:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">##################################################################################</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">    </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">    </span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb11-11"><a href="#cb11-11"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb11-12"><a href="#cb11-12"></a>           <span class="dt">date_outcome         =</span> date_of_outcome)</span></code></pre></div>
<p><strong>Now you can see that the columns names have been changed:</strong></p>
<div id="htmlwidget-9573648bc9db6c8de0b2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9573648bc9db6c8de0b2">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"50\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"10\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1403827200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1404518400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1405555200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2688968279886\" data-max=\"-13.2083835761865\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45196229052854\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"17\" data-max=\"22\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],["20b688","a3c8b8","72b905","5fe599","11f8ea","f96aa5","893f25","c4e706","47a5f5","9e0998","566f9e","acf422","ce9c02","1a4ac9","5387a2","db4b96","8a4580","dbebea","f393b4","30c98c","788a99","9f6884","2978ac","60f0c2","50adde","6fa4bf","d6f195","57a565","4cff96","be502d","9ae2d7","fc15ef","c97dd9","02d8fd","2ebf95","c36eb4","88a4e0","542d07","9e74c4","ae96ac","589e9f","341efa","f86ce2","99e8fa","bc648d","ec8ee4","ab78c0","567136","c62127","b799eb"],[3,4,4,4,2,3,3,5,3,4,3,6,5,6,4,3,4,7,4,3,5,4,4,7,6,5,4,4,6,5,5,6,9,9,6,8,6,5,10,10,9,9,9,7,9,6,8,6,9,5],[null,"2014-05-07T00:00:00Z","2014-05-06T00:00:00Z","2014-05-08T00:00:00Z",null,"2014-05-17T00:00:00Z","2014-05-18T00:00:00Z",null,"2014-05-03T00:00:00Z",null,"2014-05-24T00:00:00Z","2014-05-25T00:00:00Z","2014-05-27T00:00:00Z",null,"2014-05-26T00:00:00Z","2014-05-16T00:00:00Z",null,null,null,null,"2014-06-01T00:00:00Z","2014-06-02T00:00:00Z","2014-05-30T00:00:00Z","2014-06-04T00:00:00Z",null,"2014-06-05T00:00:00Z",null,"2014-05-28T00:00:00Z","2014-06-05T00:00:00Z","2014-06-09T00:00:00Z","2014-06-12T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-14T00:00:00Z",null,"2014-06-15T00:00:00Z",null,"2014-06-10T00:00:00Z","2014-06-20T00:00:00Z","2014-06-20T00:00:00Z","2014-06-11T00:00:00Z",null,null,"2014-06-24T00:00:00Z",null,"2014-06-15T00:00:00Z",null,null,"2014-06-20T00:00:00Z","2014-06-27T00:00:00Z"],["15th April 2014","2014-05-08","2014-05-12","2014-05-13","2014-05-16","2014-05-19","2014-05-21","2014-05-23","2014-05-26","2014-05-26","2014-05-27","2014-05-27","2014-05-27","2014-05-27","2014-05-31","2014-05-31","2014-06-02","2014-06-02","2014-06-05","2014-06-06","2014-06-06","2014-06-07","2014-06-06","2014-06-07","2014-06-09","2014-06-10","2014-06-10","2014-06-13","2014-06-15","2014-06-15","2014-06-16","2014-06-16","2014-06-19","2014-06-20","2014-06-19","2014-06-20","2014-06-22","2014-06-22","2014-06-22","2014-06-25","2014-06-24","2014-06-24","2014-06-26","2014-06-28","2014-06-30","2014-06-30","2014-07-02","2014-07-02","2014-07-02","2014-07-03"],["2014-05-06T00:00:00Z","2014-05-10T00:00:00Z","2014-05-13T00:00:00Z","2014-05-15T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-24T00:00:00Z","2014-05-26T00:00:00Z","2014-05-27T00:00:00Z","2014-05-28T00:00:00Z","2014-05-28T00:00:00Z","2014-05-29T00:00:00Z","2014-05-29T00:00:00Z","2014-05-31T00:00:00Z","2014-06-01T00:00:00Z","2014-06-02T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-08T00:00:00Z","2014-06-10T00:00:00Z","2014-06-11T00:00:00Z","2014-06-12T00:00:00Z","2014-06-15T00:00:00Z","2014-06-16T00:00:00Z","2014-06-16T00:00:00Z","2014-06-16T00:00:00Z","2014-06-17T00:00:00Z","2014-06-19T00:00:00Z","2014-06-20T00:00:00Z","2014-06-21T00:00:00Z","2014-06-21T00:00:00Z","2014-06-23T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-25T00:00:00Z","2014-06-26T00:00:00Z","2014-06-26T00:00:00Z","2014-06-26T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-02T00:00:00Z","2014-07-02T00:00:00Z","2014-07-03T00:00:00Z","2014-07-03T00:00:00Z","2014-07-05T00:00:00Z"],["2014-05-14T00:00:00Z","2014-05-14T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-02T00:00:00Z","2014-06-06T00:00:00Z","2014-06-02T00:00:00Z","2014-06-03T00:00:00Z","2014-06-27T00:00:00Z","2014-06-17T00:00:00Z","2014-06-07T00:00:00Z","2014-06-17T00:00:00Z",null,null,"2014-06-05T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-25T00:00:00Z","2014-07-01T00:00:00Z","2014-06-15T00:00:00Z","2014-05-30T00:00:00Z","2014-06-23T00:00:00Z",null,null,null,"2014-06-25T00:00:00Z","2014-06-19T00:00:00Z",null,"2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-26T00:00:00Z","2014-06-28T00:00:00Z","2014-07-08T00:00:00Z","2014-06-27T00:00:00Z","2014-06-30T00:00:00Z","2014-06-29T00:00:00Z",null,"2014-07-09T00:00:00Z","2014-07-14T00:00:00Z",null,"2014-07-14T00:00:00Z","2014-07-07T00:00:00Z","2014-07-17T00:00:00Z","2014-07-12T00:00:00Z"],["Death","Recover","Recover",null,"Recover","Recover","Recover",null,"Recover","Death","Recover","Recover","Death","Death","Death","Death","Death",null,"Recover","Recover","Recover",null,"Death","Death","Recover","Death","Death","Death",null,"Death","Recover","Recover","Recover","Death","Death","Death","Death","Death","Recover","Death",null,"Death","Recover","Recover","Recover","Death","Recover",null,"Recover","Recover"],["m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m"],["Central Hospital","Port Hospital","Other","Other","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Military Hospital",null,null,"Other","Other","Central Hospital","Port Hospital","Port Hospital","Port Hospital",null,"Military Hospital","Port Hospital",null,"Central Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Other","Military Hospital",null,"Military Hospital","Port Hospital","Military Hospital","Military Hospital",null,"Port Hospital","Port Hospital","Port Hospital","Port Hospital",null,"Port Hospital","St. Mark's Maternity Hospital (SMMH)","Port Hospital",null,null,"Military Hospital","Port Hospital","Port Hospital",null,null,"Port Hospital","Port Hospital",null],[-13.2330769474001,-13.2231931914572,-13.2122631729853,-13.2157351064963,-13.212910703914,-13.2523649449559,-13.2228638912441,-13.2143394209926,-13.262434315479,-13.2095352448865,-13.2129350506235,-13.2688968279886,-13.2243703238737,-13.2604684939726,-13.2628435102304,-13.248633850792,-13.2222002700958,-13.2164705932244,-13.2225511595637,-13.2393862117589,-13.2128924575825,-13.2242058657802,-13.2206286746001,-13.2270219251255,-13.220290675191,-13.2381754136412,-13.2183252570302,-13.253989309478,-13.217651519706,-13.2535215623253,-13.2625106957103,-13.2385127873491,-13.2243437095992,-13.2124311244169,-13.2265780018024,-13.2619688324425,-13.2093099826158,-13.2628934511971,-13.2116372005782,-13.2131457458534,-13.2083835761865,-13.2605169121171,-13.2289363806984,-13.2250089377786,-13.2130045468176,-13.2578516459532,-13.2397478783661,-13.2160657166043,-13.2593132020914,-13.2162953240809],[8.46002984141364,8.47325128269697,8.46838441895748,8.46897295100924,8.46481700596819,8.4601071493071,8.46082377490923,8.48932072596067,8.4850504403981,8.48100593467107,8.48331471166371,8.47845973648553,8.47024789713924,8.45421479878989,8.45524160975253,8.4778746413144,8.46388925014565,8.48666377289188,8.46191259217774,8.48677227640615,8.46852156267174,8.48663467687094,8.48401630165138,8.47745440981732,8.46524458864318,8.46964062310321,8.47967725011828,8.45837125340844,8.46236804334872,8.45884880725177,8.4794001484025,8.47761705512509,8.47145134147474,8.45344099552146,8.48676680560442,8.48475855218221,8.45415890802884,8.46479592922727,8.47084519753193,8.46397733703235,8.46320325007363,8.4562327469279,8.46886903678583,8.47404889511544,8.47135450705077,8.45196229052854,8.4867516707238,8.48802917129884,8.45810737927856,8.46395131808455],[null,"2ae019","2ae019","f547d6",null,"11f8ea","11f8ea",null,"7a9f33",null,"be7f8a","1511c5","53da57",null,"e11027","11f8ea",null,null,null,null,"374728","431135","996f3a","cbbe78",null,"7e95d1",null,"133ee7","ba7326","a2086d","ba1abc","37a6f6",null,"e61cb9",null,"057e7a",null,"4977bd","02d8fd","02d8fd","8b4c1c",null,null,"ab634e",null,"be502d",null,null,"c36eb4","ea3740"],[null,"other","other","other",null,"other","other",null,"other",null,"other","other","other",null,"other","other",null,null,null,null,"other","other","other","funeral",null,"other",null,"other","other","other","funeral","other",null,"other",null,"other",null,"funeral","other","other","other",null,null,"other",null,"other",null,null,"other","other"],["5","14","19","25","27","12","7","19","23","10","19","4","23","30","11","21","6","4","18","11","22","14","28","6","11","45","18","9","40","44","41","8","33","14","15","12","37","11","32","2","22","19","17","2","19","6","18","15","15","18"],[19,19,19,18,19,18,19,18,18,18,18,17,19,21,19,20,18,19,20,18,18,22,22,18,19,19,20,18,19,18,20,18,21,18,18,19,21,19,20,18,21,20,19,20,19,20,18,19,20,19],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],["yes","yes","yes","yes","yes",null,"yes","yes","yes","no","yes","no","yes","yes","yes","yes","no","yes","yes","no","no","no","no","no","no","yes","no","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes"],["no","no","no","no","no",null,"no","no","no","no","no","no","yes","yes","no","no","yes","no","no","no","no","no","no","no","no","yes","no","no",null,"yes","no","yes","no","no","yes","no","no","yes","no","no","yes","no","no","no","no","no","yes","no","yes","no"],["yes","yes","no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","no"],["no","no","yes","no","no",null,"no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no","yes","no","no","no","no","no",null,"no","no","no","yes","no","yes","no","no","no","no","no","yes","no","no","no","no","no","yes","no","no","no"],["no","no","yes","yes","yes",null,"no","no","yes","yes","no","yes","yes","no","no","yes","yes","no","no","yes","no","no","yes","yes","yes","yes","no","yes",null,"no","no","yes","yes","no","no","no","yes","no","no","yes","yes","yes","yes","no","yes","no","no","yes","no","yes"],["08:33","11:57","09:27","05:18","11:19","17:20","18:18",null,"12:18","08:11","15:41","11:60","11:18","12:36","08:41","10:19",null,null,"14:20","12:11","12:38",null,"07:27","17:23","09:46","16:30","14:25","08:38","16:42","10:30",null,"16:14","19:08","20:52","10:16","12:43","10:33","16:54","17:21","09:51","20:51","12:38","10:21","11:49","13:40","16:02","11:16",null,null,"03:36"],["under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header"],["under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header","under a merged header"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>row_num<\/th>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>ct_blood<\/th>\n      <th>age_unit<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>x25<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,2,10,11,15]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div id="rename-by-column-position" class="section level4" number="4.4.2.1">
<h4><span class="header-section-number">4.4.2.1</span> Rename by column position</h4>
<p>You can also rename by column position, instead of column name, for example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">rename</span>(<span class="dt">newNameForFirstColumn =</span> <span class="dv">1</span>,</span>
<span id="cb12-2"><a href="#cb12-2"></a>       <span class="dt">newNameForSecondColumn =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="empty-excel-column-names" class="section level4" number="4.4.2.2">
<h4><span class="header-section-number">4.4.2.2</span> Empty Excel column names</h4>
<p>If you importing an Excel sheet with a missing column name, depending on the import function used, R will likely create a column name with a value like “…1” or “…2”. You can clean these names manually by referencing their position number (see above), or their name (<code>linelist_raw$...1</code>).</p>
</div>
</div>
<div id="merged-excel-column-names" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Merged Excel column names</h3>
<p>Merged cells in an Excel file are a common occurrence when receiving data from field level. Merged cells can be nice for human reading of data, but cause many problems for machine reading of data. R cannot accommodate merged cells.</p>
<p>Remind people doing data entry that <strong>human-readable data is not the same as machine-readable data</strong>. Strive to train users about the princiles of <a href="https://r4ds.had.co.nz/tidy-data.html"><strong>tidy data</strong></a>. If at all possible, try to change procedures so that data arrive in a tidy format without merged cells.</p>
<ul>
<li>Each variable must have its own column.<br />
</li>
<li>Each observation must have its own row.<br />
</li>
<li>Each value must have its own cell.</li>
</ul>
<p>When using <strong>rio</strong>’s <code>import()</code> function, the value in a merged cell will be assigned to the first cell and subsequent cells will be empty.</p>
<p>One solution to deal with merged cells is to import the data with the function <code>readWorkbook()</code> from package <strong>openxlsx</strong>. Set the argument <code>fillMergedCells = TRUE</code>. This gives the value in a merged cell to all cells within the merge range.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>linelist_raw &lt;-<span class="st"> </span>openxlsx<span class="op">::</span><span class="kw">readWorkbook</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>, <span class="dt">fillMergedCells =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> If column names are merged, you will end up with duplicate column names, which you will need to fix manually - R does not work well with duplicate column names! You can re-name them by referencing their position (e.g. column 5), as explained in the section on manual column name cleaning..</span></p>
</div>
<div id="skip-import-of-rows" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Skip import of rows</h3>
<p>Sometimes, you may want to avoid importing a row of data (e.g. the column names, which are row 1).<br />
you can do this with the argument <code>skip =</code> if using <code>import()</code> from the <strong>rio</strong> package on a .xlsx or .csv file. Provide the number of rows you want to skip.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>linelist_raw &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>, <span class="dt">skip =</span> <span class="dv">1</span>)  <span class="co"># does not import header row</span></span></code></pre></div>
<p>Unfortunately <code>skip =</code> only accepts one integer value, <em>not</em> a range (e.g. “2:10”). To skip import of specific rows that are not consecutive from the top, consider importing multiple times and using <code>bind_rows()</code> from <strong>dplyr</strong>. See the example below of skipping only row 2.</p>
<div id="removing-a-second-header-row" class="section level4" number="4.4.4.1">
<h4><span class="header-section-number">4.4.4.1</span> Removing a second header row</h4>
<p>Your data may have a <em>second</em> row of data, for example if it is a “data dictionary” row (see example below).</p>
<div id="htmlwidget-94682754877dfbeb7c2f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-94682754877dfbeb7c2f">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["000","1","2","3","4"],["case identification number assigned by MOH","20b688","a3c8b8","72b905","5fe599"],["transmission chain generation number","3","4","4","4"],["estimated date of infection, mm/dd/yyyy",null,"2014-05-07","2014-05-06","2014-05-08"],["date of symptom onset, YYYY-MM-DD","15th April 2014","2014-05-08","2014-05-12","2014-05-13"],["date of initial hospitalization, mm/dd/yyyy","2014-05-06","2014-05-10","2014-05-13","2014-05-15"],["date of outcome status determination","2014-05-14","2014-05-14",null,null],["either 'Death' or 'Recovered' or 'Unknown'","Death","Recover","Recover",null],["either 'm' or 'f' or 'unknown'","m","m","m","m"],["Name of hospital of first admission","Central Hospital","Port Hospital","Other","Other"],["longitude of residence, approx","-13.2330769474001","-13.2231931914572","-13.2122631729853","-13.2157351064963"],["latitude of residence, approx","8.46002984141364","8.47325128269697","8.46838441895748","8.46897295100924"],["case_id of infector",null,"2ae019","2ae019","f547d6"],["context of known transmission event",null,"other","other","other"],["age number","5","14","19","25"],[null,"19","19","19","18"],["age unit, either 'years' or 'months' or 'days'","years","years","years","years"],["presence of fever on admission, either 'yes' or 'no'","yes","yes","yes","yes"],["presence of chills on admission, either 'yes' or 'no'","no","no","no","no"],["presence of cough on admission, either 'yes' or 'no'","yes","yes","no","yes"],["presence of aches on admission, either 'yes' or 'no'","no","no","yes","no"],["presence of vomiting on admission, either 'yes' or 'no'","no","no","yes","yes"],["time of hospital admission HH:MM","08:33","11:57","09:27","05:18"],[null,"under a merged header","under a merged header","under a merged header","under a merged header"],[null,"under a merged header","under a merged header","under a merged header","under a merged header"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>row_num<\/th>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>ct_blood<\/th>\n      <th>age_unit<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>x25<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>This situation can be problematic because it can result in all columns being imported as class “character”. To solve this, you will likely need to import the data twice.</p>
<ol style="list-style-type: decimal">
<li>Import the data in order to store the correct column names<br />
</li>
<li>Import the data again, skipping the first <em>two</em> rows (header and second rows)<br />
</li>
<li>Bind the correct names onto the reduced dataframe</li>
</ol>
<p>The exact arguments used to bind the correct column names depends on the type of data file (.csv, .tsv, .xlsx, etc.). If using <strong>rio</strong>’s <code>import()</code> function, understand which function <strong>rio</strong> uses to import your data, and then give the appropriate argument to skip lines and/or designate the column names. See the handbook page on importing data (LINK) for details on <strong>rio</strong>.</p>
<p><strong>For Excel files:</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># For excel files (remove 2nd row)</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>linelist_raw_names &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()  <span class="co"># save true column names</span></span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># import, skip row 2, assign to col_names =</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>linelist_raw &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>, <span class="dt">skip =</span> <span class="dv">2</span>, <span class="dt">col_names =</span> linelist_raw_names) </span></code></pre></div>
<p><strong>For CSV files:</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># For csv files</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>linelist_raw_names &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>() <span class="co"># save true column names</span></span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># note argument is &#39;col.names =&#39;</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>linelist_raw &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.csv&quot;</span>, <span class="dt">skip =</span> <span class="dv">2</span>, <span class="dt">col.names =</span> linelist_raw_names) </span></code></pre></div>
<p><strong>Backup option</strong> - changing column names as a separate command</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># assign/overwrite headers using the base &#39;colnames()&#39; function</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">colnames</span>(linelist_raw) &lt;-<span class="st"> </span>linelist_raw_names</span></code></pre></div>
<p>Bonus! If you do have a second row that is a data dictionary, you can easily create a proper data dictionary from it using the <code>gather()</code> command from the <strong>tidyr</strong> package.<br />
source: <a href="https://alison.rbind.io/post/2018-02-23-read-multiple-header-rows/" class="uri">https://alison.rbind.io/post/2018-02-23-read-multiple-header-rows/</a></p>
<p>TO DO</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb18-2"><a href="#cb18-2"></a>stickers_dict &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="st">  </span><span class="kw">gather</span>(variable_name, variable_description)</span>
<span id="cb18-5"><a href="#cb18-5"></a>stickers_dict</span></code></pre></div>
</div>
</div>
<div id="combine-two-header-rows" class="section level3" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> Combine two header rows</h3>
<p>In some cases, you may want to combine two header rows into one. This command will define the column names as the combination (pasting together) of the existing column names with the value underneath in the first row. Replace “df” with the name of your dataset.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">names</span>(df) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">names</span>(df), df[<span class="dv">1</span>, ], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="select-or-re-order-columns" class="section level2 tabset tabset-fade" number="4.5">
<h2><span class="header-section-number">4.5</span> Select or re-order columns</h2>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>Often the first step of cleaning data is selecting the columns you want to work with, and to set their order in the dataframe. In a <strong>dplyr</strong> chain of verbs, this is done with <code>select()</code>. <em>Note that in these examples we modify linelist with select(), but do not assign/overwrite. We just display the resulting new column names, for purpose of example.</em></p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> In the examples below, <code>linelist</code> is modified with <code>select()</code> but not over-written. New column names are only displayed for purpose of example.</span></p>
<p><strong>Here are all the column names in the linelist:</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">names</span>(linelist)</span></code></pre></div>
<pre><code>##  [1] &quot;row_num&quot;              &quot;case_id&quot;              &quot;generation&quot;          
##  [4] &quot;date_infection&quot;       &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
##  [7] &quot;date_outcome&quot;         &quot;outcome&quot;              &quot;gender&quot;              
## [10] &quot;hospital&quot;             &quot;lon&quot;                  &quot;lat&quot;                 
## [13] &quot;infector&quot;             &quot;source&quot;               &quot;age&quot;                 
## [16] &quot;ct_blood&quot;             &quot;age_unit&quot;             &quot;fever&quot;               
## [19] &quot;chills&quot;               &quot;cough&quot;                &quot;aches&quot;               
## [22] &quot;vomit&quot;                &quot;time_admission&quot;       &quot;merged_header&quot;       
## [25] &quot;x25&quot;</code></pre>
<div id="select-re-order" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Select &amp; re-order</h3>
<p><strong>Select only the columns you want to remain, <em>and their order of appearance</em></strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># linelist dataset is piped through select() command, and names() prints just the column names</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">select</span>(case_id, date_onset, date_hospitalisation, fever) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="st">  </span><span class="kw">names</span>() <span class="co"># display the column names</span></span></code></pre></div>
<pre><code>## [1] &quot;case_id&quot;              &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
## [4] &quot;fever&quot;</code></pre>
<p><strong>Indicate which columns to remove</strong> by placing a minus symbol “-” in front of the column name (e.g. <code>select(-outcome)</code>), or a vector of column names (as below). All other columns will be retained. Inside <code>select()</code> you can use normal operators such as <code>c()</code> to list several columns, <code>:</code> for consecutive columns, <code>!</code> for opposite, <code>&amp;</code> for AND, and <code>|</code> for OR.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(date_onset, fever<span class="op">:</span>vomit)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove onset and all symptom columns</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="st">  </span><span class="kw">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;row_num&quot;              &quot;case_id&quot;              &quot;generation&quot;          
##  [4] &quot;date_infection&quot;       &quot;date_hospitalisation&quot; &quot;date_outcome&quot;        
##  [7] &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;            
## [10] &quot;lon&quot;                  &quot;lat&quot;                  &quot;infector&quot;            
## [13] &quot;source&quot;               &quot;age&quot;                  &quot;ct_blood&quot;            
## [16] &quot;age_unit&quot;             &quot;time_admission&quot;       &quot;merged_header&quot;       
## [19] &quot;x25&quot;</code></pre>
<p><strong>Re-order the columns</strong> - use <code>everything()</code> to signify all other columns not specified in the <code>select()</code> command:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># move case_id, date_onset, date_hospitalisation, and gender to beginning</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="st">  </span><span class="kw">select</span>(case_id, date_onset, date_hospitalisation, gender, <span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="st">  </span><span class="kw">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;              &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
##  [4] &quot;gender&quot;               &quot;row_num&quot;              &quot;generation&quot;          
##  [7] &quot;date_infection&quot;       &quot;date_outcome&quot;         &quot;outcome&quot;             
## [10] &quot;hospital&quot;             &quot;lon&quot;                  &quot;lat&quot;                 
## [13] &quot;infector&quot;             &quot;source&quot;               &quot;age&quot;                 
## [16] &quot;ct_blood&quot;             &quot;age_unit&quot;             &quot;fever&quot;               
## [19] &quot;chills&quot;               &quot;cough&quot;                &quot;aches&quot;               
## [22] &quot;vomit&quot;                &quot;time_admission&quot;       &quot;merged_header&quot;       
## [25] &quot;x25&quot;</code></pre>
<p>As well as <code>everything()</code> there are several special functions that work <em>within</em> <code>select()</code>, namely:</p>
<ul>
<li><code>everything()</code> - all other columns not mentioned<br />
</li>
<li><code>last_col()</code> - the last column<br />
</li>
<li><code>where()</code> - applies a function to all columns and selects those which are TRUE<br />
</li>
<li><code>starts_with()</code> - matches to a specified prefix. Example: <code>select(starts_with("date"))</code></li>
<li><code>ends_with()</code> - matches to a specified suffix. Example: <code>select(ends_with("_end"))</code><br />
</li>
<li><code>contains()</code> - columns containing a character string. Example: <code>select(contains("time"))</code></li>
<li><code>matches()</code> - to apply a regular expression (regex). Example: <code>select(contains("[pt]al"))</code><br />
</li>
<li><code>num_range()</code> -</li>
<li><code>any_of()</code> - matches if column is named. Useful if the name might not exist. Example: <code>select(any_of(date_onset, date_death, cardiac_arrest))</code></li>
</ul>
<p>Here is an example using <code>where()</code>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># select columns containing certain characters</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="st">  </span><span class="kw">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_infection&quot;       &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
## [4] &quot;date_outcome&quot;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># searched for multiple character matches</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;onset|hosp|fev&quot;</span>)) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># note the OR symbol &quot;|&quot;</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="st">  </span><span class="kw">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;hospital&quot;            
## [4] &quot;fever&quot;</code></pre>
</div>
<div id="select-as-a-stand-alone-command" class="section level3" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> <code>select()</code> as a stand-alone command</h3>
<p>Select can also be used as an independent command (not in a pipe chain). In this case, the first argument is the original dataframe to be operated upon.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Create a new linelist with id and age-related columns</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>linelist_age &lt;-<span class="st"> </span><span class="kw">select</span>(linelist, case_id, <span class="kw">contains</span>(<span class="st">&quot;age&quot;</span>))</span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co"># display the column names</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="kw">names</span>(linelist_age)</span></code></pre></div>
<pre><code>## [1] &quot;case_id&quot;  &quot;age&quot;      &quot;age_unit&quot;</code></pre>
</div>
<div id="add-to-the-pipe-chain" class="section level3" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Add to the pipe chain</h3>
<p>In the linelist, there are a few columns we do not need: <code>row_num</code>, <code>merged_header</code>, and <code>x25</code>. Remove them by adding a <code>select()</code> command to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">##################################################################################</span></span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">###########################</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">    </span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="st">    </span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb34-14"><a href="#cb34-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb34-15"><a href="#cb34-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="st">    </span></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb34-18"><a href="#cb34-18"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="Classes" class="section level2 tabset tabset-fade" number="4.6">
<h2><span class="header-section-number">4.6</span> Modify class</h2>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>See section on <a href="#objectclasses">object classes</a></p>
<p>Often you will need to set the correct class for a column. The most common approach is to use <code>mutate()</code> to define the column as itself, but with a different class. Generally, this looks like this:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Examples of modifying class</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_var      =</span> <span class="kw">as.Date</span>(date_var, <span class="dt">format =</span> <span class="st">&quot;MM/DD/YYYY&quot;</span>),  <span class="co"># format should be the format of the raw data</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>         <span class="dt">numeric_var   =</span> <span class="kw">as.numeric</span>(numeric_var),</span>
<span id="cb35-5"><a href="#cb35-5"></a>         <span class="dt">character_var =</span> <span class="kw">as.character</span>(character_var),</span>
<span id="cb35-6"><a href="#cb35-6"></a>         <span class="dt">factor_var    =</span> <span class="kw">factor</span>(factor_var, <span class="dt">levels =</span> <span class="kw">c</span>(), <span class="dt">labels =</span> <span class="kw">c</span>())</span>
<span id="cb35-7"><a href="#cb35-7"></a>         )</span></code></pre></div>
<div id="pre-checks-and-errors" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Pre-checks and errors</h3>
<p>First we run some checks on the classes of important columns.</p>
<p>The class of the “age” column is character. To perform analysis, we need those numbers to be recognized as numeric!</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">class</span>(linelist<span class="op">$</span>age)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>The class of the “date_onset” column is also character! To perform analysis, these dates must be recognized as dates!</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">class</span>(linelist<span class="op">$</span>date_onset)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>However, if we try to classify the <code>date_onset</code> column as date, we would get an error. Use <code>table()</code> or <em>sort</em> or another method to examine all the values and identify different one. For example in our dataset we see that we see that one <code>date_onset</code> value was entered in a different format (15th April 2014) than all the other values!</p>
<pre><code>## 
## 15th April 2014      2012-05-03      2012-05-06      2012-05-08      2012-05-16 
##               1               1               1               1               1 
##      2012-05-21 
##               1</code></pre>
<p>Before we can classify “date_onset” as a date, this value must be fixed to be the same format as the others. You can fix the date in the source data, or, we can do in the cleaning pipeline via <code>mutate()</code> and <code>recode()</code>. This must be done <em>before</em> the commands to convert to class Date. (LINK TO DATE SECTION).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>))</span></code></pre></div>
<p>The <code>mutate()</code> line can be read as: “mutate date_onset to equal date_onset recoded so that OLD VALUE is changed to NEW VALUE”. Note that this pattern (OLD = NEW) for <code>recode()</code> is the opposite of most R patterns (new = old). The R development community is working on revising this for recoding.</p>
<p>Especially after converting to class date, check your data visually or with <code>table()</code> to confirm that they were converted correctly! For <code>as.Date()</code>, the <code>format =</code> argument is often a source of errors.</p>
</div>
<div id="modify-multiple-columns" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Modify multiple columns</h3>
<p>You can use The <strong>dplyr</strong> function <code>across()</code> with <code>mutate()</code> to convert several columns at once to a new class. <code>across()</code> allows you to specify which columns you want a function to apply to. Below, we want to mutate the columns where <code>is.POSIXct()</code> (a type of date/time class that shows unnecessary timestamps) is <code>TRUE</code>, and apply the function <code>is.Date()</code> to them, in order to convert them to class “date”.</p>
<ul>
<li>Note that within <code>across()</code> we also use the function <code>where()</code>.<br />
</li>
<li>Note that is.POSIXct is from the package <strong>lubridate</strong>. Other similar functions (<code>is.character()</code>, <code>is.numeric()</code>, and <code>is.logical()</code>) are from <strong>base R</strong><br />
</li>
<li>Note that the functions in <code>across()</code> are written <em>without</em> the empty parentheses ()</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(lubridate<span class="op">::</span>is.POSIXct), as.Date))</span></code></pre></div>
<p><strong>Below, the described cleaning steps are added to the pipe chain.</strong></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co">##################################################################################</span></span>
<span id="cb43-3"><a href="#cb43-3"></a></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="co">###########################</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="st">    </span></span>
<span id="cb43-8"><a href="#cb43-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb43-9"><a href="#cb43-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="st">    </span></span>
<span id="cb43-11"><a href="#cb43-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb43-12"><a href="#cb43-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb43-13"><a href="#cb43-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb43-14"><a href="#cb43-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb43-15"><a href="#cb43-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-16"><a href="#cb43-16"></a><span class="st">  </span></span>
<span id="cb43-17"><a href="#cb43-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb43-18"><a href="#cb43-18"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-19"><a href="#cb43-19"></a></span>
<span id="cb43-20"><a href="#cb43-20"></a><span class="st">  </span></span>
<span id="cb43-21"><a href="#cb43-21"></a><span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb43-22"><a href="#cb43-22"></a><span class="st">  </span><span class="co">###################################################</span></span>
<span id="cb43-23"><a href="#cb43-23"></a></span>
<span id="cb43-24"><a href="#cb43-24"></a><span class="st">    </span><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb43-25"><a href="#cb43-25"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-26"><a href="#cb43-26"></a><span class="st">  </span></span>
<span id="cb43-27"><a href="#cb43-27"></a><span class="st">    </span><span class="co"># correct the class of the columns</span></span>
<span id="cb43-28"><a href="#cb43-28"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb43-29"><a href="#cb43-29"></a>           <span class="dt">generation =</span> <span class="kw">as.numeric</span>(generation),</span>
<span id="cb43-30"><a href="#cb43-30"></a>           <span class="dt">age        =</span> <span class="kw">as.numeric</span>(age)) </span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="add-columns-and-rows" class="section level2 tabset tabset-fade" number="4.7">
<h2><span class="header-section-number">4.7</span> Add columns and rows</h2>
<p>See the tabs below to add columns and rows</p>
<!-- ======================================================= -->
<div id="add-columns" class="section level3 tabset tabset-fade" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Add columns</h3>
<div id="mutate" class="section level4" number="4.7.1.1">
<h4><span class="header-section-number">4.7.1.1</span> <code>mutate()</code></h4>
<p>We advise creating new columns with <strong>dplyr</strong> functions as part of a chain of such verb functions (e.g. filter, mutate, etc.)<br />
If in need of a stand-alone command, you can use <code>mutate()</code> or the <strong>base</strong> R style to create a new column (see below).</p>
<p><strong>The verb <code>mutate()</code> is used to add a new column, or to modify an existing one.</strong> Below is an example of creating a new columns with <code>mutate()</code>. The syntax is: <strong>new_column_name = value or function</strong>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">days_onset_hosp =</span> <span class="kw">as.numeric</span>(date_hospitalisation <span class="op">-</span><span class="st"> </span>date_onset))</span></code></pre></div>
<p>It is best practice to separate each new column with a comma and new line. Below, some practice columns are created:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st">                       </span><span class="co"># creating new, or modifying old dataset</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">new_var_dup    =</span> case_id,             <span class="co"># new column = duplicate/copy another column</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>         <span class="dt">new_var_static =</span> <span class="dv">7</span>,                   <span class="co"># new column = all values the same</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>         <span class="dt">new_var_static =</span> new_var_static <span class="op">+</span><span class="st"> </span><span class="dv">5</span>,  <span class="co"># you can overwrite a column, and it can be a calculation using other variables</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>         <span class="dt">new_var_paste  =</span> stringr<span class="op">::</span><span class="kw">str_glue</span>(<span class="st">&quot;{hospital} on ({date_hospitalisation})&quot;</span>) <span class="co"># new column = pasting together values from other columns</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>         ) </span></code></pre></div>
<p><strong><em>Scroll to the right to see the new columns (first 50 rows):</em></strong></p>
<div id="htmlwidget-4c419e51673b06092f88" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c419e51673b06092f88">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"10\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1403827200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1.39752e+12\" data-max=\"1404345600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1404518400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1405555200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2688968279886\" data-max=\"-13.2083835761865\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45196229052854\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"45\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"17\" data-max=\"22\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"21\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["20b688","a3c8b8","72b905","5fe599","11f8ea","f96aa5","893f25","c4e706","47a5f5","9e0998","566f9e","acf422","ce9c02","1a4ac9","5387a2","db4b96","8a4580","dbebea","f393b4","30c98c","788a99","9f6884","2978ac","60f0c2","50adde","6fa4bf","d6f195","57a565","4cff96","be502d","9ae2d7","fc15ef","c97dd9","02d8fd","2ebf95","c36eb4","88a4e0","542d07","9e74c4","ae96ac","589e9f","341efa","f86ce2","99e8fa","bc648d","ec8ee4","ab78c0","567136","c62127","b799eb"],[3,4,4,4,2,3,3,5,3,4,3,6,5,6,4,3,4,7,4,3,5,4,4,7,6,5,4,4,6,5,5,6,9,9,6,8,6,5,10,10,9,9,9,7,9,6,8,6,9,5],[null,"2014-05-07","2014-05-06","2014-05-08",null,"2014-05-17","2014-05-18",null,"2014-05-03",null,"2014-05-24","2014-05-25","2014-05-27",null,"2014-05-26","2014-05-16",null,null,null,null,"2014-06-01","2014-06-02","2014-05-30","2014-06-04",null,"2014-06-05",null,"2014-05-28","2014-06-05","2014-06-09","2014-06-12","2014-06-14",null,"2014-06-14",null,"2014-06-15",null,"2014-06-10","2014-06-20","2014-06-20","2014-06-11",null,null,"2014-06-24",null,"2014-06-15",null,null,"2014-06-20","2014-06-27"],["2014-04-15","2014-05-08","2014-05-12","2014-05-13","2014-05-16","2014-05-19","2014-05-21","2014-05-23","2014-05-26","2014-05-26","2014-05-27","2014-05-27","2014-05-27","2014-05-27","2014-05-31","2014-05-31","2014-06-02","2014-06-02","2014-06-05","2014-06-06","2014-06-06","2014-06-07","2014-06-06","2014-06-07","2014-06-09","2014-06-10","2014-06-10","2014-06-13","2014-06-15","2014-06-15","2014-06-16","2014-06-16","2014-06-19","2014-06-20","2014-06-19","2014-06-20","2014-06-22","2014-06-22","2014-06-22","2014-06-25","2014-06-24","2014-06-24","2014-06-26","2014-06-28","2014-06-30","2014-06-30","2014-07-02","2014-07-02","2014-07-02","2014-07-03"],["2014-05-06","2014-05-10","2014-05-13","2014-05-15","2014-05-18","2014-05-20","2014-05-22","2014-05-24","2014-05-26","2014-05-27","2014-05-28","2014-05-28","2014-05-29","2014-05-29","2014-05-31","2014-06-01","2014-06-02","2014-06-03","2014-06-06","2014-06-06","2014-06-07","2014-06-07","2014-06-08","2014-06-08","2014-06-10","2014-06-11","2014-06-12","2014-06-15","2014-06-16","2014-06-16","2014-06-16","2014-06-17","2014-06-19","2014-06-20","2014-06-21","2014-06-21","2014-06-23","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-26","2014-06-26","2014-06-29","2014-07-02","2014-07-02","2014-07-02","2014-07-03","2014-07-03","2014-07-05"],["2014-05-14","2014-05-14",null,null,"2014-05-30","2014-05-23","2014-05-29","2014-06-02","2014-06-06","2014-06-02","2014-06-03","2014-06-27","2014-06-17","2014-06-07","2014-06-17",null,null,"2014-06-05","2014-06-18","2014-06-09","2014-06-25","2014-07-01","2014-06-15","2014-05-30","2014-06-23",null,null,null,"2014-06-25","2014-06-19",null,"2014-07-09","2014-07-11","2014-07-01","2014-06-23","2014-06-24","2014-06-26","2014-06-28","2014-07-08","2014-06-27","2014-06-30","2014-06-29",null,"2014-07-09","2014-07-14",null,"2014-07-14","2014-07-07","2014-07-17","2014-07-12"],["Death","Recover","Recover",null,"Recover","Recover","Recover",null,"Recover","Death","Recover","Recover","Death","Death","Death","Death","Death",null,"Recover","Recover","Recover",null,"Death","Death","Recover","Death","Death","Death",null,"Death","Recover","Recover","Recover","Death","Death","Death","Death","Death","Recover","Death",null,"Death","Recover","Recover","Recover","Death","Recover",null,"Recover","Recover"],["m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m"],["Central Hospital","Port Hospital","Other","Other","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Military Hospital",null,null,"Other","Other","Central Hospital","Port Hospital","Port Hospital","Port Hospital",null,"Military Hospital","Port Hospital",null,"Central Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Other","Military Hospital",null,"Military Hospital","Port Hospital","Military Hospital","Military Hospital",null,"Port Hospital","Port Hospital","Port Hospital","Port Hospital",null,"Port Hospital","St. Mark's Maternity Hospital (SMMH)","Port Hospital",null,null,"Military Hospital","Port Hospital","Port Hospital",null,null,"Port Hospital","Port Hospital",null],[-13.2330769474001,-13.2231931914572,-13.2122631729853,-13.2157351064963,-13.212910703914,-13.2523649449559,-13.2228638912441,-13.2143394209926,-13.262434315479,-13.2095352448865,-13.2129350506235,-13.2688968279886,-13.2243703238737,-13.2604684939726,-13.2628435102304,-13.248633850792,-13.2222002700958,-13.2164705932244,-13.2225511595637,-13.2393862117589,-13.2128924575825,-13.2242058657802,-13.2206286746001,-13.2270219251255,-13.220290675191,-13.2381754136412,-13.2183252570302,-13.253989309478,-13.217651519706,-13.2535215623253,-13.2625106957103,-13.2385127873491,-13.2243437095992,-13.2124311244169,-13.2265780018024,-13.2619688324425,-13.2093099826158,-13.2628934511971,-13.2116372005782,-13.2131457458534,-13.2083835761865,-13.2605169121171,-13.2289363806984,-13.2250089377786,-13.2130045468176,-13.2578516459532,-13.2397478783661,-13.2160657166043,-13.2593132020914,-13.2162953240809],[8.46002984141364,8.47325128269697,8.46838441895748,8.46897295100924,8.46481700596819,8.4601071493071,8.46082377490923,8.48932072596067,8.4850504403981,8.48100593467107,8.48331471166371,8.47845973648553,8.47024789713924,8.45421479878989,8.45524160975253,8.4778746413144,8.46388925014565,8.48666377289188,8.46191259217774,8.48677227640615,8.46852156267174,8.48663467687094,8.48401630165138,8.47745440981732,8.46524458864318,8.46964062310321,8.47967725011828,8.45837125340844,8.46236804334872,8.45884880725177,8.4794001484025,8.47761705512509,8.47145134147474,8.45344099552146,8.48676680560442,8.48475855218221,8.45415890802884,8.46479592922727,8.47084519753193,8.46397733703235,8.46320325007363,8.4562327469279,8.46886903678583,8.47404889511544,8.47135450705077,8.45196229052854,8.4867516707238,8.48802917129884,8.45810737927856,8.46395131808455],[null,"2ae019","2ae019","f547d6",null,"11f8ea","11f8ea",null,"7a9f33",null,"be7f8a","1511c5","53da57",null,"e11027","11f8ea",null,null,null,null,"374728","431135","996f3a","cbbe78",null,"7e95d1",null,"133ee7","ba7326","a2086d","ba1abc","37a6f6",null,"e61cb9",null,"057e7a",null,"4977bd","02d8fd","02d8fd","8b4c1c",null,null,"ab634e",null,"be502d",null,null,"c36eb4","ea3740"],[null,"other","other","other",null,"other","other",null,"other",null,"other","other","other",null,"other","other",null,null,null,null,"other","other","other","funeral",null,"other",null,"other","other","other","funeral","other",null,"other",null,"other",null,"funeral","other","other","other",null,null,"other",null,"other",null,null,"other","other"],[5,14,19,25,27,12,7,19,23,10,19,4,23,30,11,21,6,4,18,11,22,14,28,6,11,45,18,9,40,44,41,8,33,14,15,12,37,11,32,2,22,19,17,2,19,6,18,15,15,18],[19,19,19,18,19,18,19,18,18,18,18,17,19,21,19,20,18,19,20,18,18,22,22,18,19,19,20,18,19,18,20,18,21,18,18,19,21,19,20,18,21,20,19,20,19,20,18,19,20,19],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],["yes","yes","yes","yes","yes",null,"yes","yes","yes","no","yes","no","yes","yes","yes","yes","no","yes","yes","no","no","no","no","no","no","yes","no","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes"],["no","no","no","no","no",null,"no","no","no","no","no","no","yes","yes","no","no","yes","no","no","no","no","no","no","no","no","yes","no","no",null,"yes","no","yes","no","no","yes","no","no","yes","no","no","yes","no","no","no","no","no","yes","no","yes","no"],["yes","yes","no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","no"],["no","no","yes","no","no",null,"no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no","yes","no","no","no","no","no",null,"no","no","no","yes","no","yes","no","no","no","no","no","yes","no","no","no","no","no","yes","no","no","no"],["no","no","yes","yes","yes",null,"no","no","yes","yes","no","yes","yes","no","no","yes","yes","no","no","yes","no","no","yes","yes","yes","yes","no","yes",null,"no","no","yes","yes","no","no","no","yes","no","no","yes","yes","yes","yes","no","yes","no","no","yes","no","yes"],["08:33","11:57","09:27","05:18","11:19","17:20","18:18",null,"12:18","08:11","15:41","11:60","11:18","12:36","08:41","10:19",null,null,"14:20","12:11","12:38",null,"07:27","17:23","09:46","16:30","14:25","08:38","16:42","10:30",null,"16:14","19:08","20:52","10:16","12:43","10:33","16:54","17:21","09:51","20:51","12:38","10:21","11:49","13:40","16:02","11:16",null,null,"03:36"],[21,2,1,2,2,1,1,1,0,1,1,1,2,2,0,1,0,1,1,0,1,0,2,1,1,1,2,2,1,1,0,1,0,0,2,1,1,1,2,0,2,2,0,1,2,2,0,1,1,2],["20b688","a3c8b8","72b905","5fe599","11f8ea","f96aa5","893f25","c4e706","47a5f5","9e0998","566f9e","acf422","ce9c02","1a4ac9","5387a2","db4b96","8a4580","dbebea","f393b4","30c98c","788a99","9f6884","2978ac","60f0c2","50adde","6fa4bf","d6f195","57a565","4cff96","be502d","9ae2d7","fc15ef","c97dd9","02d8fd","2ebf95","c36eb4","88a4e0","542d07","9e74c4","ae96ac","589e9f","341efa","f86ce2","99e8fa","bc648d","ec8ee4","ab78c0","567136","c62127","b799eb"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["Central Hospital on (2014-05-06)","Port Hospital on (2014-05-10)","Other on (2014-05-13)","Other on (2014-05-15)","St. Mark's Maternity Hospital (SMMH) on (2014-05-18)","St. Mark's Maternity Hospital (SMMH) on (2014-05-20)","Military Hospital on (2014-05-22)","NA on (2014-05-24)","NA on (2014-05-26)","Other on (2014-05-27)","Other on (2014-05-28)","Central Hospital on (2014-05-28)","Port Hospital on (2014-05-29)","Port Hospital on (2014-05-29)","Port Hospital on (2014-05-31)","NA on (2014-06-01)","Military Hospital on (2014-06-02)","Port Hospital on (2014-06-03)","NA on (2014-06-06)","Central Hospital on (2014-06-06)","Port Hospital on (2014-06-07)","Port Hospital on (2014-06-07)","Port Hospital on (2014-06-08)","Port Hospital on (2014-06-08)","Other on (2014-06-10)","Military Hospital on (2014-06-11)","NA on (2014-06-12)","Military Hospital on (2014-06-15)","Port Hospital on (2014-06-16)","Military Hospital on (2014-06-16)","Military Hospital on (2014-06-16)","NA on (2014-06-17)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-20)","Port Hospital on (2014-06-21)","Port Hospital on (2014-06-21)","NA on (2014-06-23)","Port Hospital on (2014-06-23)","St. Mark's Maternity Hospital (SMMH) on (2014-06-24)","Port Hospital on (2014-06-25)","NA on (2014-06-26)","NA on (2014-06-26)","Military Hospital on (2014-06-26)","Port Hospital on (2014-06-29)","Port Hospital on (2014-07-02)","NA on (2014-07-02)","NA on (2014-07-02)","Port Hospital on (2014-07-03)","Port Hospital on (2014-07-03)","NA on (2014-07-05)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>ct_blood<\/th>\n      <th>age_unit<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>time_admission<\/th>\n      <th>days_onset_hosp<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,14,22,24]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> The verb <code>transmute()</code> adds new columns just like <code>mutate()</code> but also drops/removes all other columns that you do not mention.</span></p>
</div>
<div id="new-columns-using-base-r" class="section level4" number="4.7.1.2">
<h4><span class="header-section-number">4.7.1.2</span> New columns using <strong>base</strong> R</h4>
<p>To define a new column (or re-define a column) using <strong>base</strong> R, just use the assignment operator as below.
Remember that when using <strong>base</strong> R you must specify the dataframe before writing the column name (e.g. <code>dataframe$column</code>). Here are two dummy examples:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>linelist<span class="op">$</span>old_var &lt;-<span class="st"> </span>linelist<span class="op">$</span>old_var <span class="op">+</span><span class="st"> </span><span class="dv">7</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>linelist<span class="op">$</span>new_var &lt;-<span class="st"> </span>linelist<span class="op">$</span>old_var <span class="op">+</span><span class="st"> </span>linelist<span class="op">$</span>age</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="add-rows" class="section level3" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Add rows</h3>
<p>TO DO</p>
<p>Remember that each column must contain values of only one class (either character, numeric, logical, etc.). So adding a row requires nuance to maintain this.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="st">  </span><span class="kw">add_row</span>(<span class="dt">row_num =</span> <span class="dv">666</span>, <span class="dt">case_id =</span> <span class="st">&quot;abc&quot;</span>, <span class="dt">generation =</span> <span class="dv">4</span>, <span class="st">`</span><span class="dt">infection date</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-10-10&quot;</span>), <span class="dt">.before =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>use .before and .after. .before = 3 will put it before the 3rd row. Default is to add it to the end. columns not specified will be let empty.
The new row number may look strange (“…23”) but the row numbers have changed. So if using the command twice examine/test carefully.</p>
<p>If your class is off you will see an error like this: Error: Can’t combine <code>..1$infection date</code> <date> and <code>..2$infection date</code> <character>.
(for a date value remember to wrap the date in the function<code>as.Date()</code> like <code>as.Date("2020-10-10")</code>)</p>
</div>
<div id="new-columns-using-grouped-values" class="section level3" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> New columns using grouped values</h3>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>Using mutate on GROUPED dataframes
<a href="https://dplyr.tidyverse.org/reference/mutate.html" class="uri">https://dplyr.tidyverse.org/reference/mutate.html</a></p>
<p>Taken from website above:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co">#Because mutating expressions are computed within groups, they may yield different results on grouped tibbles. This will be the case as #soon as an aggregating, lagging, or ranking function is involved. Compare this ungrouped mutate:</span></span>
<span id="cb48-2"><a href="#cb48-2"></a></span>
<span id="cb48-3"><a href="#cb48-3"></a>starwars <span class="op">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="st">  </span><span class="kw">select</span>(name, mass, species) <span class="op">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_norm =</span> mass <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(mass, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb48-6"><a href="#cb48-6"></a>With the grouped equivalent<span class="op">:</span></span>
<span id="cb48-7"><a href="#cb48-7"></a></span>
<span id="cb48-8"><a href="#cb48-8"></a>starwars <span class="op">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9"></a><span class="st">  </span><span class="kw">select</span>(name, mass, species) <span class="op">%&gt;%</span></span>
<span id="cb48-10"><a href="#cb48-10"></a><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_norm =</span> mass <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(mass, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb48-12"><a href="#cb48-12"></a>The former normalises mass by the global average whereas the latter normalises by the averages within species levels.</span></code></pre></div>
</div>
<div id="add-to-pipe-chain" class="section level3" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> Add to pipe chain</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co">##################################################################################</span></span>
<span id="cb49-3"><a href="#cb49-3"></a></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co">###########################</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="st">    </span></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb49-9"><a href="#cb49-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-10"><a href="#cb49-10"></a><span class="st">    </span></span>
<span id="cb49-11"><a href="#cb49-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb49-12"><a href="#cb49-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb49-13"><a href="#cb49-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb49-14"><a href="#cb49-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb49-15"><a href="#cb49-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-16"><a href="#cb49-16"></a><span class="st">  </span></span>
<span id="cb49-17"><a href="#cb49-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb49-18"><a href="#cb49-18"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-19"><a href="#cb49-19"></a></span>
<span id="cb49-20"><a href="#cb49-20"></a><span class="st">    </span><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb49-21"><a href="#cb49-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-22"><a href="#cb49-22"></a><span class="st">    </span></span>
<span id="cb49-23"><a href="#cb49-23"></a><span class="st">    </span><span class="co"># correct the class of the columns</span></span>
<span id="cb49-24"><a href="#cb49-24"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb49-25"><a href="#cb49-25"></a>           <span class="dt">generation =</span> <span class="kw">as.numeric</span>(generation),</span>
<span id="cb49-26"><a href="#cb49-26"></a>           <span class="dt">age        =</span> <span class="kw">as.numeric</span>(age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-27"><a href="#cb49-27"></a></span>
<span id="cb49-28"><a href="#cb49-28"></a><span class="st">  </span><span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb49-29"><a href="#cb49-29"></a><span class="st">  </span><span class="co">###################################################</span></span>
<span id="cb49-30"><a href="#cb49-30"></a></span>
<span id="cb49-31"><a href="#cb49-31"></a><span class="st">  </span><span class="co"># create column: delay to hospitalisation</span></span>
<span id="cb49-32"><a href="#cb49-32"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">days_onset_hosp =</span> <span class="kw">as.numeric</span>(date_hospitalisation <span class="op">-</span><span class="st"> </span>date_onset))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="recode" class="section level2 tabset tabset-fade" number="4.8">
<h2><span class="header-section-number">4.8</span> Recoding values</h2>
<p>For example, in <code>linelist</code> the values in the column “hospital” must be cleaned. There are several different spellings (often the word “Hospital” is missing an “s” and is written “Hopital”), and many missing values.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">table</span>(linelist<span class="op">$</span>hospital, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##                      Central Hopital                     Central Hospital 
##                                   11                                  451 
##                           Hospital A                           Hospital B 
##                                  290                                  289 
##                     Military Hopital                    Military Hospital 
##                                   30                                  805 
##                     Mitylira Hopital                    Mitylira Hospital 
##                                    1                                   81 
##                                Other                         Port Hopital 
##                                  904                                   47 
##                        Port Hospital St. Mark&#39;s Maternity Hospital (SMMH) 
##                                 1770                                  418 
##   St. Marks Maternity Hopital (SMMH)                                 &lt;NA&gt; 
##                                   11                                 1501</code></pre>
<!-- ======================================================= -->
<div id="manual-recoding" class="section level3 tabset tabset-fade" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> Manual recoding</h3>
<p>These tabs demonstrate re-coding values manually b providing specific spellings to be corrected:</p>
<ul>
<li>Using <code>replace()</code> for specific rows<br />
</li>
<li>Using <code>recode()</code> for entire columns<br />
</li>
<li>Using <strong>base</strong> R</li>
</ul>
<div id="replace" class="section level4" number="4.8.1.1">
<h4><span class="header-section-number">4.8.1.1</span> <code>replace()</code></h4>
<p>To manually change values for specific rows within a dataframe (from within a pipe chain), use <code>replace()</code> within <code>mutate()</code>.<br />
Use a logic condition to specify rows, for example an ID value of one row. The general syntax is:</p>
<p><code>mutate(col_to_change = replace(col_to_change, criteria for rows, new value))</code>.</p>
<p>In the first example below, the gender value, in the row where id is “2195”, is changed to “Female”.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Example: change gender of one specific observation to &quot;Female&quot; </span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">replace</span>(gender, id <span class="op">==</span><span class="st"> &quot;2195&quot;</span>, <span class="st">&quot;Female&quot;</span>)</span>
<span id="cb52-3"><a href="#cb52-3"></a></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="co"># Example: chance gender of one specific observation to NA </span></span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">replace</span>(gender, id <span class="op">==</span><span class="st"> &quot;2195&quot;</span>, <span class="ot">NA</span>)</span></code></pre></div>
</div>
<div id="recode-1" class="section level4" number="4.8.1.2">
<h4><span class="header-section-number">4.8.1.2</span> <code>recode()</code></h4>
<p>To change spellings manually, one-by-one, you can use the <code>recode()</code> function *within the <code>mutate()</code> function. The code is saying that the column “hospital” should be defined as the current column “hospital”, but with certain changes (the syntax is OLD = NEW). <strong>Don’t forget commas!</strong></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">recode</span>(hospital,</span>
<span id="cb53-3"><a href="#cb53-3"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb53-5"><a href="#cb53-5"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb53-6"><a href="#cb53-6"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb53-7"><a href="#cb53-7"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      =<span class="st"> &quot;Port Hospital&quot;</span>,</span>
<span id="cb53-8"><a href="#cb53-8"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   =<span class="st"> &quot;Central Hospital&quot;</span>,</span>
<span id="cb53-9"><a href="#cb53-9"></a>                      <span class="st">&quot;other&quot;</span>             =<span class="st"> &quot;Other&quot;</span>,</span>
<span id="cb53-10"><a href="#cb53-10"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> =<span class="st"> &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb53-11"><a href="#cb53-11"></a>                      ))</span></code></pre></div>
<p>Now we see the values in the <code>hospital</code> column have been corrected:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">table</span>(linelist<span class="op">$</span>hospital, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##                     Central Hospital                           Hospital A 
##                                  462                                  290 
##                           Hospital B                    Military Hospital 
##                                  289                                  917 
##                                Other                        Port Hospital 
##                                  904                                 1817 
## St. Mark&#39;s Maternity Hospital (SMMH)                                 &lt;NA&gt; 
##                                  429                                 1501</code></pre>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> The number of spaces before and after an equals sign does not matter. Make your code easier to read by aligning the = for all or most rows. Also, consider adding a hashed comment row to clarify for future readers which side is OLD and which side is NEW. </span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Sometimes a <em>blank</em> character value exists in a dataset (not recognized as R’s value for missing - <code>NA</code>). You can reference this value with two quotation marks with no space inbetween ("").</span></p>
</div>
<div id="base-r" class="section level4" number="4.8.1.3">
<h4><span class="header-section-number">4.8.1.3</span> <strong>base</strong> R</h4>
<p>If necessary, you make manual changes to a specific value in a dataframe by referencing the row number of case ID. But remember it is better if you can make these changes permanently in the underlying data!</p>
<p>Here is a fake example. It reads as “Change the value of the dataframe <code>linelist</code>‘s column <code>onset_date</code> (for the row where <code>linelist</code>’s column <code>case_id</code> has the value ’9d4019’) to <code>as.Date("2020-10-24")</code>”.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>linelist<span class="op">$</span>date_onset[linelist<span class="op">$</span>case_id <span class="op">==</span><span class="st"> &quot;9d4019&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-10-24&quot;</span>)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="recoding-by-logic" class="section level3 tabset tabset-fade" number="4.8.2">
<h3><span class="header-section-number">4.8.2</span> Recoding by logic</h3>
<p>These tabs demonstrate re-coding values in a column using logic and conditions:</p>
<ul>
<li>Using <code>case_when()</code><br />
</li>
<li>Using <code>ifelse()</code> and <code>if_else()</code><br />
</li>
<li>Using special <strong>dplyr</strong> recoding functions like:
<ul>
<li><code>replace_na()</code><br />
</li>
<li><code>na_if()</code><br />
</li>
<li><code>coalesnce()</code></li>
</ul></li>
</ul>
<div id="case_when" class="section level4" number="4.8.2.1">
<h4><span class="header-section-number">4.8.2.1</span> <code>case_when()</code></h4>
<p>If you need to use logic statements to recode values, or want to use operators like <code>%in%</code>, use <strong>dplyr</strong>’s <code>case_when()</code> instead. <strong>If you use <code>case_when()</code> please read the thorough explanation HERE LINK, as there are important differences from <code>recode()</code> in syntax and logic order!</strong></p>
<p>Note that all Right-hand side (RHS) inputs must be of the same class (e.g. character, numeric, logical). Notice the use of the special value <code>NA_real_</code> instead of just <code>NA</code>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">age_years =</span> <span class="kw">case_when</span>(</span>
<span id="cb57-3"><a href="#cb57-3"></a>            age_unit <span class="op">==</span><span class="st"> &quot;years&quot;</span>  <span class="op">~</span><span class="st"> </span>age,       <span class="co"># if age is given in years</span></span>
<span id="cb57-4"><a href="#cb57-4"></a>            age_unit <span class="op">==</span><span class="st"> &quot;months&quot;</span> <span class="op">~</span><span class="st"> </span>age<span class="op">/</span><span class="dv">12</span>,    <span class="co"># if age is given in months</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>            <span class="kw">is.na</span>(age_unit)      <span class="op">~</span><span class="st"> </span>age,       <span class="co"># if age unit is missing, assume years</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>            <span class="ot">TRUE</span>                 <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>)) <span class="co"># Any other circumstance</span></span></code></pre></div>
</div>
<div id="ifelse-and-if_else" class="section level4" number="4.8.2.2">
<h4><span class="header-section-number">4.8.2.2</span> <code>ifelse()</code> and <code>if_else()</code></h4>
<p>For simple uses of logical re-coding or new variable creationgyou can use <code>ifelse()</code> or <code>if_else()</code>. Though in most cases it is better to use <code>case_when()</code>.</p>
<p>These commands are simplified versions of an <code>if</code> and <code>else</code> statement. The general syntax is ifelse(<strong>condition</strong>, <strong>value if condition evaluates to TRUE</strong>, <strong>value if condition evaluates to FALSE</strong>). If used in a <code>mutate()</code>, each row is evaluated. <code>if_else()</code> is a special version from <strong>dplyr</strong> that handles dates in the condition.</p>
<p>It can be tempting to string together many ifelse commands… resist this and <strong>use <code>case_when()</code> instead!</strong> It is much more simple, easier to read, and easier to identify errors.</p>
<p>IMAGE of ifelse string with X across is.</p>
<p>You can reference other columns with the <code>ifelse()</code> function within <code>mutate()</code>:</p>
<p>Example of <code>ifelse()</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">source_known =</span> <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(source), <span class="st">&quot;known&quot;</span>, <span class="st">&quot;unknown&quot;</span>))</span></code></pre></div>
<p>Example of <code>if_else()</code> (using dates):
Note that if the ‘true’ value is a date, the ‘false’ value must also qualify a date, hence using the special character <code>NA_real_</code> instead of just <code>NA</code>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_death =</span> <span class="kw">if_else</span>(outcome <span class="op">==</span><span class="st"> &quot;Death&quot;</span>, date_outcome, <span class="ot">NA_real_</span>))</span></code></pre></div>
<p>Note: If you want to alternate a value used in your code based on other circumstances, consider using <code>switch()</code> from <strong>base</strong> R. For example if… TO DO. See the section on using <code>switch()</code> in the page on R interactive console.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="recoding-using-special-dplyr-functions" class="section level3" number="4.8.3">
<h3><span class="header-section-number">4.8.3</span> Recoding using special <strong>dplyr</strong> functions</h3>
<div id="using-replace_na" class="section level4" number="4.8.3.1">
<h4><span class="header-section-number">4.8.3.1</span> Using <code>replace_na()</code></h4>
<p>To change missing values (<code>NA</code>) to a specific character value, such as “Missing”, use the function <code>replace_na()</code> within <code>mutate()</code>. Note that this is used in the same manner as <code>recode</code> above - the name of the variable must be repeated within <code>replace_na()</code>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span></code></pre></div>
</div>
<div id="using-na_if" class="section level4" number="4.8.3.2">
<h4><span class="header-section-number">4.8.3.2</span> Using <code>na_if()</code></h4>
<p>Likewise you can quickly convert a specific character value to <code>NA</code> using <code>na_if()</code>. The command below is the opposite of the one above. It converts any values of “Missing” to <code>NA</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">na_if</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span></code></pre></div>
</div>
<div id="using-coalesce" class="section level4" number="4.8.3.3">
<h4><span class="header-section-number">4.8.3.3</span> Using <code>coalesce()</code></h4>
<p>This <strong>dplyr</strong> function finds the first non-missing value at each position. So, you provide it with columns and for each row it will fill the value with the first non-missing value in the columns you provided.</p>
<p>For example, you might use <code>this</code>coalesce()` create a “location” variable from hypothetical variables “patient_residence” and “reporting_jurisdiction”, where you prioritize patient residence information, if it exists.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">location =</span> <span class="kw">coalesce</span>(patient_residence, reporting_jurisdiction))</span></code></pre></div>
<p>TO DO
lead(), lag()
cumsum(), cummean(), cummin(), cummax(), cumany(), cumall(),</p>
<!-- ======================================================= -->
</div>
</div>
<div id="recoding-using-cleaning-dictionaries" class="section level3" number="4.8.4">
<h3><span class="header-section-number">4.8.4</span> Recoding using cleaning dictionaries</h3>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">## load cleaning rules and only keep columns in mll</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>mll_cleaning_rules &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="kw">here</span>(<span class="st">&quot;dictionaries/mll_cleaning_rules.xlsx&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="st">  </span><span class="kw">filter</span>(column <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">names</span>(mll_raw), <span class="st">&quot;.global&quot;</span>))</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="co">## define columns that are not cleand</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>unchanged &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb63-7"><a href="#cb63-7"></a>  <span class="st">&quot;epilink_relationship&quot;</span>,</span>
<span id="cb63-8"><a href="#cb63-8"></a>  <span class="st">&quot;narratives&quot;</span>,</span>
<span id="cb63-9"><a href="#cb63-9"></a>  <span class="st">&quot;epilink_relationship_detail&quot;</span></span>
<span id="cb63-10"><a href="#cb63-10"></a>)</span>
<span id="cb63-11"><a href="#cb63-11"></a></span>
<span id="cb63-12"><a href="#cb63-12"></a>mll_clean &lt;-<span class="st"> </span>mll_raw <span class="op">%&gt;%</span></span>
<span id="cb63-13"><a href="#cb63-13"></a><span class="st">  </span><span class="co">## convert to tibble</span></span>
<span id="cb63-14"><a href="#cb63-14"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb63-15"><a href="#cb63-15"></a><span class="st">  </span><span class="co">## clean columns using cleaning rules</span></span>
<span id="cb63-16"><a href="#cb63-16"></a><span class="st">  </span><span class="kw">clean_data</span>(</span>
<span id="cb63-17"><a href="#cb63-17"></a>    <span class="dt">wordlists =</span> mll_cleaning_rules,</span>
<span id="cb63-18"><a href="#cb63-18"></a>    <span class="dt">protect =</span> <span class="kw">names</span>(.) <span class="op">%in%</span><span class="st"> </span>unchanged</span>
<span id="cb63-19"><a href="#cb63-19"></a>  )</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="add-to-pipe-chain-1" class="section level3" number="4.8.5">
<h3><span class="header-section-number">4.8.5</span> Add to pipe chain</h3>
<p>Here we add the described cleaning steps to the pipe chain.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="co">##################################################################################</span></span>
<span id="cb64-3"><a href="#cb64-3"></a></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="co">###########################</span></span>
<span id="cb64-6"><a href="#cb64-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb64-7"><a href="#cb64-7"></a><span class="st">    </span></span>
<span id="cb64-8"><a href="#cb64-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb64-9"><a href="#cb64-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-10"><a href="#cb64-10"></a><span class="st">    </span></span>
<span id="cb64-11"><a href="#cb64-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb64-12"><a href="#cb64-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb64-13"><a href="#cb64-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb64-14"><a href="#cb64-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb64-15"><a href="#cb64-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-16"><a href="#cb64-16"></a><span class="st">  </span></span>
<span id="cb64-17"><a href="#cb64-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb64-18"><a href="#cb64-18"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-19"><a href="#cb64-19"></a></span>
<span id="cb64-20"><a href="#cb64-20"></a><span class="st">    </span><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb64-21"><a href="#cb64-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-22"><a href="#cb64-22"></a><span class="st">    </span></span>
<span id="cb64-23"><a href="#cb64-23"></a><span class="st">    </span><span class="co"># correct the class of the columns</span></span>
<span id="cb64-24"><a href="#cb64-24"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb64-25"><a href="#cb64-25"></a>           <span class="dt">generation =</span> <span class="kw">as.numeric</span>(generation),</span>
<span id="cb64-26"><a href="#cb64-26"></a>           <span class="dt">age        =</span> <span class="kw">as.numeric</span>(age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-27"><a href="#cb64-27"></a><span class="st">  </span></span>
<span id="cb64-28"><a href="#cb64-28"></a><span class="st">    </span><span class="co"># create column: delay to hospitalisation</span></span>
<span id="cb64-29"><a href="#cb64-29"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">days_onset_hosp =</span> <span class="kw">as.numeric</span>(date_hospitalisation <span class="op">-</span><span class="st"> </span>date_onset)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-30"><a href="#cb64-30"></a></span>
<span id="cb64-31"><a href="#cb64-31"></a><span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb64-32"><a href="#cb64-32"></a><span class="st">  </span><span class="co">###################################################</span></span>
<span id="cb64-33"><a href="#cb64-33"></a></span>
<span id="cb64-34"><a href="#cb64-34"></a><span class="st">    </span><span class="co"># clean values of hospital column</span></span>
<span id="cb64-35"><a href="#cb64-35"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">recode</span>(hospital,</span>
<span id="cb64-36"><a href="#cb64-36"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb64-37"><a href="#cb64-37"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb64-38"><a href="#cb64-38"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb64-39"><a href="#cb64-39"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb64-40"><a href="#cb64-40"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      =<span class="st"> &quot;Port Hospital&quot;</span>,</span>
<span id="cb64-41"><a href="#cb64-41"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   =<span class="st"> &quot;Central Hospital&quot;</span>,</span>
<span id="cb64-42"><a href="#cb64-42"></a>                      <span class="st">&quot;other&quot;</span>             =<span class="st"> &quot;Other&quot;</span>,</span>
<span id="cb64-43"><a href="#cb64-43"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> =<span class="st"> &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb64-44"><a href="#cb64-44"></a>                      )) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-45"><a href="#cb64-45"></a><span class="st">    </span></span>
<span id="cb64-46"><a href="#cb64-46"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-47"><a href="#cb64-47"></a></span>
<span id="cb64-48"><a href="#cb64-48"></a><span class="st">    </span><span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb64-49"><a href="#cb64-49"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age_years =</span> <span class="kw">case_when</span>(</span>
<span id="cb64-50"><a href="#cb64-50"></a>          age_unit <span class="op">==</span><span class="st"> &quot;years&quot;</span> <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb64-51"><a href="#cb64-51"></a>          age_unit <span class="op">==</span><span class="st"> &quot;months&quot;</span> <span class="op">~</span><span class="st"> </span>age<span class="op">/</span><span class="dv">12</span>,</span>
<span id="cb64-52"><a href="#cb64-52"></a>          <span class="kw">is.na</span>(age_unit) <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb64-53"><a href="#cb64-53"></a>          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="filter-rows" class="section level2 tabset tabset-fade" number="4.9">
<h2><span class="header-section-number">4.9</span> Filter rows</h2>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>A typical early cleaning step is to filter the dataframe for specific rows using the <strong>dplyr</strong> verb <code>filter()</code>. Within <code>filter()</code>, give the logic that must be <code>TRUE</code> for a row in the dataset to be kept.</p>
<p>The tabs below show how to filter rows based on simple and complex logical conditions, and how to filter/subset rows as a stand-alone command and with <strong>base</strong> R</p>
<!-- ======================================================= -->
<div id="a-simple-filter" class="section level3" number="4.9.1">
<h3><span class="header-section-number">4.9.1</span> A simple <code>filter()</code></h3>
<p>This simple example re-defines the dataframe <code>linelist</code> as itself, having filtered the rows to meet a logical condition. <strong>Only the rows where the logical statement within the parentheses is <code>TRUE</code> are kept.</strong></p>
<p>In this case, the logical statement is <code>!is.na(case_id)</code>, which is asking whether the value in the column <code>case_id</code> is <strong>not</strong> missing (<code>NA</code>). Thus, rows where <code>case_id</code> is <strong>not</strong> missing are kept.</p>
<p>Before the filter is applied, the number of rows in <code>linelist</code> is 6609.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(case_id))  <span class="co"># keep only rows where case_id is not missing</span></span></code></pre></div>
<p>After the filter is applied, the number of rows in <code>linelist</code> is 6603.</p>
<!-- ======================================================= -->
</div>
<div id="a-complex-filter" class="section level3" number="4.9.2">
<h3><span class="header-section-number">4.9.2</span> A complex <code>filter()</code></h3>
<p>A more complex example using <code>filter()</code>:</p>
<div id="examine-the-data" class="section level4" number="4.9.2.1">
<h4><span class="header-section-number">4.9.2.1</span> Examine the data</h4>
<p>Below is a simple one-line command to create a histogram of onset dates. See that a second smaller outbreak from 2012-2013 is also included in this dataset. <strong>For our analyses, we want to remove entries from this earlier outbreak.</strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="kw">hist</span>(linelist<span class="op">$</span>date_onset, <span class="dt">breaks =</span> <span class="dv">50</span>)</span></code></pre></div>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-58-1.png" width="50%" /></p>
</div>
<div id="how-filters-handle-missing-numeric-and-date-values" class="section level4" number="4.9.2.2">
<h4><span class="header-section-number">4.9.2.2</span> How filters handle missing numeric and date values</h4>
<p>Can we just filter by <code>date_onset</code> to rows after June 2013? <strong>Caution! Applying the code <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> would accidentally remove any rows in the later epidemic with a missing date of onset!</strong></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Filtering to greater than (&gt;) or less than (&lt;) a date or number can remove any rows with missing values (<code>NA</code>)! This is because <code>NA</code> is treated as infinitely large and small.</span></p>
</div>
<div id="design-the-filter" class="section level4" number="4.9.2.3">
<h4><span class="header-section-number">4.9.2.3</span> Design the filter</h4>
<p>Examine a cross-tabulation to make sure we exclude only the correct rows:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw">table</span>(<span class="dt">Hospital  =</span> linelist<span class="op">$</span>hospital,                     <span class="co"># hospital name</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>      <span class="dt">YearOnset =</span> lubridate<span class="op">::</span><span class="kw">year</span>(linelist<span class="op">$</span>date_onset),  <span class="co"># year of date_onset</span></span>
<span id="cb67-3"><a href="#cb67-3"></a>      <span class="dt">useNA     =</span> <span class="st">&quot;always&quot;</span>)                              <span class="co"># show missing values</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014 2015 &lt;NA&gt;
##   Central Hospital                        0    0  366   96    0
##   Hospital A                            225   65    0    0    0
##   Hospital B                            220   66    0    0    0
##   Military Hospital                       0    0  717  200    0
##   Missing                                 0    0 1180  318    0
##   Other                                   0    0  724  180    0
##   Port Hospital                          10    0 1462  345    0
##   St. Mark&#39;s Maternity Hospital (SMMH)    0    0  336   93    0
##   &lt;NA&gt;                                    0    0    0    0    0</code></pre>
<p>What other criteria can we filter on to remove the first outbreak from the dataset? We see that:</p>
<ul>
<li>The first epidemic occurred at Hospital A, Hospital B, and that there were also 10 cases at Port Hospital.<br />
</li>
<li>Hospitals A &amp; B did <em>not</em> have cases in the second epidemic, but Port Hospital did.</li>
</ul>
<p>We want to exclude:</p>
<ul>
<li>The 586 rows with onset in 2012 and 2013 at either hospital A, B, or Port:
<ul>
<li>Exclude the 586 rows with onset in 2012 and 2013</li>
<li>Exclude the 0 rows from Hospitals A &amp; B with missing onset dates<br />
</li>
<li>Do <strong>not</strong> exclude the 0 other rows with missing onset dates.</li>
</ul></li>
</ul>
<p>We start with a linelist of <code>nrow(linelist)</code>. Here is our filter statement:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="st">  </span><span class="co"># keep rows where onset is after 1 June 2013 OR where onset is missing and it was a hospital OTHER than Hospital A or B</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="st">  </span><span class="kw">filter</span>(date_onset <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="op">|</span><span class="st"> </span>(<span class="kw">is.na</span>(date_onset) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>hospital <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>)))</span>
<span id="cb69-4"><a href="#cb69-4"></a></span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="kw">nrow</span>(linelist)</span></code></pre></div>
<pre><code>## [1] 6017</code></pre>
<p>When we re-make the cross-tabulation, we see that Hospitals A &amp; B are removed completely, and the 10 Port Hospital cases from 2012 &amp; 2013 are removed, and all other values are the same - just as we wanted.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="kw">table</span>(<span class="dt">Hospital  =</span> linelist<span class="op">$</span>hospital,                     <span class="co"># hospital name</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>      <span class="dt">YearOnset =</span> lubridate<span class="op">::</span><span class="kw">year</span>(linelist<span class="op">$</span>date_onset),  <span class="co"># year of date_onset</span></span>
<span id="cb71-3"><a href="#cb71-3"></a>      <span class="dt">useNA     =</span> <span class="st">&quot;always&quot;</span>)                              <span class="co"># show missing values</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Central Hospital                      366   96    0
##   Military Hospital                     717  200    0
##   Missing                              1180  318    0
##   Other                                 724  180    0
##   Port Hospital                        1462  345    0
##   St. Mark&#39;s Maternity Hospital (SMMH)  336   93    0
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Multiple statements can be included within one filter command (separated by commas), or you can always pipe to a separate filter() command for clarity.</p>
<p><em>Note: some readers may notice that it would be easier to just filter by <code>date_hospitalisation</code> because it is 100% complete. This is true. But for p<code>date_onset</code> is used for purposes of a complex filter example.</em></p>
</div>
</div>
<div id="filter-as-a-stand-alone-command" class="section level3" number="4.9.3">
<h3><span class="header-section-number">4.9.3</span> Filter as a stand-alone command</h3>
<p>Filtering can also be done as a stand-alone command (not part of a pipe chain). Like other <strong>dplyr</strong> verbs, in this case the first argument must be the dataset itself.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># dataframe &lt;- filter(dataframe, condition(s) for rows to keep)</span></span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a>linelist &lt;-<span class="st"> </span><span class="kw">filter</span>(linelist, <span class="op">!</span><span class="kw">is.na</span>(case_id))</span></code></pre></div>
<p>You can also use <strong>base</strong> R to subset using square brackets which reflect the [rows, columns] that you want to retain.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># dataframe &lt;- dataframe[row conditions, column conditions] (blank means keep all)</span></span>
<span id="cb74-2"><a href="#cb74-2"></a></span>
<span id="cb74-3"><a href="#cb74-3"></a>linelist &lt;-<span class="st"> </span>linelist[<span class="op">!</span><span class="kw">is.na</span>(case_id), ]</span></code></pre></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Use bracket-subset syntax with <code>View()</code> to quickly review a few records.</span></p>
</div>
<div id="filtering-to-quickly-review-data" class="section level3" number="4.9.4">
<h3><span class="header-section-number">4.9.4</span> Filtering to quickly review data</h3>
<p>This <strong>base</strong> R syntax can be handy when you want to quickly view a subset of rows and columns. Use the <strong>base</strong> R <code>View()</code> command (note the capital “V”) around the [] subset you want to see. The result will appear as a dataframe in your RStudio viewer panel. For example, if I want to review onset and hospitalization dates of 3 specific cases:</p>
<p>View the linelist in the viewer panel:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">View</span>(linelist)</span></code></pre></div>
<p>View specific data for three cases:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">View</span>(linelist[linelist<span class="op">$</span>case_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11f8ea&quot;</span>, <span class="st">&quot;76b97a&quot;</span>, <span class="st">&quot;47a5f5&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;date_onset&quot;</span>, <span class="st">&quot;date_hospitalisation&quot;</span>)])</span></code></pre></div>
<p>Note: the above command can also be written with <strong>dplyr</strong> verbs <code>filter()</code> and <code>select()</code> as below:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="kw">View</span>(linelist <span class="op">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="st">       </span><span class="kw">filter</span>(case_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11f8ea&quot;</span>, <span class="st">&quot;76b97a&quot;</span>, <span class="st">&quot;47a5f5&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="st">       </span><span class="kw">select</span>(date_onset, date_hospitalisation))</span></code></pre></div>
</div>
<div id="add-to-pipe-chain-2" class="section level3" number="4.9.5">
<h3><span class="header-section-number">4.9.5</span> Add to pipe chain</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="co">##################################################################################</span></span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="co">###########################</span></span>
<span id="cb78-6"><a href="#cb78-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="st">    </span></span>
<span id="cb78-8"><a href="#cb78-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb78-9"><a href="#cb78-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-10"><a href="#cb78-10"></a><span class="st">    </span></span>
<span id="cb78-11"><a href="#cb78-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb78-12"><a href="#cb78-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb78-13"><a href="#cb78-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb78-14"><a href="#cb78-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb78-15"><a href="#cb78-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-16"><a href="#cb78-16"></a><span class="st">  </span></span>
<span id="cb78-17"><a href="#cb78-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb78-18"><a href="#cb78-18"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-19"><a href="#cb78-19"></a></span>
<span id="cb78-20"><a href="#cb78-20"></a><span class="st">    </span><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb78-21"><a href="#cb78-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-22"><a href="#cb78-22"></a><span class="st">    </span></span>
<span id="cb78-23"><a href="#cb78-23"></a><span class="st">    </span><span class="co"># correct the class of the columns</span></span>
<span id="cb78-24"><a href="#cb78-24"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb78-25"><a href="#cb78-25"></a>           <span class="dt">generation =</span> <span class="kw">as.numeric</span>(generation),</span>
<span id="cb78-26"><a href="#cb78-26"></a>           <span class="dt">age        =</span> <span class="kw">as.numeric</span>(age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-27"><a href="#cb78-27"></a><span class="st">  </span></span>
<span id="cb78-28"><a href="#cb78-28"></a><span class="st">    </span></span>
<span id="cb78-29"><a href="#cb78-29"></a><span class="st">    </span><span class="co"># create column: delay to hospitalisation</span></span>
<span id="cb78-30"><a href="#cb78-30"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">days_onset_hosp =</span> <span class="kw">as.numeric</span>(date_hospitalisation <span class="op">-</span><span class="st"> </span>date_onset)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-31"><a href="#cb78-31"></a><span class="st">    </span></span>
<span id="cb78-32"><a href="#cb78-32"></a><span class="st">    </span><span class="co"># clean values of hospital column</span></span>
<span id="cb78-33"><a href="#cb78-33"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">recode</span>(hospital,</span>
<span id="cb78-34"><a href="#cb78-34"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb78-35"><a href="#cb78-35"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb78-36"><a href="#cb78-36"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb78-37"><a href="#cb78-37"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb78-38"><a href="#cb78-38"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      =<span class="st"> &quot;Port Hospital&quot;</span>,</span>
<span id="cb78-39"><a href="#cb78-39"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   =<span class="st"> &quot;Central Hospital&quot;</span>,</span>
<span id="cb78-40"><a href="#cb78-40"></a>                      <span class="st">&quot;other&quot;</span>             =<span class="st"> &quot;Other&quot;</span>,</span>
<span id="cb78-41"><a href="#cb78-41"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> =<span class="st"> &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb78-42"><a href="#cb78-42"></a>                      )) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-43"><a href="#cb78-43"></a></span>
<span id="cb78-44"><a href="#cb78-44"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-45"><a href="#cb78-45"></a></span>
<span id="cb78-46"><a href="#cb78-46"></a><span class="st">    </span><span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb78-47"><a href="#cb78-47"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age_years =</span> <span class="kw">case_when</span>(</span>
<span id="cb78-48"><a href="#cb78-48"></a>          age_unit <span class="op">==</span><span class="st"> &quot;years&quot;</span>  <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb78-49"><a href="#cb78-49"></a>          age_unit <span class="op">==</span><span class="st"> &quot;months&quot;</span> <span class="op">~</span><span class="st"> </span>age<span class="op">/</span><span class="dv">12</span>,</span>
<span id="cb78-50"><a href="#cb78-50"></a>          <span class="kw">is.na</span>(age_unit)      <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb78-51"><a href="#cb78-51"></a>          <span class="ot">TRUE</span>                 <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-52"><a href="#cb78-52"></a><span class="st">    </span></span>
<span id="cb78-53"><a href="#cb78-53"></a><span class="st">  </span><span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb78-54"><a href="#cb78-54"></a><span class="st">    </span><span class="co">###################################################</span></span>
<span id="cb78-55"><a href="#cb78-55"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb78-56"><a href="#cb78-56"></a>          <span class="co"># keep only rows where case_id is not missing</span></span>
<span id="cb78-57"><a href="#cb78-57"></a>          <span class="op">!</span><span class="kw">is.na</span>(case_id),  </span>
<span id="cb78-58"><a href="#cb78-58"></a>          </span>
<span id="cb78-59"><a href="#cb78-59"></a>          <span class="co"># also filter to keep only the second outbreak</span></span>
<span id="cb78-60"><a href="#cb78-60"></a>          date_onset <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="op">|</span><span class="st"> </span>(<span class="kw">is.na</span>(date_onset) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>hospital <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>)))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="num_cats" class="section level2 tabset tabset-fade" number="4.10">
<h2><span class="header-section-number">4.10</span> Numeric categories</h2>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>Special approaches for creating numeric categories</p>
<p>Common examples include age categories, groups of lab values, etc.</p>
<p>There are several ways to create categories of a numeric column such as age. Here we will discuss:</p>
<ul>
<li><code>age_categories()</code>, from the <strong>epikit</strong> package<br />
</li>
<li><code>cut()</code>, from <strong>base</strong> R<br />
</li>
<li>using percentiles to break your numbers<br />
</li>
<li>natural break points… ? TO DO<br />
</li>
<li>case_when()</li>
</ul>
<p>Sometimes, numeric variables will import as class “character”. This occurs if there are non-numeric characters in some of the values, for example an entry of “2 months” for age, or (depending on your R locale settings) if a comma is used in the decimals place (e.g. “4,5” to mean four and one half years).</p>
<p>For this example we will create an <code>age_cat</code> column using the <code>age_years</code> column.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co">#check the class of the linelist variable age</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="kw">class</span>(linelist<span class="op">$</span>age_years)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<!-- ======================================================= -->
<div id="age_categories" class="section level3" number="4.10.1">
<h3><span class="header-section-number">4.10.1</span> <code>age_categories()</code>**</h3>
<p>With the <strong>epikit</strong> package, you can use the <code>age_categories()</code> function to easily categorize and label numeric columns (note: this can be applied to non-age numeric variables too). The output is an ordered factor.</p>
<p>The break values specified are included in the higher group, that is groups are open on the lower/left side. As shown below, you can add 1 to each break value to achieve groups that are open at the top/right.</p>
<p>Other <em>optional</em> arguments:</p>
<ul>
<li><code>lower =</code> Default is 0). The lowest number you want considered.<br />
</li>
<li><code>upper =</code> The highest number you want considered.<br />
</li>
<li><code>by =</code> The number of years between groups.<br />
</li>
<li><code>separator =</code> Default is “-”. Character between ages in labels.<br />
</li>
<li><code>ceiling =</code> Default FALSE. If TRUE, the highest break value is a ceiling and a category “XX+” is not included. Any values above highest break or <code>upper</code> (if defined) are categorized as <code>NA</code>.</li>
</ul>
<p>See the function’s Help page for more details (enter <code>?age_categories</code> in the R console).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="kw">library</span>(epikit)</span>
<span id="cb81-2"><a href="#cb81-2"></a></span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="co"># Simple example</span></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="co">################</span></span>
<span id="cb81-5"><a href="#cb81-5"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">age_categories</span>(age_years,</span>
<span id="cb81-7"><a href="#cb81-7"></a>                                  <span class="dt">breakers =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)))</span>
<span id="cb81-8"><a href="#cb81-8"></a><span class="co"># show table</span></span>
<span id="cb81-9"><a href="#cb81-9"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-49 50-69   70+  &lt;NA&gt; 
##  1078  1181   981   908  1089   665    24     0    91</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># With ceiling set to TRUE</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="co">##########################</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">age_categories</span>(age_years, </span>
<span id="cb83-5"><a href="#cb83-5"></a>                                  <span class="dt">breakers =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>),</span>
<span id="cb83-6"><a href="#cb83-6"></a>                                  <span class="dt">upper =</span> <span class="kw">max</span>(linelist<span class="op">$</span>age_years, <span class="dt">na.rm=</span>T),</span>
<span id="cb83-7"><a href="#cb83-7"></a>                                  <span class="dt">ceiling =</span> <span class="ot">TRUE</span>)) <span class="co"># 70 is the ceiling</span></span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="co"># show table</span></span>
<span id="cb83-9"><a href="#cb83-9"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-49 50-70  &lt;NA&gt; 
##  1078  1181   981   908  1089   665    24    91</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># Include upper ends for the same categories</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="co">############################################</span></span>
<span id="cb85-3"><a href="#cb85-3"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-4"><a href="#cb85-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">age_categories</span>(age_years, </span>
<span id="cb85-5"><a href="#cb85-5"></a>                                  <span class="dt">upper =</span> <span class="kw">max</span>(linelist<span class="op">$</span>age_years, <span class="dt">na.rm=</span>T),</span>
<span id="cb85-6"><a href="#cb85-6"></a>                                  <span class="dt">breakers =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">31</span>, <span class="dv">51</span>, <span class="dv">71</span>, <span class="dv">76</span>)))</span>
<span id="cb85-7"><a href="#cb85-7"></a><span class="co"># show table</span></span>
<span id="cb85-8"><a href="#cb85-8"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-5  6-10 11-15 16-20 21-30 31-50 51-70 71-75   76+  &lt;NA&gt; 
##  1328  1149   977   818  1035   599    20     0     0    91</code></pre>
<!-- ======================================================= -->
</div>
<div id="cut" class="section level3 tabset tabset-fade" number="4.10.2">
<h3><span class="header-section-number">4.10.2</span> <code>cut()</code></h3>
<p>You can use the <strong>base</strong> R function <code>cut()</code>, which creates categories from a numeric variable. The differences from <code>age_categories()</code> are:</p>
<ul>
<li>You do not need to install/load another package<br />
</li>
<li>You can specify whether groups are open/closed on the right/left<br />
</li>
<li>You must provide labels yourself (and ensure they are accurate to the groups)<br />
</li>
<li>If you want 0 included in the lowest group you must specify this</li>
</ul>
<p>The basic syntax within <code>cut()</code> is to first provide the numeric variable to be cut (age_years), and then the <em>breaks</em> argument, which is a numeric vector (<code>c()</code>) of break points. Using <code>cut()</code>, the resulting column is an ordered factor.</p>
<p>If used within <code>mutate()</code> (a <strong>dplyr</strong> verb) it is not necessary to specify the dataframe before the column name (e.g. <code>linelist$age_years</code>).</p>
<div id="simple-cut-example" class="section level4" number="4.10.2.1">
<h4><span class="header-section-number">4.10.2.1</span> Simple <code>cut()</code> example</h4>
<p>Create new column of age categories (<code>age_cat</code>) by cutting the numeric <code>age_year</code> column at specified break points. The example below replicates the first <code>age_categories()</code> example.</p>
<ul>
<li>Specify numeric vector of break points <code>c(0, 5, 10, 15, ...)</code><br />
</li>
<li>Default behavior for <code>cut()</code> is that lower break values are <em>excluded</em> from each category, and upper break values are <em>included</em>. This is the opposite behavior from the <code>age_categories()</code> function.<br />
</li>
<li>Include 0 in the lowest category by adding <code>include.lowest = TRUE</code><br />
</li>
<li>Add a vector of customized labels using the <code>labels =</code> argument<br />
</li>
<li>Check your work with cross-tabulation of the numeric and category columns - be aware of missing values</li>
</ul>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">cut</span>(age_years,                                       <span class="co"># numeric column</span></span>
<span id="cb87-3"><a href="#cb87-3"></a>                        <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>,        <span class="co"># break points...</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>                                   <span class="kw">max</span>(linelist<span class="op">$</span>age_years, <span class="dt">na.rm=</span>T)),   <span class="co"># ... with dynamic last break as column max value</span></span>
<span id="cb87-5"><a href="#cb87-5"></a>                        <span class="dt">right =</span> <span class="ot">TRUE</span>,                                   <span class="co"># lower breaks included and upper excluded [a,b)</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>                        <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>,                          <span class="co"># 0 included in lowest category</span></span>
<span id="cb87-7"><a href="#cb87-7"></a>                        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>,      <span class="co"># manual labels - be careful!</span></span>
<span id="cb87-8"><a href="#cb87-8"></a>                                   <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70+&quot;</span>)))       </span>
<span id="cb87-9"><a href="#cb87-9"></a></span>
<span id="cb87-10"><a href="#cb87-10"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-49 50-69   70+  &lt;NA&gt; 
##  1328  1149   977   818  1035   599    20     0    91</code></pre>
</div>
<div id="cut-details" class="section level4" number="4.10.2.2">
<h4><span class="header-section-number">4.10.2.2</span> <code>cut()</code> details</h4>
<p>Below is a detailed description of the behavior of using <code>cut()</code> to make the <code>age_cat</code> column. Key points:</p>
<ul>
<li>Inclusion/exclusion behavior of break points<br />
</li>
<li>Custom category labels<br />
</li>
<li>Handling missing values<br />
</li>
<li><strong>Check your work!</strong></li>
</ul>
<p>The most simple command of <code>cut()</code> applied to <code>age_years</code> to make the new variable <code>age_cat</code> is below:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># Create new variable, by cutting the numeric age variable</span></span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="co"># by default, upper break is excluded and lower break excluded from each category</span></span>
<span id="cb89-3"><a href="#cb89-3"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">cut</span>(age_years, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>)))</span>
<span id="cb89-5"><a href="#cb89-5"></a></span>
<span id="cb89-6"><a href="#cb89-6"></a><span class="co"># tabulate the number of observations per group</span></span>
<span id="cb89-7"><a href="#cb89-7"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    (0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100] 
##     1215     1149      977      818     1035      599       20        0 
##     &lt;NA&gt; 
##      204</code></pre>
<ul>
<li><p><strong>By default</strong>, the categorization occurs so that the right/upper side is “open” and inclusive (and the left/lower side is “closed” or exclusive). The default labels use the notation “(A, B]”, which means the group does not include A (the lower break value), but includes B (the upper break value). <strong>Reverse this behavior by providing the <code>right = TRUE</code> argument</strong>.</p></li>
<li><p>Thus, <strong>by default</strong> “0” values are excluded from the lowest group, and categorized as <code>NA</code>. “0” values could be infants coded as age 0. To change this <strong>add the argument <code>include.lowest = TRUE</code></strong>. Then, any “0” values are included in the lowest group. The automatically-generated label for the lowest category will change from “(0,B]” to “[0,B]”, which signifies that 0 values are included.</p></li>
<li><p><strong>Check your work!!!</strong> Verify that each age value was assigned to the correct category by cross-tabulating the numeric and category columns. Examine assignment of boundary values (e.g. 15, if neighboring categories are 10-15 and 15-20).</p></li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Cross tabulation of the numeric and category columns. </span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="kw">table</span>(<span class="st">&quot;Numeric Values&quot;</span> =<span class="st"> </span>linelist<span class="op">$</span>age_years,   <span class="co"># names specified in table for clarity.</span></span>
<span id="cb91-3"><a href="#cb91-3"></a>      <span class="st">&quot;Categories&quot;</span>     =<span class="st"> </span>linelist<span class="op">$</span>age_cat,</span>
<span id="cb91-4"><a href="#cb91-4"></a>      <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)                        <span class="co"># don&#39;t forget to examine NA values</span></span></code></pre></div>
<pre><code>##                     Categories
## Numeric Values       (0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70]
##   0                      0      0       0       0       0       0       0
##   0.0833333333333333     2      0       0       0       0       0       0
##   0.166666666666667      3      0       0       0       0       0       0
##   0.25                   2      0       0       0       0       0       0
##   0.333333333333333      2      0       0       0       0       0       0
##   0.416666666666667      3      0       0       0       0       0       0
##   0.5                    2      0       0       0       0       0       0
##   0.583333333333333      1      0       0       0       0       0       0
##   0.666666666666667      3      0       0       0       0       0       0
##   0.75                   1      0       0       0       0       0       0
##   0.833333333333333      1      0       0       0       0       0       0
##   0.916666666666667      3      0       0       0       0       0       0
##   1                    263      0       0       0       0       0       0
##   1.5                    1      0       0       0       0       0       0
##   2                    249      0       0       0       0       0       0
##   3                    226      0       0       0       0       0       0
##   4                    203      0       0       0       0       0       0
##   5                    250      0       0       0       0       0       0
##   6                      0    234       0       0       0       0       0
##   7                      0    240       0       0       0       0       0
##   8                      0    220       0       0       0       0       0
##   9                      0    237       0       0       0       0       0
##   10                     0    218       0       0       0       0       0
##   11                     0      0     195       0       0       0       0
##   12                     0      0     190       0       0       0       0
##   13                     0      0     179       0       0       0       0
##   14                     0      0     199       0       0       0       0
##   15                     0      0     214       0       0       0       0
##   16                     0      0       0     194       0       0       0
##   17                     0      0       0     164       0       0       0
##   18                     0      0       0     177       0       0       0
##   19                     0      0       0     159       0       0       0
##   20                     0      0       0     124       0       0       0
##   21                     0      0       0       0     140       0       0
##   22                     0      0       0       0     121       0       0
##   23                     0      0       0       0     108       0       0
##   24                     0      0       0       0      95       0       0
##   25                     0      0       0       0     109       0       0
##   26                     0      0       0       0     108       0       0
##   27                     0      0       0       0      98       0       0
##   28                     0      0       0       0     100       0       0
##   29                     0      0       0       0      86       0       0
##   30                     0      0       0       0      70       0       0
##   31                     0      0       0       0       0      70       0
##   32                     0      0       0       0       0      71       0
##   33                     0      0       0       0       0      55       0
##   34                     0      0       0       0       0      52       0
##   35                     0      0       0       0       0      43       0
##   36                     0      0       0       0       0      35       0
##   37                     0      0       0       0       0      29       0
##   38                     0      0       0       0       0      37       0
##   39                     0      0       0       0       0      27       0
##   40                     0      0       0       0       0      36       0
##   41                     0      0       0       0       0      20       0
##   42                     0      0       0       0       0      17       0
##   43                     0      0       0       0       0      21       0
##   44                     0      0       0       0       0      21       0
##   45                     0      0       0       0       0      20       0
##   46                     0      0       0       0       0      14       0
##   47                     0      0       0       0       0       9       0
##   48                     0      0       0       0       0       7       0
##   49                     0      0       0       0       0      11       0
##   50                     0      0       0       0       0       4       0
##   51                     0      0       0       0       0       0       3
##   52                     0      0       0       0       0       0       4
##   53                     0      0       0       0       0       0       3
##   55                     0      0       0       0       0       0       2
##   56                     0      0       0       0       0       0       1
##   58                     0      0       0       0       0       0       1
##   59                     0      0       0       0       0       0       2
##   62                     0      0       0       0       0       0       1
##   63                     0      0       0       0       0       0       1
##   65                     0      0       0       0       0       0       1
##   66                     0      0       0       0       0       0       1
##   &lt;NA&gt;                   0      0       0       0       0       0       0
##                     Categories
## Numeric Values       (70,100] &lt;NA&gt;
##   0                         0  113
##   0.0833333333333333        0    0
##   0.166666666666667         0    0
##   0.25                      0    0
##   0.333333333333333         0    0
##   0.416666666666667         0    0
##   0.5                       0    0
##   0.583333333333333         0    0
##   0.666666666666667         0    0
##   0.75                      0    0
##   0.833333333333333         0    0
##   0.916666666666667         0    0
##   1                         0    0
##   1.5                       0    0
##   2                         0    0
##   3                         0    0
##   4                         0    0
##   5                         0    0
##   6                         0    0
##   7                         0    0
##   8                         0    0
##   9                         0    0
##   10                        0    0
##   11                        0    0
##   12                        0    0
##   13                        0    0
##   14                        0    0
##   15                        0    0
##   16                        0    0
##   17                        0    0
##   18                        0    0
##   19                        0    0
##   20                        0    0
##   21                        0    0
##   22                        0    0
##   23                        0    0
##   24                        0    0
##   25                        0    0
##   26                        0    0
##   27                        0    0
##   28                        0    0
##   29                        0    0
##   30                        0    0
##   31                        0    0
##   32                        0    0
##   33                        0    0
##   34                        0    0
##   35                        0    0
##   36                        0    0
##   37                        0    0
##   38                        0    0
##   39                        0    0
##   40                        0    0
##   41                        0    0
##   42                        0    0
##   43                        0    0
##   44                        0    0
##   45                        0    0
##   46                        0    0
##   47                        0    0
##   48                        0    0
##   49                        0    0
##   50                        0    0
##   51                        0    0
##   52                        0    0
##   53                        0    0
##   55                        0    0
##   56                        0    0
##   58                        0    0
##   59                        0    0
##   62                        0    0
##   63                        0    0
##   65                        0    0
##   66                        0    0
##   &lt;NA&gt;                      0   91</code></pre>
<p>Read more about <code>cut()</code> in its Help page by entering <code>?cut</code> in the R console.</p>
<p><strong>Reversing break inclusion behavior in <code>cut()</code></strong></p>
<p>Lower break values will be included in each category (and upper break values excluded) if the argument <code>right =</code> is included and and set to <code>TRUE</code>. This is applied below - note how the values have shifted among the categories.</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> If you include the <code>include.lowest = TRUE</code> argument <strong>and</strong> <code>right = TRUE</code>, the <code>include.lowest</code> will now apply to the <em>highest</em> break point value and category, not the lowest.</span></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">cut</span>(age_years,</span>
<span id="cb93-3"><a href="#cb93-3"></a>                          <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),     <span class="co"># same breaks</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>                          <span class="dt">right =</span> <span class="ot">FALSE</span>,                                     <span class="co"># include each *lower* break point            </span></span>
<span id="cb93-5"><a href="#cb93-5"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb93-6"><a href="#cb93-6"></a>                                     <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>)))  <span class="co"># now the labels must change</span></span>
<span id="cb93-7"><a href="#cb93-7"></a></span>
<span id="cb93-8"><a href="#cb93-8"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    0-4    5-9  10-14  15-19  20-29  30-49  50-69 70-100   &lt;NA&gt; 
##   1078   1181    981    908   1089    665     24      0     91</code></pre>
<p><strong>Re-labeling <code>NA</code> values with <code>cut()</code></strong></p>
<p>Because <code>cut()</code> does not automatically label <code>NA</code> values, you may want to assign a label such as “Missing”. This requires a few extra steps because <code>cut()</code> automatically classified the new column <code>age_cat</code> as a Factor (a rigid column class with specific value labels).</p>
<p>First, convert <code>age_cut</code> from Factor to Character class, so you have flexibility to add new character values (e.g. “Missing”). Otherwise you will encounter an error. Then, use the <strong>dplyr</strong> verb <code>replace_na()</code> to replace <code>NA</code> values with a character value like “Missing”. These steps can be combined into one step, as shown below.</p>
<p>Note that Missing has been added, <strong>but the order of the categories is now wrong (alphabetical).</strong></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="st">  </span></span>
<span id="cb95-3"><a href="#cb95-3"></a><span class="st">  </span><span class="co"># cut() creates age_cat, automatically of class Factor      </span></span>
<span id="cb95-4"><a href="#cb95-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">cut</span>(age_years,</span>
<span id="cb95-5"><a href="#cb95-5"></a>                          <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),          </span>
<span id="cb95-6"><a href="#cb95-6"></a>                          <span class="dt">right =</span> <span class="ot">FALSE</span>,                                                      </span>
<span id="cb95-7"><a href="#cb95-7"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb95-8"><a href="#cb95-8"></a>                                     <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>)),</span>
<span id="cb95-9"><a href="#cb95-9"></a>         </span>
<span id="cb95-10"><a href="#cb95-10"></a>         <span class="co"># convert to class Character, and replace NA with &quot;Missing&quot;</span></span>
<span id="cb95-11"><a href="#cb95-11"></a>         <span class="dt">age_cat =</span> <span class="kw">replace_na</span>(<span class="kw">as.character</span>(age_cat), <span class="st">&quot;Missing&quot;</span>))</span>
<span id="cb95-12"><a href="#cb95-12"></a></span>
<span id="cb95-13"><a href="#cb95-13"></a></span>
<span id="cb95-14"><a href="#cb95-14"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##     0-4   10-14   15-19   20-29   30-49     5-9   50-69 Missing    &lt;NA&gt; 
##    1078     981     908    1089     665    1181      24      91       0</code></pre>
<p>To fix this, re-convert <code>age_cat</code> to a factor, and define the order of the levels correctly.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="st">  </span></span>
<span id="cb97-3"><a href="#cb97-3"></a><span class="st">  </span><span class="co"># cut() creates age_cat, automatically of class Factor      </span></span>
<span id="cb97-4"><a href="#cb97-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">cut</span>(age_years,</span>
<span id="cb97-5"><a href="#cb97-5"></a>                          <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),          </span>
<span id="cb97-6"><a href="#cb97-6"></a>                          <span class="dt">right =</span> <span class="ot">FALSE</span>,                                                      </span>
<span id="cb97-7"><a href="#cb97-7"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb97-8"><a href="#cb97-8"></a>                                     <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>)),</span>
<span id="cb97-9"><a href="#cb97-9"></a>         </span>
<span id="cb97-10"><a href="#cb97-10"></a>         <span class="co"># convert to class Character, and replace NA with &quot;Missing&quot;</span></span>
<span id="cb97-11"><a href="#cb97-11"></a>         <span class="dt">age_cat =</span> <span class="kw">replace_na</span>(<span class="kw">as.character</span>(age_cat), <span class="st">&quot;Missing&quot;</span>),</span>
<span id="cb97-12"><a href="#cb97-12"></a>         </span>
<span id="cb97-13"><a href="#cb97-13"></a>         <span class="co"># re-classify age_cat as Factor, with correct level order and new &quot;Missing&quot; level</span></span>
<span id="cb97-14"><a href="#cb97-14"></a>         <span class="dt">age_cat =</span> <span class="kw">factor</span>(age_cat, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>,</span>
<span id="cb97-15"><a href="#cb97-15"></a>                                              <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>, <span class="st">&quot;Missing&quot;</span>)))    </span>
<span id="cb97-16"><a href="#cb97-16"></a>  </span>
<span id="cb97-17"><a href="#cb97-17"></a></span>
<span id="cb97-18"><a href="#cb97-18"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##     0-4     5-9   10-14   15-19   20-29   30-49   50-69  70-100 Missing    &lt;NA&gt; 
##    1078    1181     981     908    1089     665      24       0      91       0</code></pre>
<p>If you want a fast way to make breaks and labels, you can use something like below (adjust to your specific situation). See the page on using seq() and rep() and c() TO DO</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Make break points from 0 to 90 by 5</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>age_seq =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">90</span>, <span class="dt">by =</span> <span class="dv">5</span>)</span>
<span id="cb99-3"><a href="#cb99-3"></a>age_seq</span>
<span id="cb99-4"><a href="#cb99-4"></a></span>
<span id="cb99-5"><a href="#cb99-5"></a><span class="co"># Make labels for the above categories, assuming default cut() settings</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>age_labels =<span class="st"> </span><span class="kw">paste0</span>(age_seq<span class="op">+</span><span class="dv">1</span>, <span class="st">&quot;-&quot;</span>, age_seq <span class="op">+</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb99-7"><a href="#cb99-7"></a>age_labels</span>
<span id="cb99-8"><a href="#cb99-8"></a></span>
<span id="cb99-9"><a href="#cb99-9"></a><span class="co"># check that both vectors are the same length</span></span>
<span id="cb99-10"><a href="#cb99-10"></a><span class="kw">length</span>(age_seq) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(age_labels)</span>
<span id="cb99-11"><a href="#cb99-11"></a></span>
<span id="cb99-12"><a href="#cb99-12"></a><span class="co"># # Use them in the cut() command</span></span>
<span id="cb99-13"><a href="#cb99-13"></a><span class="co"># cut(linelist$age, breaks = age_seq, labels = age_labels)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="case_when-1" class="section level3" number="4.10.3">
<h3><span class="header-section-number">4.10.3</span> <code>case_when()</code></h3>
<p>The dplyr function <code>case_when()</code> can also be used to create numeric categories.</p>
<ul>
<li>Allows explicit setting of break point inclusion/exclusion<br />
</li>
<li>Allows designation of label for <code>NA</code> values in one step<br />
</li>
<li>More complicated code, <em>arguably</em> more prone to error<br />
</li>
<li>Allow more flexibility to include other variables in the logic</li>
</ul>
<p><strong>If using <code>case_when()</code> please review the in-depth page on it, as the logic and order of assignment are important understand to avoid errors.</strong></p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> In <code>case_when()</code> all right-hand side values must be of the same class. Thus, if your categories are character values (e.g. “20-30 years”) then any designated outcome for <code>NA</code> age values must also be character (“Missing”, or the special <code>NA_character_</code> instead of <code>NA</code>).</span></p>
<p>You will need to designate the column as a factor (by wrapping <code>case_when()</code> in the function <code>factor()</code>) and provide the ordering of the factor levels using the <code>levels =</code> argument <em>after</em> the close of the <code>case_when()</code> function. When using <code>cut()</code>, the factor and ordering of levels is done automatically.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cat =</span> <span class="kw">factor</span>(<span class="kw">case_when</span>(</span>
<span id="cb100-3"><a href="#cb100-3"></a>          <span class="co"># provide the case_when logic and outcomes</span></span>
<span id="cb100-4"><a href="#cb100-4"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>     <span class="op">~</span><span class="st"> &quot;0-4&quot;</span>,          <span class="co"># logic by age_year value</span></span>
<span id="cb100-5"><a href="#cb100-5"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>    <span class="op">~</span><span class="st"> &quot;5-9&quot;</span>,</span>
<span id="cb100-6"><a href="#cb100-6"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span>   <span class="op">~</span><span class="st"> &quot;10-14&quot;</span>,</span>
<span id="cb100-7"><a href="#cb100-7"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>   <span class="op">~</span><span class="st"> &quot;15-19&quot;</span>,</span>
<span id="cb100-8"><a href="#cb100-8"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>   <span class="op">~</span><span class="st"> &quot;20-29&quot;</span>,</span>
<span id="cb100-9"><a href="#cb100-9"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">30</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>   <span class="op">~</span><span class="st"> &quot;30-49&quot;</span>,</span>
<span id="cb100-10"><a href="#cb100-10"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">50</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;</span><span class="st"> </span><span class="dv">70</span>   <span class="op">~</span><span class="st"> &quot;50-69&quot;</span>,</span>
<span id="cb100-11"><a href="#cb100-11"></a>          age_years <span class="op">&gt;=</span><span class="st"> </span><span class="dv">45</span> <span class="op">&amp;</span><span class="st"> </span>age_years <span class="op">&lt;=</span><span class="st"> </span><span class="dv">100</span> <span class="op">~</span><span class="st"> &quot;70-100&quot;</span>,</span>
<span id="cb100-12"><a href="#cb100-12"></a>          <span class="kw">is.na</span>(age_years)                   <span class="op">~</span><span class="st"> &quot;Missing&quot;</span>,  <span class="co"># if age_years is missing</span></span>
<span id="cb100-13"><a href="#cb100-13"></a>          <span class="ot">TRUE</span>                               <span class="op">~</span><span class="st"> &quot;Check value&quot;</span>   <span class="co"># catch-all alarm to trigger review</span></span>
<span id="cb100-14"><a href="#cb100-14"></a>          ), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>,<span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>, <span class="st">&quot;Missing&quot;</span>, <span class="st">&quot;Check value&quot;</span>))</span>
<span id="cb100-15"><a href="#cb100-15"></a>         )</span>
<span id="cb100-16"><a href="#cb100-16"></a></span>
<span id="cb100-17"><a href="#cb100-17"></a></span>
<span id="cb100-18"><a href="#cb100-18"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##         0-4         5-9       10-14       15-19       20-29       30-49 
##        1078        1181         981         908        1089         665 
##       50-69      70-100     Missing Check value        &lt;NA&gt; 
##          24           0          91           0           0</code></pre>
</div>
<div id="add-to-pipe-chain-3" class="section level3" number="4.10.4">
<h3><span class="header-section-number">4.10.4</span> Add to pipe chain</h3>
<p>Below, code to create two categorical age columns is added to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="co">##################################################################################</span></span>
<span id="cb102-3"><a href="#cb102-3"></a></span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="co">###########################</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb102-7"><a href="#cb102-7"></a><span class="st">    </span></span>
<span id="cb102-8"><a href="#cb102-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb102-9"><a href="#cb102-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-10"><a href="#cb102-10"></a><span class="st">    </span></span>
<span id="cb102-11"><a href="#cb102-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb102-12"><a href="#cb102-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb102-13"><a href="#cb102-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb102-14"><a href="#cb102-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb102-15"><a href="#cb102-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-16"><a href="#cb102-16"></a><span class="st">  </span></span>
<span id="cb102-17"><a href="#cb102-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb102-18"><a href="#cb102-18"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-19"><a href="#cb102-19"></a></span>
<span id="cb102-20"><a href="#cb102-20"></a><span class="st">    </span><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb102-21"><a href="#cb102-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-22"><a href="#cb102-22"></a><span class="st">    </span></span>
<span id="cb102-23"><a href="#cb102-23"></a><span class="st">    </span><span class="co"># correct the class of the columns</span></span>
<span id="cb102-24"><a href="#cb102-24"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb102-25"><a href="#cb102-25"></a>           <span class="dt">generation =</span> <span class="kw">as.numeric</span>(generation),</span>
<span id="cb102-26"><a href="#cb102-26"></a>           <span class="dt">age        =</span> <span class="kw">as.numeric</span>(age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-27"><a href="#cb102-27"></a><span class="st">  </span></span>
<span id="cb102-28"><a href="#cb102-28"></a><span class="st">    </span></span>
<span id="cb102-29"><a href="#cb102-29"></a><span class="st">    </span><span class="co"># create column: delay to hospitalisation</span></span>
<span id="cb102-30"><a href="#cb102-30"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">days_onset_hosp =</span> <span class="kw">as.numeric</span>(date_hospitalisation <span class="op">-</span><span class="st"> </span>date_onset)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-31"><a href="#cb102-31"></a><span class="st">    </span></span>
<span id="cb102-32"><a href="#cb102-32"></a><span class="st">    </span><span class="co"># clean values of hospital column</span></span>
<span id="cb102-33"><a href="#cb102-33"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">recode</span>(hospital,</span>
<span id="cb102-34"><a href="#cb102-34"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb102-35"><a href="#cb102-35"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb102-36"><a href="#cb102-36"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb102-37"><a href="#cb102-37"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb102-38"><a href="#cb102-38"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      =<span class="st"> &quot;Port Hospital&quot;</span>,</span>
<span id="cb102-39"><a href="#cb102-39"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   =<span class="st"> &quot;Central Hospital&quot;</span>,</span>
<span id="cb102-40"><a href="#cb102-40"></a>                      <span class="st">&quot;other&quot;</span>             =<span class="st"> &quot;Other&quot;</span>,</span>
<span id="cb102-41"><a href="#cb102-41"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> =<span class="st"> &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb102-42"><a href="#cb102-42"></a>                      )) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-43"><a href="#cb102-43"></a></span>
<span id="cb102-44"><a href="#cb102-44"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-45"><a href="#cb102-45"></a></span>
<span id="cb102-46"><a href="#cb102-46"></a><span class="st">    </span><span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb102-47"><a href="#cb102-47"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age_years =</span> <span class="kw">case_when</span>(</span>
<span id="cb102-48"><a href="#cb102-48"></a>          age_unit <span class="op">==</span><span class="st"> &quot;years&quot;</span> <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb102-49"><a href="#cb102-49"></a>          age_unit <span class="op">==</span><span class="st"> &quot;months&quot;</span> <span class="op">~</span><span class="st"> </span>age<span class="op">/</span><span class="dv">12</span>,</span>
<span id="cb102-50"><a href="#cb102-50"></a>          <span class="kw">is.na</span>(age_unit) <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb102-51"><a href="#cb102-51"></a>          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-52"><a href="#cb102-52"></a><span class="st">    </span></span>
<span id="cb102-53"><a href="#cb102-53"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb102-54"><a href="#cb102-54"></a>          <span class="co"># keep only rows where case_id is not missing</span></span>
<span id="cb102-55"><a href="#cb102-55"></a>          <span class="op">!</span><span class="kw">is.na</span>(case_id),  </span>
<span id="cb102-56"><a href="#cb102-56"></a>          </span>
<span id="cb102-57"><a href="#cb102-57"></a>          <span class="co"># also filter to keep only the second outbreak</span></span>
<span id="cb102-58"><a href="#cb102-58"></a>          date_onset <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="op">|</span><span class="st"> </span>(<span class="kw">is.na</span>(date_onset) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>hospital <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-59"><a href="#cb102-59"></a><span class="st">  </span></span>
<span id="cb102-60"><a href="#cb102-60"></a><span class="st">    </span><span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb102-61"><a href="#cb102-61"></a><span class="st">    </span><span class="co">###################################################   </span></span>
<span id="cb102-62"><a href="#cb102-62"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb102-63"><a href="#cb102-63"></a>          <span class="co"># age categories: custom</span></span>
<span id="cb102-64"><a href="#cb102-64"></a>          <span class="dt">age_cat =</span> epikit<span class="op">::</span><span class="kw">age_categories</span>(age_years, <span class="dt">breakers =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb102-65"><a href="#cb102-65"></a>        </span>
<span id="cb102-66"><a href="#cb102-66"></a>          <span class="co"># age categories: 0 to 85 by 5s</span></span>
<span id="cb102-67"><a href="#cb102-67"></a>          <span class="dt">age_cat5 =</span> epikit<span class="op">::</span><span class="kw">age_categories</span>(age_years, <span class="dt">breakers =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>)))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="rowwise-dplyr" class="section level2" number="4.11">
<h2><span class="header-section-number">4.11</span> rowwise() <strong>dplyr()</strong></h2>
<p><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html" class="uri">https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html</a></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">num_symptoms =</span> <span class="kw">sum</span>(<span class="kw">c</span>(fever, chills, cough, aches, vomit) <span class="op">==</span><span class="st"> &quot;yes&quot;</span>))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="transforming-multiple-variables-at-once" class="section level2" number="4.12">
<h2><span class="header-section-number">4.12</span> Transforming multiple variables at once</h2>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>A transformation can be applied to multiple variables at once using the <code>across()</code> function from the package <strong>dplyr</strong> (contained within <strong>tidyverse</strong> package).</p>
<p><code>across()</code> can be used with any <strong>dplyr</strong> verb, but commonly with as <code>mutate()</code>, <code>filter()</code>, or <code>summarise()</code>. Here are some examples to get started.</p>
<p>Example of how one would change all columns to character class</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co">#to change all columns to character class</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">everything</span>(), as.character))</span></code></pre></div>
<p>Change only numeric columns</p>
<p>Here are a few online resources on using <code>across()</code>: <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">Hadley Wickham’s thoughts/rationale</a></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="deduplication" class="section level2" number="4.13">
<h2><span class="header-section-number">4.13</span> Deduplication</h2>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> This tab may follow from previous tabs.</span></p>
<p>The package <strong>dplyr</strong> offers the <code>distinct()</code> function to reduce the dataframe to only unique rows - removing duplicates.<br />
In this case we just want to remove rows that are complete duplicates, so we just add the simple command <code>distinct()</code>.</p>
<p>For more complex deduplications see the page on deduplicating.</p>
<p>We begin with 6017 rows in <code>linelist</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>linelist &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="st">  </span><span class="kw">distinct</span>()</span></code></pre></div>
<p>After deduplication there are 5888 rows.</p>
<p>Below, the <code>distinct()</code> command is added to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb106-2"><a href="#cb106-2"></a><span class="co">##################################################################################</span></span>
<span id="cb106-3"><a href="#cb106-3"></a></span>
<span id="cb106-4"><a href="#cb106-4"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb106-5"><a href="#cb106-5"></a><span class="co">###########################</span></span>
<span id="cb106-6"><a href="#cb106-6"></a>linelist &lt;-<span class="st"> </span>linelist_raw <span class="op">%&gt;%</span></span>
<span id="cb106-7"><a href="#cb106-7"></a><span class="st">    </span></span>
<span id="cb106-8"><a href="#cb106-8"></a><span class="st">    </span><span class="co"># standardize column name syntax</span></span>
<span id="cb106-9"><a href="#cb106-9"></a><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-10"><a href="#cb106-10"></a><span class="st">    </span></span>
<span id="cb106-11"><a href="#cb106-11"></a><span class="st">    </span><span class="co"># manually re-name columns</span></span>
<span id="cb106-12"><a href="#cb106-12"></a><span class="st">           </span><span class="co"># NEW name             # OLD name</span></span>
<span id="cb106-13"><a href="#cb106-13"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">date_infection       =</span> infection_date,</span>
<span id="cb106-14"><a href="#cb106-14"></a>           <span class="dt">date_hospitalisation =</span> hosp_date,</span>
<span id="cb106-15"><a href="#cb106-15"></a>           <span class="dt">date_outcome         =</span> date_of_outcome) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-16"><a href="#cb106-16"></a><span class="st">  </span></span>
<span id="cb106-17"><a href="#cb106-17"></a><span class="st">    </span><span class="co"># remove column</span></span>
<span id="cb106-18"><a href="#cb106-18"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(row_num, merged_header, x25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-19"><a href="#cb106-19"></a></span>
<span id="cb106-20"><a href="#cb106-20"></a><span class="st">    </span><span class="co"># fix incorrect values                 # old value       # new value</span></span>
<span id="cb106-21"><a href="#cb106-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_onset =</span> <span class="kw">recode</span>(date_onset, <span class="st">&quot;15th April 2014&quot;</span> =<span class="st"> &quot;2014-04-15&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-22"><a href="#cb106-22"></a><span class="st">  </span></span>
<span id="cb106-23"><a href="#cb106-23"></a><span class="st">    </span><span class="co"># correct the class of the columns</span></span>
<span id="cb106-24"><a href="#cb106-24"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb106-25"><a href="#cb106-25"></a>           <span class="dt">generation =</span> <span class="kw">as.numeric</span>(generation),</span>
<span id="cb106-26"><a href="#cb106-26"></a>           <span class="dt">age        =</span> <span class="kw">as.numeric</span>(age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-27"><a href="#cb106-27"></a><span class="st">    </span></span>
<span id="cb106-28"><a href="#cb106-28"></a><span class="st">    </span><span class="co"># create column: delay to hospitalisation</span></span>
<span id="cb106-29"><a href="#cb106-29"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">days_onset_hosp =</span> <span class="kw">as.numeric</span>(date_hospitalisation <span class="op">-</span><span class="st"> </span>date_onset)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-30"><a href="#cb106-30"></a><span class="st">    </span></span>
<span id="cb106-31"><a href="#cb106-31"></a><span class="st">    </span><span class="co"># clean values of hospital column</span></span>
<span id="cb106-32"><a href="#cb106-32"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">recode</span>(hospital,</span>
<span id="cb106-33"><a href="#cb106-33"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb106-34"><a href="#cb106-34"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb106-35"><a href="#cb106-35"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb106-36"><a href="#cb106-36"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  =<span class="st"> &quot;Military Hospital&quot;</span>,</span>
<span id="cb106-37"><a href="#cb106-37"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      =<span class="st"> &quot;Port Hospital&quot;</span>,</span>
<span id="cb106-38"><a href="#cb106-38"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   =<span class="st"> &quot;Central Hospital&quot;</span>,</span>
<span id="cb106-39"><a href="#cb106-39"></a>                      <span class="st">&quot;other&quot;</span>             =<span class="st"> &quot;Other&quot;</span>,</span>
<span id="cb106-40"><a href="#cb106-40"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> =<span class="st"> &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb106-41"><a href="#cb106-41"></a>                      )) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-42"><a href="#cb106-42"></a></span>
<span id="cb106-43"><a href="#cb106-43"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hospital =</span> <span class="kw">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-44"><a href="#cb106-44"></a></span>
<span id="cb106-45"><a href="#cb106-45"></a><span class="st">    </span><span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb106-46"><a href="#cb106-46"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age_years =</span> <span class="kw">case_when</span>(</span>
<span id="cb106-47"><a href="#cb106-47"></a>          age_unit <span class="op">==</span><span class="st"> &quot;years&quot;</span> <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb106-48"><a href="#cb106-48"></a>          age_unit <span class="op">==</span><span class="st"> &quot;months&quot;</span> <span class="op">~</span><span class="st"> </span>age<span class="op">/</span><span class="dv">12</span>,</span>
<span id="cb106-49"><a href="#cb106-49"></a>          <span class="kw">is.na</span>(age_unit) <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb106-50"><a href="#cb106-50"></a>          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-51"><a href="#cb106-51"></a><span class="st">    </span></span>
<span id="cb106-52"><a href="#cb106-52"></a><span class="st">    </span><span class="kw">filter</span>(</span>
<span id="cb106-53"><a href="#cb106-53"></a>          <span class="co"># keep only rows where case_id is not missing</span></span>
<span id="cb106-54"><a href="#cb106-54"></a>          <span class="op">!</span><span class="kw">is.na</span>(case_id),  </span>
<span id="cb106-55"><a href="#cb106-55"></a>          </span>
<span id="cb106-56"><a href="#cb106-56"></a>          <span class="co"># also filter to keep only the second outbreak</span></span>
<span id="cb106-57"><a href="#cb106-57"></a>          date_onset <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="op">|</span><span class="st"> </span>(<span class="kw">is.na</span>(date_onset) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>hospital <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-58"><a href="#cb106-58"></a><span class="st">  </span></span>
<span id="cb106-59"><a href="#cb106-59"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb106-60"><a href="#cb106-60"></a>          <span class="co"># age categories: custom</span></span>
<span id="cb106-61"><a href="#cb106-61"></a>          <span class="dt">age_cat =</span> epikit<span class="op">::</span><span class="kw">age_categories</span>(age_years, <span class="dt">breakers =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb106-62"><a href="#cb106-62"></a>        </span>
<span id="cb106-63"><a href="#cb106-63"></a>          <span class="co"># age categories: 0 to 85 by 5s</span></span>
<span id="cb106-64"><a href="#cb106-64"></a>          <span class="dt">age_cat5 =</span> epikit<span class="op">::</span><span class="kw">age_categories</span>(age_years, <span class="dt">breakers =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb106-65"><a href="#cb106-65"></a><span class="st">  </span></span>
<span id="cb106-66"><a href="#cb106-66"></a><span class="st">    </span><span class="kw">distinct</span>()</span></code></pre></div>

</div>
</div>



</div>
<div id="age-pyramids" class="section level1 tabset tabset-fade" number="5">
<h1><span class="header-section-number">5</span> Age pyramids</h1>
<p>Age pyramids can be useful to show patterns by age group. They can show gender, or the distribution of other characteristics.<br />
These tabs demonstrate how to produce age pyramids using:</p>
<ul>
<li>Fast &amp; easy: Using the <strong>apyramid</strong> package<br />
</li>
<li>More flexible: Using <code>ggplot()</code><br />
</li>
<li>Having baseline demographics displayed in the background of the pyramid<br />
</li>
<li>Using pyramid-style plots to show other types of data (e.g responses to Likert-style questions)</li>
</ul>
<!-- ======================================================= -->
<div id="overview-1" class="section level2 tabset tabset-fade" number="5.1">
<h2><span class="header-section-number">5.1</span> Overview</h2>
<p><img src="images/pop_pyramid_baseline.png" width="50%" /><img src="images/likert.png" width="50%" /></p>
<p>Age/gender demographic pyramids in R are generally made with <code>ggplot()</code> by creating two barplots (one for each gender), converting one’s values to negative values, and flipping the x and y axes to display the barplots vertically.</p>
<p>Here we offer a quick approach through the <strong>apyramid</strong> package:</p>
<ul>
<li>More customizable code using the raw <code>ggplot()</code> commands<br />
</li>
<li>How to combine case demographic data and compare with that of a baseline population (as shown above)<br />
</li>
<li>Application of these methods to show other types of data (e.g. responses to Likert-style survey questions)</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="preparation-1" class="section level2 tabset tabset-fade" number="5.2">
<h2><span class="header-section-number">5.2</span> Preparation</h2>
<h2>
Preparation
</h2>
<p>For this tab we use the <code>linelist</code> dataset that is cleaned in the Cleaning tab.</p>
<p>To make a traditional age/sex demographic pyramid, the data must first be cleaned in the following ways:</p>
<ul>
<li>The gender column must be cleaned.<br />
</li>
<li>Age should be in an age category column, and should be an of class Factor (with correctly ordered levels)</li>
</ul>
<p><strong>Load packages</strong></p>
<p>First, load the packages required for this analysis:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(rio,       <span class="co"># to import data</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>               here,      <span class="co"># to locate files</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>               tidyverse, <span class="co"># to clean, handle, and plot the data (includes ggplot2 package)</span></span>
<span id="cb107-4"><a href="#cb107-4"></a>               apyramid,  <span class="co"># a package dedicated to creating age pyramids</span></span>
<span id="cb107-5"><a href="#cb107-5"></a>               stringr)   <span class="co"># working with strings for titles, captions, etc.</span></span></code></pre></div>
<p>Load the data</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>linelist &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;linelist_cleaned.csv&quot;</span>)</span></code></pre></div>
<p><strong>Check class of variables</strong></p>
<p>Ensure that the age variable is class Numeric, and check the class and order of levels of <code>age_cat</code> and <code>age_cat5</code></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">class</span>(linelist<span class="op">$</span>age_years)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="kw">class</span>(linelist<span class="op">$</span>age_cat)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="kw">class</span>(linelist<span class="op">$</span>age_cat5)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-49 50-69   70+  &lt;NA&gt; 
##  1054  1153   957   889  1065   658    24     0    88</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="kw">table</span>(linelist<span class="op">$</span>age_cat5, <span class="dt">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-24 25-29 30-34 35-39 40-44 45-49 50-54 55-59 60-64 
##  1054  1153   957   889   570   495   315   171   113    59    14     6     2 
## 65-69 70-74 75-79 80-84   85+  &lt;NA&gt; 
##     2     0     0     0     0    88</code></pre>
<!-- ======================================================= -->
</div>
<div id="apyramid-package" class="section level2 tabset tabset-fade" number="5.3">
<h2><span class="header-section-number">5.3</span> <strong>apyramid</strong> package</h2>
<h2>
<strong>apyramid</strong> package
</h2>
<p>The package <strong>apyramid</strong> allows you to quickly make an age pyramid. For more nuanced situations, see the tab on using <code>ggplot()</code> to make age pyramids. You can read more about the <strong>apyramid</strong> package in its Help page by entering <code>?age_pyramid</code> in your R console.</p>
<div id="linelist-data" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Linelist data</h3>
<h3>
Linelist data
</h3>
<p>Using the cleaned linelist dataset, we can create an age pyramid with just one simple command. If you need help cleaning your data, see the handbook page on Cleaning data (LINK). In this command:</p>
<ul>
<li>The <em>data</em> argument is set as the <code>linelist</code> dataframe<br />
</li>
<li>The <em>age_group</em> argument is set to the name (in quotes) of the numeric category variable (in this case <code>age_cat5</code>)<br />
</li>
<li>The <em>split_by</em> argument (bar colors) should be a binary column (in this case “gender”)</li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>apyramid<span class="op">::</span><span class="kw">age_pyramid</span>(<span class="dt">data =</span> linelist,</span>
<span id="cb119-2"><a href="#cb119-2"></a>                      <span class="dt">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb119-3"><a href="#cb119-3"></a>                      <span class="dt">split_by =</span> <span class="st">&quot;gender&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: 281 missing rows were removed (88 values from `age_cat5` and 281 values
## from `gender`).</code></pre>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-90-1.png" width="672" />
When using <strong>agepyramid</strong> package, if the <code>split_by</code> column is binary (e.g. male/female, or yes/no), then the result will appear as a pyramid. However if there are more than two values in the <code>split_by</code> column (not including <code>NA</code>), the pyramid will appears as a faceted barplot with empty bars in the background indicating the range of the un-faceted data set for the age group. Values of split_by will appear as labels at top of each facet. For example below if the <code>split_by</code> variable is “hospital”.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>apyramid<span class="op">::</span><span class="kw">age_pyramid</span>(<span class="dt">data =</span> linelist,</span>
<span id="cb121-2"><a href="#cb121-2"></a>                      <span class="dt">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb121-3"><a href="#cb121-3"></a>                      <span class="dt">split_by =</span> <span class="st">&quot;hospital&quot;</span>,</span>
<span id="cb121-4"><a href="#cb121-4"></a>                      <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)        <span class="co"># show a bar for patients missing age, (note: this changes the pyramid into a faceted barplot)</span></span></code></pre></div>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p><strong>Missing values</strong><br />
Rows missing values for the <code>split_by</code> or <code>age_group</code> columns, if coded as <code>NA</code>, will not trigger the faceting shown above. By default these rows will not be shown. However you can specify that they appear, in an adjacent barplot and as a separate age group at the top, by specifying <code>na.rm = FALSE</code>.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>apyramid<span class="op">::</span><span class="kw">age_pyramid</span>(<span class="dt">data =</span> linelist,</span>
<span id="cb122-2"><a href="#cb122-2"></a>                      <span class="dt">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb122-3"><a href="#cb122-3"></a>                      <span class="dt">split_by =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb122-4"><a href="#cb122-4"></a>                      <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)         <span class="co"># show patients missing age or gender</span></span></code></pre></div>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p><strong>Proportions, colors, &amp; aesthetics</strong></p>
<p>By default, the bars display counts (not %), a dashed mid-line for each group is shown, and the colors are green/purple. Each of these parameters can all be adjusted, as shown below:</p>
<p>You can also add additional <code>ggplot()</code> commands to the plot using the standard <code>ggplot()</code> “+” syntax, such as aesthetic themes and label adjustments:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>apyramid<span class="op">::</span><span class="kw">age_pyramid</span>(<span class="dt">data =</span> linelist,</span>
<span id="cb123-2"><a href="#cb123-2"></a>                      <span class="dt">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb123-3"><a href="#cb123-3"></a>                      <span class="dt">split_by =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb123-4"><a href="#cb123-4"></a>                      <span class="dt">proportional =</span> <span class="ot">TRUE</span>,                  <span class="co"># show percents, not counts</span></span>
<span id="cb123-5"><a href="#cb123-5"></a>                      <span class="dt">show_midpoint =</span> <span class="ot">FALSE</span>,                <span class="co"># remove bar mid-point line</span></span>
<span id="cb123-6"><a href="#cb123-6"></a>                      <span class="co">#pal = c(&quot;orange&quot;, &quot;purple&quot;)          # can specify alt. colors here (but not labels, see below)</span></span>
<span id="cb123-7"><a href="#cb123-7"></a>                      )<span class="op">+</span><span class="st">                 </span></span>
<span id="cb123-8"><a href="#cb123-8"></a><span class="st">  </span></span>
<span id="cb123-9"><a href="#cb123-9"></a><span class="st">  </span><span class="co"># additional ggplot commands</span></span>
<span id="cb123-10"><a href="#cb123-10"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span><span class="st">                                          </span><span class="co"># simplify the background</span></span>
<span id="cb123-11"><a href="#cb123-11"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>),         <span class="co"># to specify colors AND labels</span></span>
<span id="cb123-12"><a href="#cb123-12"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))<span class="op">+</span></span>
<span id="cb123-13"><a href="#cb123-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Percent of all cases&quot;</span>,                          <span class="co"># note that x and y labels are switched (see ggplot tab)</span></span>
<span id="cb123-14"><a href="#cb123-14"></a>       <span class="dt">x =</span> <span class="st">&quot;Age categories&quot;</span>,                          </span>
<span id="cb123-15"><a href="#cb123-15"></a>       <span class="dt">fill =</span> <span class="st">&quot;Gender&quot;</span>, </span>
<span id="cb123-16"><a href="#cb123-16"></a>       <span class="dt">caption =</span> <span class="st">&quot;My data source and caption here&quot;</span>,</span>
<span id="cb123-17"><a href="#cb123-17"></a>       <span class="dt">title =</span> <span class="st">&quot;Title of my plot&quot;</span>,</span>
<span id="cb123-18"><a href="#cb123-18"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Subtitle with </span><span class="ch">\n</span><span class="st"> a second line...&quot;</span>)<span class="op">+</span></span>
<span id="cb123-19"><a href="#cb123-19"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb123-20"><a href="#cb123-20"></a>    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,                             <span class="co"># move legend to bottom</span></span>
<span id="cb123-21"><a href="#cb123-21"></a>    <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),     <span class="co"># fonts/sizes, see ggplot tips page</span></span>
<span id="cb123-22"><a href="#cb123-22"></a>    <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: 281 missing rows were removed (88 values from `age_cat5` and 281 values
## from `gender`).</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which
## will replace the existing scale.</code></pre>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
</div>
<div id="aggregated-data" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Aggregated data</h3>
<h3>
Aggregated data
</h3>
<p>The examples above assume your data are in a linelist-like format, with one row per observation. If your data are already aggregated into counts by age category, you can still use the <strong>apyramid</strong> package, as shown below.</p>
<p>Let’s say that your dataset looks like this, with columns for age category, and male counts, female counts, and missing counts.<br />
(see the handbook page on Transforming data for tips)</p>
<pre><code>## `summarise()` has grouped output by &#39;age_cat5&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># View the aggregated data</span></span>
<span id="cb127-2"><a href="#cb127-2"></a>DT<span class="op">::</span><span class="kw">datatable</span>(demo_agg, <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">5</span>, <span class="dt">scrollX=</span>T) )</span></code></pre></div>
<div id="htmlwidget-5bcc531cb343b278eb79" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5bcc531cb343b278eb79">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"648\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"466\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"88\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69",null],[612,648,490,422,246,179,92,39,24,13,1,null,null,null,null],[410,466,423,435,311,295,216,128,88,46,13,6,2,2,null],[32,39,44,32,13,21,7,4,1,null,null,null,null,null,88]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>f<\/th>\n      <th>m<\/th>\n      <th>missing_gender<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p><code>ggplot()</code> perfers data in “long” format, so first pivot the data to be “long” with the <code>pivot_longer()</code> function from <strong>dplyr</strong>.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="co"># pivot the aggregated data into long format</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>demo_agg_long &lt;-<span class="st"> </span>demo_agg <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-3"><a href="#cb128-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(f, m, missing_gender),            <span class="co"># cols to elongate</span></span>
<span id="cb128-4"><a href="#cb128-4"></a>               <span class="dt">names_to =</span> <span class="st">&quot;gender&quot;</span>,                <span class="co"># name for new col of categories</span></span>
<span id="cb128-5"><a href="#cb128-5"></a>               <span class="dt">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="op">%&gt;%</span><span class="st">           </span><span class="co"># name for new col of counts</span></span>
<span id="cb128-6"><a href="#cb128-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">na_if</span>(gender, <span class="st">&quot;missing_gender&quot;</span>)) <span class="co"># convert &quot;missing_gender&quot; to NA</span></span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># View the aggregated data</span></span>
<span id="cb129-2"><a href="#cb129-2"></a>DT<span class="op">::</span><span class="kw">datatable</span>(demo_agg_long, <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">5</span>, <span class="dt">scrollX=</span>T) )</span></code></pre></div>
<div id="htmlwidget-5e9a1e3f34ea482b48a6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5e9a1e3f34ea482b48a6">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"648\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["0-4","0-4","0-4","5-9","5-9","5-9","10-14","10-14","10-14","15-19","15-19","15-19","20-24","20-24","20-24","25-29","25-29","25-29","30-34","30-34","30-34","35-39","35-39","35-39","40-44","40-44","40-44","45-49","45-49","45-49","50-54","50-54","50-54","55-59","55-59","55-59","60-64","60-64","60-64","65-69","65-69","65-69",null,null,null],["f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null],[612,410,32,648,466,39,490,423,44,422,435,32,246,311,13,179,295,21,92,216,7,39,128,4,24,88,1,13,46,null,1,13,null,null,6,null,null,2,null,null,2,null,null,null,88]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>gender<\/th>\n      <th>counts<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Then use the <code>split_by</code> and <code>count</code> arguments of <code>age_pyramid()</code> to specify the respective columns:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>apyramid<span class="op">::</span><span class="kw">age_pyramid</span>(<span class="dt">data =</span> demo_agg_long,</span>
<span id="cb130-2"><a href="#cb130-2"></a>                      <span class="dt">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb130-3"><a href="#cb130-3"></a>                      <span class="dt">split_by =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb130-4"><a href="#cb130-4"></a>                      <span class="dt">count =</span> <span class="st">&quot;counts&quot;</span>)      <span class="co"># give the column name for the aggregated counts</span></span></code></pre></div>
<pre><code>## Warning: Removed 20 rows containing missing values (position_stack).</code></pre>
<pre><code>## Warning: Removed 19 rows containing missing values.</code></pre>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>Note in the above, that the factor order of “m” and “f” is different (pyramid reversed). To adjust the order you must re-define gender in the aggredated data as a Factor and order the levels as desired.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="ggplot" class="section level2 tabset tabset-fade" number="5.4">
<h2><span class="header-section-number">5.4</span> <code>ggplot()</code></h2>
<h2>
<code>ggplot()</code>
</h2>
<p>Using <code>ggplot()</code> to build your age pyramid allows for more flexibility, but requires more effort and understanding of how <code>ggplot()</code> works. It is also easier to accidentally make mistakes.</p>
<p><strong>apyramid</strong> uses <code>ggplot()</code> in the background (and accepts <code>ggplot()</code> commands added), but this page shows how to adjust or recreate a pyramid only using <code>ggplot()</code>, if you wish.</p>
<!-- ======================================================= -->
<div id="constructing-the-plot" class="section level3 tabset tabset-fade" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Constructing the plot</h3>
<h3>
Constructing the plot
</h3>
<p>First, understand that to make such a pyramid using <code>ggplot()</code> the approach is to:</p>
<ul>
<li><p>Within the <code>ggplot()</code>, create <strong>two</strong> graphs by age category. Create one for each of the two grouping values (in this case gender). See filters applied to the <code>data</code> arguments in each <code>geom_histogram()</code> commands below.</p></li>
<li><p>If using <code>geom_histogram()</code>, the graphs operate off the numeric column (e.g. <code>age_years</code>), whereas if using <code>geom_barplot()</code> the graphs operate from an ordered Factor (e.g. <code>age_cat5</code>).</p></li>
<li><p>One graph will have positive count values, while the other will have its counts converted to negative values - this allows both graphs to be seen and compared against each other in the same plot.</p></li>
<li><p>The command <code>coord_flip()</code> switches the X and Y axes, resulting in the graphs turning vertical and creating the pyramid.</p></li>
<li><p>Lastly, the counts-axis labels must be specified so they appear as “positive” counts on both sides of the pyramid (despite the underlying values on one side being negative).</p></li>
</ul>
<p>A <strong>simple</strong> version of this, using <code>geom_histogram()</code>, is below:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a>  <span class="co"># begin ggplot</span></span>
<span id="cb133-2"><a href="#cb133-2"></a>  <span class="kw">ggplot</span>(<span class="dt">data =</span> linelist, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">fill =</span> gender)) <span class="op">+</span></span>
<span id="cb133-3"><a href="#cb133-3"></a><span class="st">  </span></span>
<span id="cb133-4"><a href="#cb133-4"></a><span class="st">  </span><span class="co"># female histogram</span></span>
<span id="cb133-5"><a href="#cb133-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> <span class="kw">filter</span>(linelist, gender <span class="op">==</span><span class="st"> &quot;f&quot;</span>),</span>
<span id="cb133-6"><a href="#cb133-6"></a>                 <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">85</span>,<span class="dv">5</span>),</span>
<span id="cb133-7"><a href="#cb133-7"></a>                 <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb133-8"><a href="#cb133-8"></a><span class="st">  </span></span>
<span id="cb133-9"><a href="#cb133-9"></a><span class="st">  </span><span class="co"># male histogram (values converted to negative)</span></span>
<span id="cb133-10"><a href="#cb133-10"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> <span class="kw">filter</span>(linelist, gender <span class="op">==</span><span class="st"> &quot;m&quot;</span>),</span>
<span id="cb133-11"><a href="#cb133-11"></a>                 <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">85</span>,<span class="dv">5</span>),</span>
<span id="cb133-12"><a href="#cb133-12"></a>                 <span class="kw">aes</span>(<span class="dt">y=</span>..count..<span class="op">*</span>(<span class="op">-</span><span class="dv">1</span>)),</span>
<span id="cb133-13"><a href="#cb133-13"></a>                 <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb133-14"><a href="#cb133-14"></a><span class="st">  </span></span>
<span id="cb133-15"><a href="#cb133-15"></a><span class="st">  </span><span class="co"># flip the X and Y axes</span></span>
<span id="cb133-16"><a href="#cb133-16"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb133-17"><a href="#cb133-17"></a><span class="st">  </span></span>
<span id="cb133-18"><a href="#cb133-18"></a><span class="st">  </span><span class="co"># adjust counts-axis scale</span></span>
<span id="cb133-19"><a href="#cb133-19"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">600</span>, <span class="dv">900</span>),</span>
<span id="cb133-20"><a href="#cb133-20"></a>                     <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">600</span>,<span class="dv">900</span>,<span class="dv">100</span>),</span>
<span id="cb133-21"><a href="#cb133-21"></a>                     <span class="dt">labels =</span> <span class="kw">abs</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">600</span>, <span class="dv">900</span>, <span class="dv">100</span>)))</span></code></pre></div>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> If the <strong>limits</strong> of your counts axis are set too low, and a counts bar exceeds them, the bar will disappear entirely or be artificially shortened! Watch for this if analyzing data which is routinely updated. Prevent it by having your count-axis limits auto-adjust to your data, as below.</span></p>
<p>There are many things you can change/add to this simple version, including:</p>
<ul>
<li>Auto adjust counts-axis count scale to your data (avoid errors discussed in warning below)<br />
</li>
<li>Manually specify colors and legend labels</li>
</ul>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="co"># create dataset with proportion of total</span></span>
<span id="cb134-2"><a href="#cb134-2"></a>pyramid_data &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3"></a><span class="st">  </span><span class="kw">group_by</span>(age_cat5, gender) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-4"><a href="#cb134-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">counts =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-5"><a href="#cb134-5"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-6"><a href="#cb134-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>(counts <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts, <span class="dt">na.rm=</span>T)),<span class="dv">1</span>), </span>
<span id="cb134-7"><a href="#cb134-7"></a>         <span class="dt">percent =</span> <span class="kw">case_when</span>(</span>
<span id="cb134-8"><a href="#cb134-8"></a>            gender <span class="op">==</span><span class="st"> &quot;f&quot;</span> <span class="op">~</span><span class="st"> </span>percent,</span>
<span id="cb134-9"><a href="#cb134-9"></a>            gender <span class="op">==</span><span class="st"> &quot;m&quot;</span> <span class="op">~</span><span class="st"> </span><span class="op">-</span>percent,</span>
<span id="cb134-10"><a href="#cb134-10"></a>            <span class="ot">TRUE</span>          <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;age_cat5&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a>max_per &lt;-<span class="st"> </span><span class="kw">max</span>(pyramid_data<span class="op">$</span>percent, <span class="dt">na.rm=</span>T)</span>
<span id="cb136-2"><a href="#cb136-2"></a>min_per &lt;-<span class="st"> </span><span class="kw">min</span>(pyramid_data<span class="op">$</span>percent, <span class="dt">na.rm=</span>T)</span>
<span id="cb136-3"><a href="#cb136-3"></a></span>
<span id="cb136-4"><a href="#cb136-4"></a></span>
<span id="cb136-5"><a href="#cb136-5"></a><span class="co"># begin ggplot</span></span>
<span id="cb136-6"><a href="#cb136-6"></a>  <span class="kw">ggplot</span>()<span class="op">+</span><span class="st">  </span><span class="co"># default x-axis is age in years;</span></span>
<span id="cb136-7"><a href="#cb136-7"></a></span>
<span id="cb136-8"><a href="#cb136-8"></a><span class="st">  </span><span class="co"># case data graph</span></span>
<span id="cb136-9"><a href="#cb136-9"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data =</span> pyramid_data,</span>
<span id="cb136-10"><a href="#cb136-10"></a>           <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb136-11"><a href="#cb136-11"></a>           <span class="kw">aes</span>(<span class="dt">x =</span> age_cat5,</span>
<span id="cb136-12"><a href="#cb136-12"></a>               <span class="dt">y =</span> percent,</span>
<span id="cb136-13"><a href="#cb136-13"></a>               <span class="dt">fill =</span> gender),        <span class="co"># </span></span>
<span id="cb136-14"><a href="#cb136-14"></a>           <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>)<span class="op">+</span><span class="st">         </span><span class="co"># white around each bar</span></span>
<span id="cb136-15"><a href="#cb136-15"></a><span class="st">  </span></span>
<span id="cb136-16"><a href="#cb136-16"></a><span class="st">  </span><span class="co"># flip the X and Y axes to make pyramid vertical</span></span>
<span id="cb136-17"><a href="#cb136-17"></a><span class="st">  </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb136-18"><a href="#cb136-18"></a><span class="st">  </span></span>
<span id="cb136-19"><a href="#cb136-19"></a></span>
<span id="cb136-20"><a href="#cb136-20"></a><span class="st">  </span><span class="co"># adjust the axes scales (remember they are flipped now!)</span></span>
<span id="cb136-21"><a href="#cb136-21"></a><span class="st">  </span><span class="co">#scale_x_continuous(breaks = seq(0,100,5), labels = seq(0,100,5)) +</span></span>
<span id="cb136-22"><a href="#cb136-22"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(min_per, max_per),</span>
<span id="cb136-23"><a href="#cb136-23"></a>                     <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="kw">floor</span>(min_per), <span class="kw">ceiling</span>(max_per), <span class="dv">2</span>),</span>
<span id="cb136-24"><a href="#cb136-24"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="kw">abs</span>(<span class="kw">seq</span>(<span class="kw">floor</span>(min_per), <span class="kw">ceiling</span>(max_per), <span class="dv">2</span>)), <span class="st">&quot;%&quot;</span>))<span class="op">+</span></span>
<span id="cb136-25"><a href="#cb136-25"></a></span>
<span id="cb136-26"><a href="#cb136-26"></a><span class="st">  </span><span class="co"># designate colors and legend labels manually</span></span>
<span id="cb136-27"><a href="#cb136-27"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb136-28"><a href="#cb136-28"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;f&quot;</span> =<span class="st"> &quot;orange&quot;</span>,</span>
<span id="cb136-29"><a href="#cb136-29"></a>               <span class="st">&quot;m&quot;</span> =<span class="st"> &quot;darkgreen&quot;</span>),</span>
<span id="cb136-30"><a href="#cb136-30"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>),</span>
<span id="cb136-31"><a href="#cb136-31"></a>  ) <span class="op">+</span></span>
<span id="cb136-32"><a href="#cb136-32"></a><span class="st">  </span></span>
<span id="cb136-33"><a href="#cb136-33"></a><span class="st">  </span><span class="co"># label values (remember X and Y flipped now)</span></span>
<span id="cb136-34"><a href="#cb136-34"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb136-35"><a href="#cb136-35"></a>    <span class="dt">x =</span> <span class="st">&quot;Age group&quot;</span>,</span>
<span id="cb136-36"><a href="#cb136-36"></a>    <span class="dt">y =</span> <span class="st">&quot;Percent of total&quot;</span>,</span>
<span id="cb136-37"><a href="#cb136-37"></a>    <span class="dt">fill =</span> <span class="ot">NULL</span>,</span>
<span id="cb136-38"><a href="#cb136-38"></a>    <span class="dt">caption =</span> stringr<span class="op">::</span><span class="kw">str_glue</span>(<span class="st">&quot;Data are from linelist </span><span class="ch">\n</span><span class="st">n = {nrow(linelist)} (age or sex missing for {sum(is.na(linelist$gender) | is.na(linelist$age_years))} cases) </span><span class="ch">\n</span><span class="st">Data as of: {format(Sys.Date(), &#39;%d %b %Y&#39;)}&quot;</span>)) <span class="op">+</span></span>
<span id="cb136-39"><a href="#cb136-39"></a><span class="st">  </span></span>
<span id="cb136-40"><a href="#cb136-40"></a><span class="st">  </span><span class="co"># optional aesthetic themes</span></span>
<span id="cb136-41"><a href="#cb136-41"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb136-42"><a href="#cb136-42"></a>    <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb136-43"><a href="#cb136-43"></a>    <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb136-44"><a href="#cb136-44"></a>    <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb136-45"><a href="#cb136-45"></a>    <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb136-46"><a href="#cb136-46"></a>    <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>), </span>
<span id="cb136-47"><a href="#cb136-47"></a>    <span class="dt">plot.caption =</span> <span class="kw">element_text</span>(<span class="dt">hjust=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">11</span>, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb136-48"><a href="#cb136-48"></a><span class="st">  </span></span>
<span id="cb136-49"><a href="#cb136-49"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">&quot;Age and gender of cases&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 10 rows containing missing values (position_stack).</code></pre>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="compare-to-baseline" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Compare to baseline</h3>
<h3>
Compare to baseline
</h3>
<p>With the flexibility of <code>ggplot()</code>, you can have a second layer of bars in the background that represent the true population pyramid. This can provide a nice visualization to compare the observed counts with the baseline.</p>
<p>Import and view the population data</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="co"># import the population demographics data</span></span>
<span id="cb138-2"><a href="#cb138-2"></a>pop &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;country_demographics.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a><span class="co"># display the linelist data as a table</span></span>
<span id="cb139-2"><a href="#cb139-2"></a>DT<span class="op">::</span><span class="kw">datatable</span>(pop, <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">10</span>, <span class="dt">scrollX=</span>T) )</span></code></pre></div>
<div id="htmlwidget-31b34d9b756302d4507c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-31b34d9b756302d4507c">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"40402\" data-max=\"7828087\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"64656\" data-max=\"7674675\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85+"],[7828087,6705882,5601230,4576430,3734111,3111651,2571215,2121247,1735468,1418749,1145345,900239,685141,500248,347093,202240,94325,40402],[7674675,6592449,5522555,4533885,3726537,3118040,2592416,2150490,1771213,1459439,1193903,956070,745682,563894,416543,258538,130479,64656]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p>First some data management steps:</p>
<p>Here we record the order of age categories that we want to appear. Due to some quirks the way the <code>ggplot()</code> is implemented, it is easiest to store these as a character vector and use them later in the plotting function.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="co"># record correct age cat levels</span></span>
<span id="cb140-2"><a href="#cb140-2"></a>age_levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;0-4&quot;</span>,<span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-24&quot;</span>,</span>
<span id="cb140-3"><a href="#cb140-3"></a>                <span class="st">&quot;25-29&quot;</span>,<span class="st">&quot;30-34&quot;</span>, <span class="st">&quot;35-39&quot;</span>, <span class="st">&quot;40-44&quot;</span>, <span class="st">&quot;45-49&quot;</span>,</span>
<span id="cb140-4"><a href="#cb140-4"></a>                <span class="st">&quot;50-54&quot;</span>, <span class="st">&quot;55-59&quot;</span>, <span class="st">&quot;60-64&quot;</span>, <span class="st">&quot;65-69&quot;</span>, <span class="st">&quot;70-74&quot;</span>,</span>
<span id="cb140-5"><a href="#cb140-5"></a>                <span class="st">&quot;75-79&quot;</span>, <span class="st">&quot;80-84&quot;</span>, <span class="st">&quot;85+&quot;</span>)</span></code></pre></div>
<p>Combine the population and case data through the <strong>dplyr</strong> function <code>bind_rows()</code>:</p>
<ul>
<li>First, ensure they have the <em>exact same</em> column names, age categories values, and gender values<br />
</li>
<li>Make them have the same data structure: columns of age category, gender, counts, and percent of total<br />
</li>
<li>Bind them together, one on-top of the other (<code>bind_rows()</code>)</li>
</ul>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="co"># create/transform populaton data, with percent of total</span></span>
<span id="cb141-2"><a href="#cb141-2"></a><span class="co">########################################################</span></span>
<span id="cb141-3"><a href="#cb141-3"></a>pop_data &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(pop, <span class="kw">c</span>(m, f), <span class="dt">names_to =</span> <span class="st">&quot;gender&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># pivot gender columns longer</span></span>
<span id="cb141-4"><a href="#cb141-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="st">&quot;population&quot;</span>,                                                         <span class="co"># add column designating data source</span></span>
<span id="cb141-5"><a href="#cb141-5"></a>         <span class="dt">percent  =</span> <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>(counts <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts, <span class="dt">na.rm=</span>T)),<span class="dv">1</span>),                     <span class="co"># calculate % of total</span></span>
<span id="cb141-6"><a href="#cb141-6"></a>         <span class="dt">percent  =</span> <span class="kw">case_when</span>(                                                        <span class="co"># if male, convert % to negative</span></span>
<span id="cb141-7"><a href="#cb141-7"></a>                            gender <span class="op">==</span><span class="st"> &quot;f&quot;</span> <span class="op">~</span><span class="st"> </span>percent,</span>
<span id="cb141-8"><a href="#cb141-8"></a>                            gender <span class="op">==</span><span class="st"> &quot;m&quot;</span> <span class="op">~</span><span class="st"> </span><span class="op">-</span>percent,</span>
<span id="cb141-9"><a href="#cb141-9"></a>                            <span class="ot">TRUE</span>          <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>))</span></code></pre></div>
<p>Review the changed population dataset</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="co"># display the linelist data as a table</span></span>
<span id="cb142-2"><a href="#cb142-2"></a>DT<span class="op">::</span><span class="kw">datatable</span>(pop_data, <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">5</span>, <span class="dt">scrollX=</span>T) )</span></code></pre></div>
<div id="htmlwidget-724c6c1d305b18613c29" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-724c6c1d305b18613c29">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"40402\" data-max=\"7828087\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-9\" data-max=\"8.8\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85+","85+"],["m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656],["population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population","population"],[-9,8.8,-7.7,7.6,-6.5,6.4,-5.3,5.2,-4.3,4.3,-3.6,3.6,-3,3,-2.4,2.5,-2,2,-1.6,1.7,-1.3,1.4,-1,1.1,-0.8,0.9,-0.6,0.6,-0.4,0.5,-0.2,0.3,-0.1,0.2,-0,0.1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>gender<\/th>\n      <th>counts<\/th>\n      <th>data<\/th>\n      <th>percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,4]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Now implement the same for the case linelist. Slightly different because it begins with case-rows, not counts.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="co"># create case data by age/gender, with percent of total</span></span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="co">#######################################################</span></span>
<span id="cb143-3"><a href="#cb143-3"></a>case_data &lt;-<span class="st"> </span>linelist <span class="op">%&gt;%</span></span>
<span id="cb143-4"><a href="#cb143-4"></a><span class="st">  </span><span class="kw">group_by</span>(age_cat5, gender) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># aggregate linelist cases into age-gender groups</span></span>
<span id="cb143-5"><a href="#cb143-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">counts =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st">     </span><span class="co"># calculate counts per age-gender group</span></span>
<span id="cb143-6"><a href="#cb143-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-7"><a href="#cb143-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="st">&quot;cases&quot;</span>,                                          <span class="co"># add column designating data source</span></span>
<span id="cb143-8"><a href="#cb143-8"></a>         <span class="dt">percent =</span> <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>(counts <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts, <span class="dt">na.rm=</span>T)),<span class="dv">1</span>),  <span class="co"># calculate % of total for age-gender groups</span></span>
<span id="cb143-9"><a href="#cb143-9"></a>         <span class="dt">percent =</span> <span class="kw">case_when</span>(                                     <span class="co"># convert % to negative if male</span></span>
<span id="cb143-10"><a href="#cb143-10"></a>            gender <span class="op">==</span><span class="st"> &quot;f&quot;</span> <span class="op">~</span><span class="st"> </span>percent,</span>
<span id="cb143-11"><a href="#cb143-11"></a>            gender <span class="op">==</span><span class="st"> &quot;m&quot;</span> <span class="op">~</span><span class="st"> </span><span class="op">-</span>percent,</span>
<span id="cb143-12"><a href="#cb143-12"></a>            <span class="ot">TRUE</span>          <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;age_cat5&#39;. You can override using the `.groups` argument.</code></pre>
<p>Review the changed case dataset</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="co"># display the linelist data as a table</span></span>
<span id="cb145-2"><a href="#cb145-2"></a>DT<span class="op">::</span><span class="kw">datatable</span>(case_data, <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">5</span>, <span class="dt">scrollX=</span>T) )</span></code></pre></div>
<div id="htmlwidget-0977da6bc789da901745" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0977da6bc789da901745">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"648\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-7.9\" data-max=\"11\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["0-4","0-4","0-4","5-9","5-9","5-9","10-14","10-14","10-14","15-19","15-19","15-19","20-24","20-24","20-24","25-29","25-29","25-29","30-34","30-34","30-34","35-39","35-39","35-39","40-44","40-44","40-44","45-49","45-49","50-54","50-54","55-59","60-64","65-69",null],["f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m","f","m","m","m","m",null],[612,410,32,648,466,39,490,423,44,422,435,32,246,311,13,179,295,21,92,216,7,39,128,4,24,88,1,13,46,1,13,6,2,2,88],["cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases","cases"],[10.4,-7,null,11,-7.9,null,8.3,-7.2,null,7.2,-7.4,null,4.2,-5.3,null,3,-5,null,1.6,-3.7,null,0.7,-2.2,null,0.4,-1.5,null,0.2,-0.8,0,-0.2,-0.1,-0,-0,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>gender<\/th>\n      <th>counts<\/th>\n      <th>data<\/th>\n      <th>percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,4]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Now the two datasets are combined, one on top of the other (same column names)</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="co"># combine case and population data (same column names, age_cat values, and gender values)</span></span>
<span id="cb146-2"><a href="#cb146-2"></a>pyramid_data &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(case_data, pop_data)</span></code></pre></div>
<p>Store the maximum and minimum percent values, used in the plotting funtion to define the extent of the plot (and not cut off any bars!)</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="co"># Define extent of percent axis, used for plot limits</span></span>
<span id="cb147-2"><a href="#cb147-2"></a>max_per &lt;-<span class="st"> </span><span class="kw">max</span>(pyramid_data<span class="op">$</span>percent, <span class="dt">na.rm=</span>T)</span>
<span id="cb147-3"><a href="#cb147-3"></a>min_per &lt;-<span class="st"> </span><span class="kw">min</span>(pyramid_data<span class="op">$</span>percent, <span class="dt">na.rm=</span>T)</span></code></pre></div>
<p>Now the plot is made with <code>ggplot()</code>:</p>
<ul>
<li>One bar graph of population data (wider, more transparent bars)</li>
<li>One bar graph of case data (small, more solid bars)</li>
</ul>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="co"># begin ggplot</span></span>
<span id="cb148-2"><a href="#cb148-2"></a><span class="co">##############</span></span>
<span id="cb148-3"><a href="#cb148-3"></a><span class="kw">ggplot</span>()<span class="op">+</span><span class="st">  </span><span class="co"># default x-axis is age in years;</span></span>
<span id="cb148-4"><a href="#cb148-4"></a></span>
<span id="cb148-5"><a href="#cb148-5"></a><span class="st">  </span><span class="co"># population data graph</span></span>
<span id="cb148-6"><a href="#cb148-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data =</span> <span class="kw">filter</span>(pyramid_data, data <span class="op">==</span><span class="st"> &quot;population&quot;</span>),</span>
<span id="cb148-7"><a href="#cb148-7"></a>           <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb148-8"><a href="#cb148-8"></a>           <span class="kw">aes</span>(<span class="dt">x =</span> age_cat5,</span>
<span id="cb148-9"><a href="#cb148-9"></a>               <span class="dt">y =</span> percent,</span>
<span id="cb148-10"><a href="#cb148-10"></a>               <span class="dt">fill =</span> gender),        </span>
<span id="cb148-11"><a href="#cb148-11"></a>           <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,                               <span class="co"># black color around bars</span></span>
<span id="cb148-12"><a href="#cb148-12"></a>           <span class="dt">alpha =</span> <span class="fl">0.2</span>,                                    <span class="co"># more transparent</span></span>
<span id="cb148-13"><a href="#cb148-13"></a>           <span class="dt">width =</span> <span class="dv">1</span>)<span class="op">+</span><span class="st">                                     </span><span class="co"># full width</span></span>
<span id="cb148-14"><a href="#cb148-14"></a><span class="st">  </span></span>
<span id="cb148-15"><a href="#cb148-15"></a><span class="st">  </span><span class="co"># case data graph</span></span>
<span id="cb148-16"><a href="#cb148-16"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data =</span> <span class="kw">filter</span>(pyramid_data, data <span class="op">==</span><span class="st"> &quot;cases&quot;</span>), </span>
<span id="cb148-17"><a href="#cb148-17"></a>           <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,                              <span class="co"># use % as given in data, not counting rows</span></span>
<span id="cb148-18"><a href="#cb148-18"></a>           <span class="kw">aes</span>(<span class="dt">x =</span> age_cat5,                               <span class="co"># age categories as original X axis</span></span>
<span id="cb148-19"><a href="#cb148-19"></a>               <span class="dt">y =</span> percent,                                <span class="co"># % as original Y-axis</span></span>
<span id="cb148-20"><a href="#cb148-20"></a>               <span class="dt">fill =</span> gender),                             <span class="co"># fill of bars by gender</span></span>
<span id="cb148-21"><a href="#cb148-21"></a>           <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,                               <span class="co"># black color around bars</span></span>
<span id="cb148-22"><a href="#cb148-22"></a>           <span class="dt">alpha =</span> <span class="dv">1</span>,                                      <span class="co"># not transparent </span></span>
<span id="cb148-23"><a href="#cb148-23"></a>           <span class="dt">width =</span> <span class="fl">0.3</span>)<span class="op">+</span><span class="st">                                   </span><span class="co"># half width</span></span>
<span id="cb148-24"><a href="#cb148-24"></a><span class="st">  </span></span>
<span id="cb148-25"><a href="#cb148-25"></a><span class="st">  </span><span class="co"># flip the X and Y axes to make pyramid vertical</span></span>
<span id="cb148-26"><a href="#cb148-26"></a><span class="st">  </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb148-27"><a href="#cb148-27"></a><span class="st">  </span></span>
<span id="cb148-28"><a href="#cb148-28"></a><span class="st">  </span><span class="co"># adjust axes order, scale, and labels (remember X and Y axes are flipped now)</span></span>
<span id="cb148-29"><a href="#cb148-29"></a><span class="st">  </span><span class="co"># manually ensure that age-axis is ordered correctly</span></span>
<span id="cb148-30"><a href="#cb148-30"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> age_levels)<span class="op">+</span><span class="st"> </span></span>
<span id="cb148-31"><a href="#cb148-31"></a><span class="st">  </span></span>
<span id="cb148-32"><a href="#cb148-32"></a><span class="st">  </span><span class="co"># set percent-axis </span></span>
<span id="cb148-33"><a href="#cb148-33"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(min_per, max_per),                                          <span class="co"># min and max defined above</span></span>
<span id="cb148-34"><a href="#cb148-34"></a>                     <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="kw">floor</span>(min_per), <span class="kw">ceiling</span>(max_per), <span class="dt">by =</span> <span class="dv">2</span>),                <span class="co"># from min% to max% by 2 </span></span>
<span id="cb148-35"><a href="#cb148-35"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(                                                       <span class="co"># for the labels, paste together... </span></span>
<span id="cb148-36"><a href="#cb148-36"></a>                       <span class="kw">abs</span>(<span class="kw">seq</span>(<span class="kw">floor</span>(min_per), <span class="kw">ceiling</span>(max_per), <span class="dt">by =</span> <span class="dv">2</span>)),                  <span class="co"># ...rounded absolute values of breaks... </span></span>
<span id="cb148-37"><a href="#cb148-37"></a>                       <span class="st">&quot;%&quot;</span>))<span class="op">+</span><span class="st">                                                               </span><span class="co"># ... with &quot;%&quot;</span></span>
<span id="cb148-38"><a href="#cb148-38"></a><span class="st">                                                                                            </span><span class="co"># floor(), ceiling() round down and up </span></span>
<span id="cb148-39"><a href="#cb148-39"></a></span>
<span id="cb148-40"><a href="#cb148-40"></a><span class="st">  </span><span class="co"># designate colors and legend labels manually</span></span>
<span id="cb148-41"><a href="#cb148-41"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb148-42"><a href="#cb148-42"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;f&quot;</span> =<span class="st"> &quot;orange&quot;</span>,         <span class="co"># assign colors to values in the data</span></span>
<span id="cb148-43"><a href="#cb148-43"></a>               <span class="st">&quot;m&quot;</span> =<span class="st"> &quot;darkgreen&quot;</span>),</span>
<span id="cb148-44"><a href="#cb148-44"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;f&quot;</span> =<span class="st"> &quot;Female&quot;</span>,</span>
<span id="cb148-45"><a href="#cb148-45"></a>               <span class="st">&quot;m&quot;</span>=<span class="st"> &quot;Male&quot;</span>),      <span class="co"># change labels that appear in legend, note order</span></span>
<span id="cb148-46"><a href="#cb148-46"></a>  ) <span class="op">+</span></span>
<span id="cb148-47"><a href="#cb148-47"></a></span>
<span id="cb148-48"><a href="#cb148-48"></a><span class="st">  </span><span class="co"># plot labels, titles, caption    </span></span>
<span id="cb148-49"><a href="#cb148-49"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb148-50"><a href="#cb148-50"></a>    <span class="dt">title =</span> <span class="st">&quot;Case age and gender distribution,</span><span class="ch">\n</span><span class="st">as compared to baseline population&quot;</span>,</span>
<span id="cb148-51"><a href="#cb148-51"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb148-52"><a href="#cb148-52"></a>    <span class="dt">x =</span> <span class="st">&quot;Age category&quot;</span>,</span>
<span id="cb148-53"><a href="#cb148-53"></a>    <span class="dt">y =</span> <span class="st">&quot;Percent of total&quot;</span>,</span>
<span id="cb148-54"><a href="#cb148-54"></a>    <span class="dt">fill =</span> <span class="ot">NULL</span>,</span>
<span id="cb148-55"><a href="#cb148-55"></a>    <span class="dt">caption =</span> stringr<span class="op">::</span><span class="kw">str_glue</span>(<span class="st">&quot;Cases shown on top of country demographic baseline</span><span class="ch">\n</span><span class="st">Case data are from linelist, n = {nrow(linelist)}</span><span class="ch">\n</span><span class="st">Age or gender missing for {sum(is.na(linelist$gender) | is.na(linelist$age_years))} cases</span><span class="ch">\n</span><span class="st">Case data as of: {format(max(linelist$date_onset, na.rm=T), &#39;%d %b %Y&#39;)}&quot;</span>)) <span class="op">+</span></span>
<span id="cb148-56"><a href="#cb148-56"></a><span class="st">  </span></span>
<span id="cb148-57"><a href="#cb148-57"></a><span class="st">  </span><span class="co"># optional aesthetic themes</span></span>
<span id="cb148-58"><a href="#cb148-58"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb148-59"><a href="#cb148-59"></a>    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,                             <span class="co"># move legend to bottom</span></span>
<span id="cb148-60"><a href="#cb148-60"></a>    <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb148-61"><a href="#cb148-61"></a>    <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb148-62"><a href="#cb148-62"></a>    <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb148-63"><a href="#cb148-63"></a>    <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-64"><a href="#cb148-64"></a>    <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>), </span>
<span id="cb148-65"><a href="#cb148-65"></a>    <span class="dt">plot.caption =</span> <span class="kw">element_text</span>(<span class="dt">hjust=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">11</span>, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 10 rows containing missing values (position_stack).</code></pre>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="likert-scale" class="section level2 tabset tabset-fade" number="5.5">
<h2><span class="header-section-number">5.5</span> Likert scale</h2>
<h2>
Likert scale
</h2>
<p>The techniques used to make a population pyramid with <code>ggplot()</code> can also be used to make plots of Likert-scale survey data.</p>
<p>Import the data</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a><span class="co"># import the likert survey response data</span></span>
<span id="cb150-2"><a href="#cb150-2"></a>likert_data &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;likert_data.csv&quot;</span>)</span></code></pre></div>
<p>Start with data that looks like this, with a categorical classification of each respondent (<code>status</code>) and their answers to 8 questions on a 4-point Likert-type scale (“Very poor”, “Poor”, “Good”, “Very good”).</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="co"># display the linelist data as a table</span></span>
<span id="cb151-2"><a href="#cb151-2"></a>DT<span class="op">::</span><span class="kw">datatable</span>(likert_data, <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">10</span>, <span class="dt">scrollX=</span>T) )</span></code></pre></div>
<div id="htmlwidget-835b43ef48c35258741a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-835b43ef48c35258741a">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Senior","Junior","Intermediate","Intermediate","Senior","Junior","Senior","Senior","Senior","Senior","Senior","Junior","Senior","Junior","Senior","Junior","Intermediate","Intermediate","Junior","Senior","Senior","Junior","Senior","Senior","Junior","Intermediate","Junior","Senior","Intermediate","Senior","Senior","Junior","Intermediate","Senior","Intermediate","Junior","Senior","Junior"],["Very Good","Very Good","Good","Good","Very Good","Good","Very Good","Good","Good","Good","Good","Good","Good","Good","Very Good","Good","Poor","Very Good","Very Good","Not applicable","Very Good","Good","Very Good","Very Good","Very Good","Very Good","Good","Good","Very Good","Very Good","Not applicable","Good","Very Good","Good","Good","Good","Not applicable","Good"],["Very Good","Very Good","Good","Poor","Very Poor","Very Good","Very Good","Good","Very Good","Very Good","Very Good","Very Good","Good","Very Good","Very Good","Good","Poor","Good","Very Good","Very Good","Very Good","Good","Very Good","Very Good","Very Good","Good","Good","Poor","Very Good","Very Good","Not applicable","Good","Very Good","Very Good","Good","Very Good","Good","Good"],["Good","Very Good","Good","Poor","Good","Good","Very Good","Very Good","Very Good","Good","Very Good","Very Good","Poor","Good","Good","Good","Good","Very Good","Very Good","Very Good","Very Good","Good","Very Good","Good","Very Good","Good","Poor","Poor","Very Good","Very Good","Not applicable","Good","Very Good","Good","Good","Good","Good","Good"],["Very Poor","Very Good","Very Good","Very Poor","Poor","Very Poor","","Very Good","Very Poor","Very Poor","Very Poor","Good","Very Poor","Very Good","Good","","Very Poor","Very Poor","Good","Poor","Very Poor","Good","Good","Very Poor","Very Poor","Good","Good","Good","Very Poor","Very Poor","Very Poor","Good","Good","Good","Good","Very Poor","Good","Good"],["Not applicable","Very Good","Not applicable","Not applicable","Poor","Not applicable","","Poor","Not applicable","Poor","Not applicable","Good","Not applicable","Poor","Good","","Not applicable","Not applicable","Very Good","Poor","Not applicable","Good","Poor","Not applicable","Not applicable","Good","Good","Poor","Not applicable","Very Poor","Not applicable","Poor","Good","Good","Poor","Not applicable","Poor","Good"],["Not applicable","Very Good","Not applicable","Not applicable","Very Poor","Not applicable","","Not applicable","Not applicable","Not applicable","Not applicable","Good","Not applicable","Poor","Good","","Not applicable","Not applicable","Good","Good","Not applicable","Good","Poor","Good","Not applicable","Very Good","Very Good","Good","Not applicable","Not applicable","Not applicable","Good","Good","Good","Good","Not applicable","Good","Not applicable"],["Very Good","Very Good","Good","Good","Good","Good","","Very Good","Not applicable","Very Good","Good","Good","Poor","Good","Good","Poor","Very Good","Good","Good","Very Good","Good","Good","Good","Good","Good","Very Good","Good","Poor","Very Good","Very Good","Not applicable","Very Good","Good","Poor","Good","Poor","Not applicable","Good"],["Very Good","Very Good","Good","Good","Good","Good","Very Good","Very Good","Good","Very Good","Good","Very Good","Good","Very Good","Good","Poor","Very Good","Good","Good","Very Good","Very Good","Good","Good","Good","Very Good","Poor","Good","Poor","Very Good","Very Good","Not applicable","Good","Good","Good","Good","Poor","Not applicable","Good"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>status<\/th>\n      <th>Q1<\/th>\n      <th>Q2<\/th>\n      <th>Q3<\/th>\n      <th>Q4<\/th>\n      <th>Q5<\/th>\n      <th>Q6<\/th>\n      <th>Q7<\/th>\n      <th>Q8<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p>First, some data management steps:</p>
<ul>
<li>Pivot the data longer<br />
</li>
<li>Create new column <code>direction</code> depending on whether response was generally “positive” or “negative”<br />
</li>
<li>Set the Factor level order for the <code>status</code> column and the <code>Response</code> column<br />
</li>
<li>Store the max count value so limits of plot are appropriate</li>
</ul>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a>melted &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(likert_data, Q1<span class="op">:</span>Q8, <span class="dt">names_to =</span> <span class="st">&quot;Question&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Response&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-2"><a href="#cb152-2"></a><span class="st">     </span><span class="kw">mutate</span>(<span class="dt">direction =</span> <span class="kw">case_when</span>(</span>
<span id="cb152-3"><a href="#cb152-3"></a>               Response <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Poor&quot;</span>,<span class="st">&quot;Very Poor&quot;</span>) <span class="op">~</span><span class="st"> &quot;Negative&quot;</span>,</span>
<span id="cb152-4"><a href="#cb152-4"></a>               Response <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Very Good&quot;</span>) <span class="op">~</span><span class="st"> &quot;Positive&quot;</span>,</span>
<span id="cb152-5"><a href="#cb152-5"></a>               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Unknown&quot;</span>),</span>
<span id="cb152-6"><a href="#cb152-6"></a>            <span class="dt">status =</span> <span class="kw">factor</span>(status, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">c</span>(</span>
<span id="cb152-7"><a href="#cb152-7"></a>                 <span class="st">&quot;Senior&quot;</span>, <span class="st">&quot;Intermediate&quot;</span>, <span class="st">&quot;Junior&quot;</span>))),</span>
<span id="cb152-8"><a href="#cb152-8"></a>            <span class="dt">Response =</span> <span class="kw">factor</span>(Response, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Very Good&quot;</span>, <span class="st">&quot;Good&quot;</span>,</span>
<span id="cb152-9"><a href="#cb152-9"></a>                                             <span class="st">&quot;Very Poor&quot;</span>, <span class="st">&quot;Poor&quot;</span>))) <span class="co"># must reverse Very Poor and Poor for ordering to work</span></span>
<span id="cb152-10"><a href="#cb152-10"></a></span>
<span id="cb152-11"><a href="#cb152-11"></a>melted_max &lt;-<span class="st"> </span>melted <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-12"><a href="#cb152-12"></a><span class="st">   </span><span class="kw">group_by</span>(status, Question) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-13"><a href="#cb152-13"></a><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;status&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a>melted_max &lt;-<span class="st"> </span><span class="kw">max</span>(melted_max<span class="op">$</span>n, <span class="dt">na.rm=</span>T)</span></code></pre></div>
<p>Now make the plot:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="co"># make plot</span></span>
<span id="cb155-2"><a href="#cb155-2"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb155-3"><a href="#cb155-3"></a><span class="st">     </span><span class="co"># bar graph of the &quot;negative&quot; responses </span></span>
<span id="cb155-4"><a href="#cb155-4"></a><span class="st">     </span><span class="kw">geom_bar</span>(<span class="dt">data =</span> <span class="kw">filter</span>(melted,</span>
<span id="cb155-5"><a href="#cb155-5"></a>                            direction <span class="op">==</span><span class="st"> &quot;Negative&quot;</span>), </span>
<span id="cb155-6"><a href="#cb155-6"></a>              <span class="kw">aes</span>(<span class="dt">x =</span> status,</span>
<span id="cb155-7"><a href="#cb155-7"></a>                        <span class="dt">y=</span>..count..<span class="op">*</span>(<span class="op">-</span><span class="dv">1</span>),    <span class="co"># counts inverted to negative</span></span>
<span id="cb155-8"><a href="#cb155-8"></a>                        <span class="dt">fill =</span> Response),</span>
<span id="cb155-9"><a href="#cb155-9"></a>                    <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb155-10"><a href="#cb155-10"></a>                    <span class="dt">closed =</span> <span class="st">&quot;left&quot;</span>, </span>
<span id="cb155-11"><a href="#cb155-11"></a>                    <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="op">+</span></span>
<span id="cb155-12"><a href="#cb155-12"></a><span class="st">     </span></span>
<span id="cb155-13"><a href="#cb155-13"></a><span class="st">     </span><span class="co"># bar graph of the &quot;positive responses</span></span>
<span id="cb155-14"><a href="#cb155-14"></a><span class="st">     </span><span class="kw">geom_bar</span>(<span class="dt">data =</span> <span class="kw">filter</span>(melted, direction <span class="op">==</span><span class="st"> &quot;Positive&quot;</span>),</span>
<span id="cb155-15"><a href="#cb155-15"></a>              <span class="kw">aes</span>(<span class="dt">x =</span> status, <span class="dt">fill =</span> Response),</span>
<span id="cb155-16"><a href="#cb155-16"></a>              <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb155-17"><a href="#cb155-17"></a>              <span class="dt">closed =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb155-18"><a href="#cb155-18"></a>              <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="op">+</span></span>
<span id="cb155-19"><a href="#cb155-19"></a><span class="st">     </span></span>
<span id="cb155-20"><a href="#cb155-20"></a><span class="st">     </span><span class="co"># flip the X and Y axes</span></span>
<span id="cb155-21"><a href="#cb155-21"></a><span class="st">     </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb155-22"><a href="#cb155-22"></a><span class="st">  </span></span>
<span id="cb155-23"><a href="#cb155-23"></a><span class="st">     </span><span class="co"># Black vertical line at 0</span></span>
<span id="cb155-24"><a href="#cb155-24"></a><span class="st">     </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb155-25"><a href="#cb155-25"></a><span class="st">     </span></span>
<span id="cb155-26"><a href="#cb155-26"></a><span class="st">    </span><span class="co"># convert labels to all positive numbers</span></span>
<span id="cb155-27"><a href="#cb155-27"></a><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="kw">ceiling</span>(melted_max<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">11</span>, <span class="kw">ceiling</span>(melted_max<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>),   <span class="co"># seq from neg to pos by 10, edges rounded outward to nearest 5</span></span>
<span id="cb155-28"><a href="#cb155-28"></a>                       <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="kw">ceiling</span>(melted_max<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>, <span class="kw">ceiling</span>(melted_max<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb155-29"><a href="#cb155-29"></a>                       <span class="dt">labels =</span> <span class="kw">abs</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="kw">ceiling</span>(melted_max<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb155-30"><a href="#cb155-30"></a>                                            <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">ceiling</span>(melted_max<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>, <span class="dv">10</span>))))) <span class="op">+</span></span>
<span id="cb155-31"><a href="#cb155-31"></a><span class="st">     </span></span>
<span id="cb155-32"><a href="#cb155-32"></a><span class="st">    </span><span class="co"># color scales manually assigned </span></span>
<span id="cb155-33"><a href="#cb155-33"></a><span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;Very Good&quot;</span>  =<span class="st"> &quot;green4&quot;</span>, <span class="co"># assigns colors</span></span>
<span id="cb155-34"><a href="#cb155-34"></a>                                  <span class="st">&quot;Good&quot;</span>      =<span class="st"> &quot;green3&quot;</span>,</span>
<span id="cb155-35"><a href="#cb155-35"></a>                                  <span class="st">&quot;Poor&quot;</span>      =<span class="st"> &quot;yellow&quot;</span>,</span>
<span id="cb155-36"><a href="#cb155-36"></a>                                  <span class="st">&quot;Very Poor&quot;</span> =<span class="st"> &quot;red3&quot;</span>),</span>
<span id="cb155-37"><a href="#cb155-37"></a>                       <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Very Good&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Very Poor&quot;</span>))<span class="op">+</span><span class="st"> </span><span class="co"># orders the legend</span></span>
<span id="cb155-38"><a href="#cb155-38"></a><span class="st">     </span></span>
<span id="cb155-39"><a href="#cb155-39"></a><span class="st">    </span></span>
<span id="cb155-40"><a href="#cb155-40"></a><span class="st">     </span></span>
<span id="cb155-41"><a href="#cb155-41"></a><span class="st">    </span><span class="co"># facet the entire plot so each question is a sub-plot</span></span>
<span id="cb155-42"><a href="#cb155-42"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Question, <span class="dt">ncol =</span> <span class="dv">3</span>)<span class="op">+</span></span>
<span id="cb155-43"><a href="#cb155-43"></a><span class="st">     </span></span>
<span id="cb155-44"><a href="#cb155-44"></a><span class="st">    </span><span class="co"># labels, titles, caption</span></span>
<span id="cb155-45"><a href="#cb155-45"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Respondent status&quot;</span>,</span>
<span id="cb155-46"><a href="#cb155-46"></a>          <span class="dt">y =</span> <span class="st">&quot;Number of responses&quot;</span>,</span>
<span id="cb155-47"><a href="#cb155-47"></a>          <span class="dt">fill =</span> <span class="st">&quot;&quot;</span>)<span class="op">+</span></span>
<span id="cb155-48"><a href="#cb155-48"></a><span class="st">     </span><span class="kw">ggtitle</span>(<span class="kw">str_glue</span>(<span class="st">&quot;Likert-style responses</span><span class="ch">\n</span><span class="st">n = {nrow(likert_data)}&quot;</span>))<span class="op">+</span></span>
<span id="cb155-49"><a href="#cb155-49"></a></span>
<span id="cb155-50"><a href="#cb155-50"></a><span class="st">     </span><span class="co"># aesthetic settings</span></span>
<span id="cb155-51"><a href="#cb155-51"></a><span class="st">     </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb155-52"><a href="#cb155-52"></a><span class="st">     </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>),</span>
<span id="cb155-53"><a href="#cb155-53"></a>           <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb155-54"><a href="#cb155-54"></a>           <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),  <span class="co"># facet sub-titles</span></span>
<span id="cb155-55"><a href="#cb155-55"></a>           <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb155-56"><a href="#cb155-56"></a>           <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)) <span class="co"># black box around each facet</span></span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: closed

## Warning: Ignoring unknown parameters: closed</code></pre>
<p><img src="R-Handbook-for-Epis_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="resources" class="section level2 tabset tabset-fade" number="5.6">
<h2><span class="header-section-number">5.6</span> Resources</h2>
<h2>
Resources
</h2>
<p>This tab should stay with the name “Resources”.
Links to other online tutorials or resources.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
